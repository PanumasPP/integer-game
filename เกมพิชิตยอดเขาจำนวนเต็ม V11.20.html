<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Å‡∏°‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡∏¢‡∏≠‡∏î‡πÄ‡∏Ç‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏° V12.11 (Complete Fix)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Kanit', sans-serif;
            color: #374151;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            padding: 1rem;
            overflow-y: auto;
            position: relative;
        }

        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('BG.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.4;
            z-index: -1;
        }

        #heartbeatOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 0, 0, 0.2);
            z-index: 99;
            pointer-events: none; 
            animation: heartbeat 1.5s infinite;
        }

        @keyframes heartbeat {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }


        .welcome-screen-modal {
            display: flex;
            position: fixed;
            z-index: 150;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.75);
            justify-content: center;
            align-items: center;
        }

        .welcome-content {
            background-color: #fff;
            padding: 2.5rem;
            border-radius: 24px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            text-align: center;
            width: 90%;
            max-width: 600px;
            animation: modalAppear 0.5s ease-out;
        }


        .game-setup-screen, .board-container {
            background-color: rgba(255, 255, 255, 0.98);
            border-radius: 24px;
            box-shadow: 0 12px 35px rgba(0,0,0,0.12);
            padding: 2rem;
            width: 100%;
            max-width: 700px;
            margin-bottom: 2rem;
            position: relative;
            z-index: 1;
            text-align: center;
        }
        .board-container {
             max-width: 1200px;
        }
        .board-square {
            width: 78px;
            height: 78px;
            border: 2px solid #a5b4fc;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            text-align: center;
            position: relative;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            padding: 4px;
            font-weight: bold;
            overflow: visible;
        }
        .board-square:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        .square-number { font-size: 0.8rem; color: #4B5563; align-self: flex-start; padding: 1px 4px; background-color: rgba(255,255,255,0.9); border-radius: 4px; }
        .square-icon { font-size: 1.6rem; }
        .square-text { font-size: 0.65rem; line-height: 1.15; color: #1F2937; }

        .player-slots-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 1px; }
        .player-piece {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.35);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 16px;
            color: white;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            z-index: 10;
            background-color: transparent !important;
        }

        @keyframes pieceLandAnimation {
            0% { transform: scale(0.8); opacity: 0.7; }
            50% { transform: scale(1.4) translateY(-6px); opacity: 1; box-shadow: 0 6px 12px rgba(0,0,0,0.3); }
            100% { transform: scale(1); opacity: 1; }
        }
        .player-piece-landed {
            animation: pieceLandAnimation 0.7s ease-out;
        }

        .modal, .emoji-picker-modal, .victory-overlay, .central-message-overlay, .card-selection-modal, .prank-modal, .dice-animation-overlay {
            display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7); justify-content: center; align-items: center;
        }
        .modal-content, .emoji-picker-content, .central-message-content, .card-selection-content, .prank-modal-content, .dice-animation-content {
            background-color: #ffffff; margin: auto; padding: 25px; border: none; width: 90%; border-radius: 18px; box-shadow: 0 10px 30px rgba(0,0,0,0.25); animation: modalAppear 0.4s ease-out;
        }
        .modal-content { max-width: 580px; padding:35px; }
        .emoji-picker-content { max-width: 340px; padding: 20px; }
        .central-message-content { max-width: 500px; padding: 30px; text-align: center; }
        .card-selection-content { max-width: 650px; padding: 30px; text-align: center; }
        .prank-modal-content { max-width: 500px; padding: 30px; text-align: center; }
        .dice-animation-content {
            max-width: 350px;
            padding: 40px;
            text-align: center;
            background-color: #374151;
            color: white;
            border-radius: 20px;
        }
        .dice-animation-value {
            font-size: 6rem;
            font-weight: bold;
            line-height: 1;
            margin-bottom: 1.5rem;
            color: #fcd34d;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }


        @keyframes modalAppear { from { opacity: 0; transform: scale(0.85) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }

        .emoji-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(45px, 1fr)); gap: 12px; margin-top: 20px; }
        .emoji-btn { font-size: 26px; padding: 6px; border-radius: 10px; cursor: pointer; transition: background-color 0.2s, transform 0.2s; border: 1px solid #d1d5db; }
        .emoji-btn:hover { background-color: #e0f2fe; transform: scale(1.1); }

        .dice-area div p { border: 1px solid #90cdf4; padding: 12px; margin: 6px 0; border-radius: 10px; background-color: #e0f2fe; box-shadow: inset 0 1px 3px rgba(0,0,0,0.05); }
        .dice-value { font-size: 2rem; font-weight: bold; color: #1d4ed8; }
        .dice-label { color: #1e3a8a; }

        .start-square { background-color: #64748b; color: white; border-color: #475569;} .start-square .square-icon { color: #f59e0b; }
        .finish-square { background-color: #f59e0b; color: #475569; border-color: #d97706;} .finish-square .square-icon { color: #b91c1c; }
        .power-up-square { background-color: #22c55e; color: white; border-color: #16a34a;} .power-up-square .square-icon { color: #ecfdf5; }
        .setback-square { background-color: #ef4444; color: white; border-color: #dc2626;} .setback-square .square-icon { color: #fee2e2; }
        .puzzle-square { background-color: #3b82f6; color: white; border-color: #2563eb;} .puzzle-square .square-icon { color: #dbeafe; }
        .bonus-square { background-color: #ec4899; color: white; border-color: #db2777;} .bonus-square .square-icon { color: #fce7f3; }
        .normal-square { background-color: #e0f2fe; border-color: #7dd3fc;} .normal-square .square-icon { color: #0284c7; }
        
        .event-square { background-color: #a855f7; color: white; border-color: #9333ea;} 
        .event-square .square-icon { color: #f5d0fe; }

        .game-board-grid {
            display: grid;
            grid-template-columns: repeat(10, 75px);
            grid-template-rows: repeat(5, 75px);
            gap: 6px;
            margin: 0 auto;
        }

        .control-panel-item { background-color: rgba(255, 255, 255, 0.95); padding: 1.25rem; border-radius: 12px; box-shadow: 0 6px 12px -1px rgba(0, 0, 0, 0.08), 0 3px 7px -1px rgba(0, 0, 0, 0.05); }
        .main-action-button { background: linear-gradient(to right, #fb923c, #f97316); color: white; font-weight: bold; padding: 0.85rem 1.75rem; border-radius: 0.5rem; font-size: 1.125rem; box-shadow: 0 5px 12px rgba(249, 115, 22, 0.45); transition: all 0.3s ease; border: none; }
        .main-action-button:hover { transform: translateY(-3px) scale(1.03); box-shadow: 0 7px 18px rgba(249, 115, 22, 0.55); }
        .main-action-button:disabled { background: #94a3b8; box-shadow: none; cursor: not-allowed; }

        .modal-button { padding: 0.6rem 1.2rem; border-radius: 0.375rem; font-weight: bold; transition: background-color 0.2s ease, transform 0.2s; }
        .modal-submit-button { background-color: #10b981; color: white; }
        .modal-submit-button:hover { background-color: #059669; transform: translateY(-1px); }
        .modal-close-button { background-color: #e5e7eb; color: #374151; }
        .modal-close-button:hover { background-color: #cbd5e1; transform: translateY(-1px); }

        .difficulty-badge { display: none; }

        .setup-input { border: 1px solid #60a5fa; padding: 0.5rem; border-radius: 0.375rem; margin-top: 0.25rem; width: 100%; }
        .player-emoji-select-btn {
            font-size: 1.5rem;
            text-align: center;
            width: 60px;
            height: 50px;
            padding: 0.25rem;
            border: 1px solid #60a5fa;
            border-radius: 0.375rem;
            background-color: #fff;
            cursor: pointer;
        }
        .player-emoji-select-btn:hover { background-color: #dbeafe; }
        .player-config-entry { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem; }
        .creator-credit { text-align: center; font-size: 0.875rem; color: #4b5563; margin-top: 1.5rem; }

        .victory-overlay { /* ... existing styles ... */ }
        #fireworksContainer { /* ... existing styles ... */ }
        .firework-particle { /* ... existing styles ... */ }
        @keyframes fireworks-explode { /* ... existing styles ... */ }
        #winnerNameDisplay { /* ... existing styles ... */ }
        @keyframes winnerAppear { /* ... existing styles ... */ }

        .card-selection-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 1rem; margin-top: 1.5rem; }
        .card-back {
            width: 100px; height: 140px; background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
            border-radius: 10px; display: flex; justify-content: center; align-items: center;
            font-size: 3rem; color: white; cursor: pointer; transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2); border: 2px solid white;
        }
        .card-back:hover { transform: scale(1.05) translateY(-5px); box-shadow: 0 8px 16px rgba(0,0,0,0.3); }
        .card-back i { text-shadow: 0 2px 4px rgba(0,0,0,0.3); }

        .prank-target-btn, .prank-effect-btn, .punishment-btn, .setback-choice-btn {
            background-color: #f0abfc; color: #701a75; padding: 0.75rem 1rem; border-radius: 8px;
            font-weight: bold; margin: 0.5rem; transition: background-color 0.2s, transform 0.2s;
        }
        .punishment-btn { background-color: #fca5a5; color: #991b1b; }
        .setback-choice-btn { background-color: #fca5a5; color: #991b1b; }


        .prank-target-btn:hover, .prank-effect-btn:hover { background-color: #e879f9; transform: translateY(-2px); }
        .punishment-btn:hover, .setback-choice-btn:hover { background-color: #f87171; transform: translateY(-2px); }

        .prank-target-btn:disabled, .prank-effect-btn:disabled {
            background-color: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        #questionTimerDisplay {
            /* Styles for the timer will be applied by JavaScript */
        }
        
        #modalChoicesContainer {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

    </style>
</head>
<body>
    <div id="heartbeatOverlay"></div>

    <audio id="backgroundMusic" loop>
        <source src="sounds/background_music.mp3" type="audio/mpeg">
        ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Ñ‡πà‡∏∞
    </audio>

    <div id="welcomeScreenModal" class="welcome-screen-modal"> <div class="welcome-content"> <h1 class="text-4xl font-bold text-purple-700 mb-4">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà</h1>
            <h2 class="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600 mb-8">
                üèîÔ∏è ‡πÄ‡∏Å‡∏°‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡∏¢‡∏≠‡∏î‡πÄ‡∏Ç‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏° üé≤
            </h2>
            <p class="creator-credit text-lg mb-10">‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥: ‡∏Ñ‡∏£‡∏π‡∏†‡∏≤‡∏ì‡∏∏‡∏°‡∏≤‡∏® ‡πÅ‡∏õ‡πâ‡∏ô‡πÄ‡∏î‡∏ä<br>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏õ‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏ñ‡∏±‡∏°‡∏†‡πå</p>
            <button id="readyButton" class="main-action-button w-full md:w-1/2 lg:w-1/3 py-3 text-xl"><i class="fas fa-check-circle mr-2"></i>‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏¢!</button>
        </div>
    </div>


    <div id="gameSetupScreen" class="game-setup-screen hidden"> <h1 class="text-3xl font-bold text-center mb-6 text-purple-700">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡∏°‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡∏¢‡∏≠‡∏î‡πÄ‡∏Ç‡∏≤</h1>
        <div class="mb-4">
            <label for="numPlayersSelect" class="block text-lg font-medium text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô:</label>
            <select id="numPlayersSelect" class="setup-input mt-1 block w-full">
                <option value="2" selected>2 ‡∏Ñ‡∏ô</option>
                <option value="3">3 ‡∏Ñ‡∏ô</option>
                <option value="4">4 ‡∏Ñ‡∏ô</option>
                <option value="5">5 ‡∏Ñ‡∏ô</option>
                <option value="6">6 ‡∏Ñ‡∏ô</option>
                <option value="7">7 ‡∏Ñ‡∏ô</option>
                <option value="8">8 ‡∏Ñ‡∏ô</option>
                <option value="9">9 ‡∏Ñ‡∏ô</option>
                <option value="10">10 ‡∏Ñ‡∏ô</option>
            </select>
        </div>
        <div id="playerConfigArea" class="mb-6 space-y-4"></div>
        <p class="creator-credit">‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥: ‡∏Ñ‡∏£‡∏π‡∏†‡∏≤‡∏ì‡∏∏‡∏°‡∏≤‡∏® ‡πÅ‡∏õ‡πâ‡∏ô‡πÄ‡∏î‡∏ä ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏õ‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏ñ‡∏±‡∏°‡∏†‡πå</p>
        <button id="startGameBtn" class="main-action-button w-full py-3 mt-4"><i class="fas fa-play mr-2"></i>‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°!</button>
    </div>

    <div id="boardContainer" class="board-container hidden">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600">
                üèîÔ∏è ‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡∏¢‡∏≠‡∏î‡πÄ‡∏Ç‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ï‡πá‡∏° üé≤
            </h1>
        </header>

        <div class="flex flex-col lg:flex-row lg:space-x-6 items-start">
            <div id="playersInfoPanelContainer" class="w-full lg:w-1/5 control-panel-item mb-6 lg:mb-0 order-2 lg:order-1">
                <h2 class="text-2xl font-semibold mb-3 text-gray-800">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h2>
                <div id="playersInfoPanel" class="space-y-2"></div>
                <p id="roundDisplay" class="mt-4 text-lg font-bold text-gray-600">‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà: <span id="currentRoundCounter">1</span></p>
                <p class="mt-2 text-xl font-bold text-indigo-700">‡∏ï‡∏≤‡∏Ç‡∏≠‡∏á: <span id="currentPlayerTurn"></span></p>
            </div>

            <div id="gameBoardOuterContainer" class="w-full lg:flex-grow order-1 lg:order-2 flex justify-center mb-6 lg:mb-0">
                 <div id="gameBoard" class="game-board-grid p-4 bg-blue-50 rounded-xl"></div>
            </div>

            <div id="rightControlPanel" class="w-full lg:w-1/5 space-y-6 order-3">
                <div class="control-panel-item dice-area">
                    <h2 class="text-2xl font-semibold mb-3 text-gray-800">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏≠‡∏¢‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤</h2>
                    <div id="diceRollDisplay" class="text-center space-y-1">
                        <p><span class="dice-label">‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á:</span> <span id="movementDieValue" class="dice-value">-</span></p>
                        </div>
                </div>
                <div class="control-panel-item flex flex-col justify-center items-center">
                     <button id="rollDiceButton" class="main-action-button w-full">
                        <i class="fas fa-dice-d6 mr-2"></i> ‡∏ó‡∏≠‡∏¢‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤!
                    </button>
                </div>
            </div>
        </div>
        <div id="messageArea" class="mt-6 p-5 bg-white text-gray-700 rounded-xl shadow-lg text-center text-lg min-h-[60px]"></div>
    </div>

    <div id="centralMessageOverlay" class="central-message-overlay">
        <div id="centralMessageContent" class="central-message-content"></div>
    </div>

    <div id="diceAnimationOverlay" class="dice-animation-overlay">
        <div class="dice-animation-content">
            <p id="diceAnimationText" class="text-2xl mb-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≠‡∏¢‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤...</p>
            <div id="diceAnimationValue" class="dice-animation-value">?</div>
        </div>
    </div>


    <div id="cardSelectionModal" class="card-selection-modal">
        <div class="card-selection-content">
            <h2 id="cardSelectionTitle" class="text-3xl font-bold text-purple-600 mb-6">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î 1 ‡πÉ‡∏ö!</h2>
            <div id="cardSelectionGrid" class="card-selection-grid"></div>
        </div>
    </div>

    <div id="questionModal" class="modal">
        <div class="modal-content">
             <div id="modalHeader" class="flex justify-between items-center mb-2">
                <h3 id="modalTitle" class="text-2xl font-bold text-gray-800">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</h3>
                <div id="questionTimerDisplay" class="text-xl font-bold text-orange-500"></div>
            </div>
            <p id="modalQuestion" class="mb-6 text-lg text-gray-700"></p>
            <input type="text" id="modalAnswerInput" class="border border-gray-300 p-3 w-full rounded-lg mb-4 text-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
            <div id="modalFeedback" class="mb-4 text-md font-semibold"></div>
            <div class="flex justify-end space-x-4">
                <button id="modalSubmitButton" class="modal-button modal-submit-button"><i class="fas fa-check mr-2"></i>‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
                <button id="modalCloseButton" class="modal-button modal-close-button"><i class="fas fa-times mr-2"></i>‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>

    <div id="emojiPickerModal" class="emoji-picker-modal">
        <div class="emoji-picker-content">
            <h3 class="text-xl font-bold text-center mb-4 text-gray-700">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Emoji</h3>
            <div id="emojiGrid" class="emoji-grid"></div>
            <button id="closeEmojiPickerBtn" class="mt-4 w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>

    <div id="victoryOverlay" class="victory-overlay hidden">
        <div id="fireworksContainer" class="absolute inset-0 overflow-hidden"></div>
        <div id="winnerNameDisplay" class="text-white text-3xl md:text-4xl lg:text-5xl font-bold p-6 md:p-8 bg-purple-700 bg-opacity-80 rounded-xl shadow-2xl text-center leading-tight">
            </div>
        <button id="playAgainBtn" class="mt-8 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-6 rounded-lg text-lg shadow-md transition-transform transform hover:scale-105">‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á?</button>
    </div>

    <div id="prankModal" class="prank-modal">
        <div class="prank-modal-content">
            <h3 id="prankTitle" class="text-2xl font-bold mb-6 text-center text-purple-600"></h3>
            <div id="prankOptionsContainer" class="mb-4">
                </div>
            <div id="prankButtonsContainer" class="flex justify-center space-x-4">
                </div>
        </div>
    </div>


    <script>
        // --- Game Configuration ---
        const NUM_SQUARES = 50;
        let players = [];
        const defaultPlayerEmojis = ['üöÄ', 'üåü', 'üê¢', 'ü¶ä', 'üòÄ', 'üòÇ', 'üòç', 'ü•≥', 'üçî', 'üçï', '‚öΩÔ∏è', 'üé®', 'üí°', 'üíñ', 'üëç', 'üíØ'];
        const commonEmojisForPicker = [
            'üöÄ', 'üåü', 'üê¢', 'ü¶ä', 'üòÄ', 'üòÇ', 'üòç', 'ü•≥', 'üçî', 'üçï', '‚öΩÔ∏è', 'üé®', 'üí°', 'üíñ', 'üëç', 'üíØ',
            'üòä', 'üòé', 'ü§©', 'ü§î', 'üéâ', 'üéà', 'üéÅ', 'üèÜ', 'üê±', 'üê∂', 'üêº', 'ü¶Ñ', 'ü§ñ', 'üëΩ', 'üëæ', 'üëª',
            'üëë', 'üíé', 'üçÄ', 'üçÑ', 'üçì', 'üçâ', 'üçé', 'üçä', 'üçã', 'üçå', 'üçç', 'ü•≠', 'üçë', 'üçí', 'ü•ù', 'üçÖ'
        ];
        const fireworkColors = ['#FF5252', '#FFC107', '#4CAF50', '#2196F3', '#9C27B0', '#FFEB3B', '#00BCD4', '#E91E63'];

        let currentPlayerIndex = 0;
        let gameActive = false;
        let currentPlayerEmojiSelectionIndex = 0;
        let isHandlingBonusMoveQuestion = false;
        let currentGameQuestionPool = {};
        let pendingAction = null;
        let currentRound = 1;
        let pendingSetbackCard = null;
        let isAnsweringSetbackSave = false;
        let isAnsweringFinalQuestion = false;

        const boardConfig = [
            { type: 'start', text: '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô', icon: 'fas fa-mountain', instruction: '‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢!' },
            { type: 'normal', text: '‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à', icon: 'fas fa-tasks', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à!' },
            { type: 'puzzle', text: '‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤', icon: 'fas fa-question-circle', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤!' },
            { type: 'normal', text: '‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à', icon: 'fas fa-tasks', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à!' },
            { type: 'power-up', text: '‡∏ö‡∏ß‡∏Å‡∏û‡∏•‡∏±‡∏á', icon: 'fas fa-arrow-up', instruction: '‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏û‡∏•‡∏±‡∏á!' },
            { type: 'event', text: '‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå', icon: 'fas fa-users', instruction: '‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô!' }, // Event 1
            { type: 'setback', text: '‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ', icon: 'fas fa-arrow-down', instruction: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏•‡∏á‡πÇ‡∏ó‡∏©‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô!' },
            { type: 'puzzle', text: '‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤', icon: 'fas fa-question-circle', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤!' },
            { type: 'normal', text: '‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à', icon: 'fas fa-tasks', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à!' },
            { type: 'setback', text: '‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ', icon: 'fas fa-arrow-down', instruction: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏•‡∏á‡πÇ‡∏ó‡∏©‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô!' },
            { type: 'normal', text: '‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à', icon: 'fas fa-tasks', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à!' },
            { type: 'power-up', text: '‡∏ö‡∏ß‡∏Å‡∏û‡∏•‡∏±‡∏á', icon: 'fas fa-arrow-up', instruction: '‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏û‡∏•‡∏±‡∏á!' },
            { type: 'puzzle', text: '‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤', icon: 'fas fa-question-circle', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤!' },
            { type: 'setback', text: '‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ', icon: 'fas fa-arrow-down', instruction: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏•‡∏á‡πÇ‡∏ó‡∏©‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô!' },
            { type: 'event', text: '‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå', icon: 'fas fa-users', instruction: '‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô!' }, // Event 2
            { type: 'puzzle', text: '‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤', icon: 'fas fa-question-circle', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤!' },
            { type: 'normal', text: '‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à', icon: 'fas fa-tasks', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à!' },
            { type: 'power-up', text: '‡∏ö‡∏ß‡∏Å‡∏û‡∏•‡∏±‡∏á', icon: 'fas fa-arrow-up', instruction: '‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏û‡∏•‡∏±‡∏á!' },
            { type: 'normal', text: '‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à', icon: 'fas fa-tasks', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à!' },
            { type: 'setback', text: '‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ', icon: 'fas fa-arrow-down', instruction: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏•‡∏á‡πÇ‡∏ó‡∏©‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô!' },
            { type: 'puzzle', text: '‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤', icon: 'fas fa-question-circle', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤!' },
            { type: 'normal', text: '‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à', icon: 'fas fa-tasks', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à!' },
            { type: 'power-up', text: '‡∏ö‡∏ß‡∏Å‡∏û‡∏•‡∏±‡∏á', icon: 'fas fa-wind', instruction: '‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏û‡∏•‡∏±‡∏á!' },
            { type: 'event', text: '‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå', icon: 'fas fa-users', instruction: '‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô!' }, // Event 3
            { type: 'bonus', text: '‡πÇ‡∏ö‡∏ô‡∏±‡∏™', icon: 'fas fa-star', instruction: '‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡πÇ‡∏ö‡∏ô‡∏±‡∏™!' }, // Bonus restored
            { type: 'puzzle', text: '‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤', icon: 'fas fa-question-circle', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤!' },
            { type: 'setback', text: '‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ', icon: 'fas fa-skull-crossbones', instruction: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏•‡∏á‡πÇ‡∏ó‡∏©‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô!' },
            { type: 'normal', text: '‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à', icon: 'fas fa-tasks', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à!' },
            { type: 'power-up', text: '‡∏ö‡∏ß‡∏Å‡∏û‡∏•‡∏±‡∏á', icon: 'fas fa-arrow-up', instruction: '‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏û‡∏•‡∏±‡∏á!' },
            { type: 'puzzle', text: '‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤', icon: 'fas fa-question-circle', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤!' },
            { type: 'normal', text: '‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à', icon: 'fas fa-tasks', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à!' },
            { type: 'setback', text: '‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ', icon: 'fas fa-arrow-down', instruction: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏•‡∏á‡πÇ‡∏ó‡∏©‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô!' },
            { type: 'event', text: '‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå', icon: 'fas fa-users', instruction: '‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô!' }, // Event 4
            { type: 'puzzle', text: '‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤', icon: 'fas fa-question-circle', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤!' },
            { type: 'normal', text: '‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à', icon: 'fas fa-tasks', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à!' },
            { type: 'power-up', text: '‡∏ö‡∏ß‡∏Å‡∏û‡∏•‡∏±‡∏á', icon: 'fas fa-bolt', instruction: '‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏û‡∏•‡∏±‡∏á!' },
            { type: 'normal', text: '‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à', icon: 'fas fa-tasks', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à!' },
            { type: 'setback', text: '‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ', icon: 'fas fa-poo-storm', instruction: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏•‡∏á‡πÇ‡∏ó‡∏©‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô!' },
            { type: 'puzzle', text: '‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤', icon: 'fas fa-question-circle', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤!' },
            { type: 'setback', text: '‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ', icon: 'fas fa-arrow-down', instruction: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏•‡∏á‡πÇ‡∏ó‡∏©‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô!' },
            { type: 'normal', text: '‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à', icon: 'fas fa-tasks', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à!' },
            { type: 'power-up', text: '‡∏ö‡∏ß‡∏Å‡∏û‡∏•‡∏±‡∏á', icon: 'fas fa-shield-alt', instruction: '‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏û‡∏•‡∏±‡∏á!' },
            { type: 'event', text: '‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå', icon: 'fas fa-users', instruction: '‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô!' }, // Event 5
            { type: 'normal', text: '‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à', icon: 'fas fa-tasks', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à!' },
            { type: 'setback', text: '‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ', icon: 'fas fa-arrow-down', instruction: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏•‡∏á‡πÇ‡∏ó‡∏©‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô!' },
            { type: 'normal', text: '‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à', icon: 'fas fa-tasks', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à!' },
            { type: 'puzzle', text: '‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤', icon: 'fas fa-question-circle', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤!' },
            { type: 'normal', text: '‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à', icon: 'fas fa-tasks', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à!' },
            { type: 'normal', text: '‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à', icon: 'fas fa-tasks', instruction: '‡∏´‡∏¢‡∏¥‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à!' },
            { type: 'finish', text: '‡∏¢‡∏≠‡∏î‡πÄ‡∏Ç‡∏≤!', icon: 'fas fa-flag-checkered', instruction: '‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏ô‡∏∞!' }
        ];

        const effectCards = {
            powerUp: [
                { text: "‡πÄ‡∏î‡∏¥‡∏ô‡∏´‡∏ô‡πâ‡∏≤ 2 ‡∏ä‡πà‡∏≠‡∏á", action: "move_forward", value: 2, icon: "fas fa-shoe-prints" },
                { text: "‡πÄ‡∏î‡∏¥‡∏ô‡∏´‡∏ô‡πâ‡∏≤ 3 ‡∏ä‡πà‡∏≠‡∏á", action: "move_forward", value: 3, icon: "fas fa-running" },
                { text: "‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡∏£‡∏≤‡∏∞‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô", action: "get_shield", icon: "fas fa-shield-alt" },
                { text: "‡∏ó‡∏≠‡∏¢‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á", action: "roll_again", icon: "fas fa-dice-d6" }
            ],
            setback: [
                { text: "‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á 3 ‡∏ä‡πà‡∏≠‡∏á", action: "move_backward", value: 3, icon: "fas fa-undo-alt" },
                { text: "‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á 5 ‡∏ä‡πà‡∏≠‡∏á", action: "move_backward", value: 5, icon: "fas fa-angle-double-left" },
                { text: "‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô 1 ‡∏ï‡∏≤", action: "prank_skip_turn", value: 1, icon: "fas fa-user-clock" },
            ],
            bonus: [
                { text: "‡πÄ‡∏î‡∏¥‡∏ô‡πÑ‡∏õ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà 35", action: "go_to_square", value: 34, icon: "fas fa-route" },
                { text: "‡∏ó‡∏≠‡∏¢‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á!", action: "roll_again", icon: "fas fa-redo" }
            ]
        };

        const prankEffects = [
            { text: "‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á 1 ‡∏ä‡πà‡∏≠‡∏á", action: "prank_move_backward", value: 1, icon: "fas fa-user-minus" },
            { text: "‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á 2 ‡∏ä‡πà‡∏≠‡∏á", action: "prank_move_backward", value: 2, icon: "fas fa-users-cog" },
            { text: "‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏ô 1 ‡∏ï‡∏≤", action: "prank_skip_turn", value: 1, icon: "fas fa-user-clock", cost: 10 }
        ];

        const punishmentEffects = [
            { text: "‡∏ñ‡∏≠‡∏¢ 1 ‡∏ä‡πà‡∏≠‡∏á", action: "punish_move_backward", value: 1 },
            { text: "‡∏ñ‡∏≠‡∏¢ 2 ‡∏ä‡πà‡∏≠‡∏á", action: "punish_move_backward", value: 2 },
            { text: "‡∏ñ‡∏≠‡∏¢ 5 ‡∏ä‡πà‡∏≠‡∏á", action: "punish_move_backward", value: 5, for3plusPlayers: true }
        ];
        
        const groupEvents = [
            { 
                text: "‡∏û‡∏≤‡∏¢‡∏∏‡∏™‡∏∏‡∏£‡∏¥‡∏¢‡∏∞! ‡∏Ñ‡∏•‡∏∑‡πà‡∏ô‡πÅ‡∏°‡πà‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏õ‡∏±‡πà‡∏ô‡∏õ‡πà‡∏ß‡∏ô ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á 1 ‡∏ä‡πà‡∏≠‡∏á", 
                action: (players) => {
                    players.forEach(p => {
                        if ((p.position + 1) % 2 !== 0) {
                            p.position = Math.max(0, p.position - 1);
                            p.onBoardPosition = p.position;
                        }
                    });
                    showMessage("‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ö‡∏ô‡∏ä‡πà‡∏≠‡∏á‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏µ‡πà‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á 1 ‡∏ä‡πà‡∏≠‡∏á!", 'info');
                }
            },
            {
                text: "‡∏ù‡∏ô‡∏î‡∏≤‡∏ß‡∏ï‡∏Å! ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÇ‡∏ö‡∏ô‡∏±‡∏™ 15 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!",
                action: (players) => {
                    players.forEach(p => p.score += 15);
                    showMessage("‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö 15 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!", 'success');
                }
            },
            {
                text: "‡πÅ‡∏£‡∏á‡πÇ‡∏ô‡πâ‡∏°‡∏ñ‡πà‡∏ß‡∏á‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥! ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏∏‡∏î (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏Ñ‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô) ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏•‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ó‡πâ‡∏≤‡∏¢‡∏™‡∏∏‡∏î",
                action: (players, currentPlayerIdx) => {
                    if (players.length < 3) {
                        showMessage("‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏•‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á!", 'info');
                        return; 
                    }
                    
                    let sortedPlayers = [...players].sort((a, b) => b.position - a.position);
                    let leader = sortedPlayers[0];
                    let last = sortedPlayers[sortedPlayers.length - 1];
        
                    if (leader.id === players[currentPlayerIdx].id && sortedPlayers.length > 1) {
                        leader = sortedPlayers[1];
                    }
        
                    if (leader && last && leader.id !== last.id) {
                        const tempPos = leader.position;
                        leader.position = last.position;
                        last.position = tempPos;
        
                        leader.onBoardPosition = leader.position;
                        last.onBoardPosition = last.position;
                        showMessage(`${leader.name} ‡∏™‡∏•‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Å‡∏±‡∏ö ${last.name}!`, 'info', 4000);
                    } else {
                        showMessage("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏•‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ", 'info');
                    }
                }
            }
        ];


        // --- Master Question Bank ---
        const allCards = {
            mission: { easy: [], medium: [], hard: [] },
            puzzle: { easy: [], medium: [], hard: [] }
        };
        
        function populateAllCards() {
            allCards.mission.easy = [
                { question: "5 + 11 = ?", answer: "16", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "18 - 7 = ?", answer: "11", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "4 √ó 8 = ?", answer: "32", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "20 √∑ 5 = ?", answer: "4", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-3) + 9 = ?", answer: "6", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "10 + (-4) = ?", answer: "6", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "7 - 12 = ?", answer: "-5", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-5) - 3 = ?", answer: "-8", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "6 √ó (-3) = ?", answer: "-18", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-2) √ó 10 = ?", answer: "-20", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "15 √∑ (-3) = ?", answer: "-5", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-14) √∑ 2 = ?", answer: "-7", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-8) + (-5) = ?", answer: "-13", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-1) √ó (-13) = ?", answer: "13", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-25) √∑ (-5) = ?", answer: "5", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "19 - 9 = ?", answer: "10", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "2 + 15 = ?", answer: "17", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "6 √ó 6 = ?", answer: "36", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "30 √∑ 3 = ?", answer: "10", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "14 + (-14) = ?", answer: "0", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "8 - (-2) = ?", answer: "10", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "0 - 7 = ?", answer: "-7", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-9) + 0 = ?", answer: "-9", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "11 √ó (-1) = ?", answer: "-11", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "45 √∑ 9 = ?", answer: "5", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "17 + 3 = ?", answer: "20", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "20 - 15 = ?", answer: "5", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "7 √ó 5 = ?", answer: "35", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "18 √∑ 6 = ?", answer: "3", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-6) + 16 = ?", answer: "10", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "13 + (-7) = ?", answer: "6", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "9 - 15 = ?", answer: "-6", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-4) - 6 = ?", answer: "-10", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "8 √ó (-4) = ?", answer: "-32", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-5) √ó 7 = ?", answer: "-35", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "21 √∑ (-7) = ?", answer: "-3", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-24) √∑ 3 = ?", answer: "-8", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-9) + (-9) = ?", answer: "-18", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-6) √ó (-5) = ?", answer: "30", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-40) √∑ (-10) = ?", answer: "4", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "22 - 12 = ?", answer: "10", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "4 + 16 = ?", answer: "20", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "9 √ó 3 = ?", answer: "27", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "32 √∑ 4 = ?", answer: "8", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "18 + (-9) = ?", answer: "9", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "11 - (-4) = ?", answer: "15", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "2 - 9 = ?", answer: "-7", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-7) - 7 = ?", answer: "-14", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "12 √ó (-2) = ?", answer: "-24", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "50 √∑ (-5) = ?", answer: "-10", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-3) √ó 11 = ?", answer: "-33", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "36 √∑ 6 = ?", answer: "6", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-12) + 20 = ?", answer: "8", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-8) - (-8) = ?", answer: "0", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-4) √ó (-9) = ?", answer: "36", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "25 + 5 = ?", answer: "30", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "30 - 10 = ?", answer: "20", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "10 √ó 10 = ?", answer: "100", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "100 √∑ 10 = ?", answer: "10", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-15) + 5 = ?", answer: "-10", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "20 + (-10) = ?", answer: "10", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "15 - 20 = ?", answer: "-5", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-1) - 10 = ?", answer: "-11", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "9 √ó (-5) = ?", answer: "-45", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-7) √ó 6 = ?", answer: "-42", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "42 √∑ (-6) = ?", answer: "-7", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-50) √∑ 10 = ?", answer: "-5", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-11) + (-4) = ?", answer: "-15", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-8) √ó (-3) = ?", answer: "24", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-27) √∑ (-9) = ?", answer: "3", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "25 - 5 = ?", answer: "20", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "13 + 7 = ?", answer: "20", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "7 √ó 7 = ?", answer: "49", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "49 √∑ 7 = ?", answer: "7", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "20 + (-20) = ?", answer: "0", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "10 - (-10) = ?", answer: "20", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "0 - 12 = ?", answer: "-12", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-15) + 0 = ?", answer: "-15", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "1 √ó (-15) = ?", answer: "-15", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "60 √∑ 6 = ?", answer: "10", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "19 + 1 = ?", answer: "20", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "21 - 11 = ?", answer: "10", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "8 √ó 5 = ?", answer: "40", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "35 √∑ 5 = ?", answer: "7", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-9) + 19 = ?", answer: "10", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "16 + (-8) = ?", answer: "8", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "14 - 17 = ?", answer: "-3", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-6) - 9 = ?", answer: "-15", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "11 √ó (-3) = ?", answer: "-33", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-4) √ó 12 = ?", answer: "-48", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "33 √∑ (-3) = ?", answer: "-11", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-48) √∑ 4 = ?", answer: "-12", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-10) + (-10) = ?", answer: "-20", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-7) √ó (-4) = ?", answer: "28", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-54) √∑ (-6) = ?", answer: "9", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "28 - 18 = ?", answer: "10", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "9 + 11 = ?", answer: "20", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "12 √ó 3 = ?", answer: "36", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "36 √∑ 9 = ?", answer: "4", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "25 + (-5) = ?", answer: "20", difficulty: "easy", type: "calculation", requiresInput: true, category: "mixed" },
            ];

            allCards.mission.medium = [
                { question: "(-25) + 50 = ?", answer: "25", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "30 - (-15) = ?", answer: "45", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-12) √ó 11 = ?", answer: "-132", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-100) √∑ 25 = ?", answer: "-4", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "50 + (10 √ó (-2)) = ?", answer: "30", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "100 - (40 √∑ 5) = ?", answer: "92", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-15) √ó (-10) = ?", answer: "150", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "75 + (-100) = ?", answer: "-25", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(18 - 8) √ó 5 = ?", answer: "50", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((-20) + 10) √∑ 2 = ?", answer: "-5", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "35 - 5 √ó 4 = ?", answer: "15", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "60 √∑ 10 + 9 = ?", answer: "15", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-40) - (-25) = ?", answer: "-15", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "144 √∑ (-12) = ?", answer: "-12", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-20) √ó 5 + 30 = ?", answer: "-70", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "80 - 30 √∑ (-3) = ?", answer: "90", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "23 + (-43) = ?", answer: "-20", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-19) - 21 = ?", answer: "-40", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "25 √ó (-4) = ?", answer: "-100", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-81) √∑ (-9) = ?", answer: "9", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(5 + (-20)) √ó 3 = ?", answer: "-45", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "12 √ó (10 - 15) = ?", answer: "-60", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "40 - 7 √ó 5 = ?", answer: "5", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "15 + 45 √∑ 9 = ?", answer: "20", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-32) + (-58) = ?", answer: "-90", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "67 - (-33) = ?", answer: "100", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "15 √ó (-12) = ?", answer: "-180", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "120 √∑ (-10) = ?", answer: "-12", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "100 + ((-5) √ó 20) = ?", answer: "0", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "50 - (100 √∑ (-4)) = ?", answer: "75", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(30-50) √ó (-2) = ?", answer: "40", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((-60) + 30) √∑ (-5) = ?", answer: "6", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "28 - 8 √ó 2 = ?", answer: "12", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "72 √∑ 9 + 12 = ?", answer: "20", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-55) + 25 = ?", answer: "-30", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-31) - 49 = ?", answer: "-80", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "30 √ó (-6) = ?", answer: "-180", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-200) √∑ 40 = ?", answer: "-5", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "50 √ó (-2) + 10 = ?", answer: "-90", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "99 - 99 √∑ (-11) = ?", answer: "108", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(45 - 20) √ó 4 = ?", answer: "100", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "20 √ó (12 - 18) = ?", answer: "-120", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "60 - 9 √ó 6 = ?", answer: "6", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "25 + 125 √∑ 5 = ?", answer: "50", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-47) + (-33) = ?", answer: "-80", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "82 - (-18) = ?", answer: "100", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "18 √ó (-10) = ?", answer: "-180", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "150 √∑ (-25) = ?", answer: "-6", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "200 + ((-8) √ó 25) = ?", answer: "0", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "75 - (150 √∑ (-2)) = ?", answer: "150", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(60-100) √ó (-1) = ?", answer: "40", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((-80) + 20) √∑ (-12) = ?", answer: "5", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "42 - 6 √ó 7 = ?", answer: "0", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "81 √∑ 9 + 21 = ?", answer: "30", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-62) + 12 = ?", answer: "-50", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-28) - 72 = ?", answer: "-100", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "40 √ó (-5) = ?", answer: "-200", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-300) √∑ 60 = ?", answer: "-5", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "25 √ó (-4) + 50 = ?", answer: "-50", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "200 - 100 √∑ (-20) = ?", answer: "205", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(32 - 12) √ó 5 = ?", answer: "100", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "15 √ó (10 - 20) = ?", answer: "-150", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "70 - 8 √ó 8 = ?", answer: "6", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "49 + 49 √∑ 7 = ?", answer: "56", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-53) + (-47) = ?", answer: "-100", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "91 - (-9) = ?", answer: "100", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "22 √ó (-5) = ?", answer: "-110", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "196 √∑ (-14) = ?", answer: "-14", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "300 + ((-10) √ó 10) = ?", answer: "200", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "88 - (88 √∑ (-8)) = ?", answer: "99", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(48 - 24) √ó (-3) = ?", answer: "-72", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((-100) + 50) √∑ (-25) = ?", answer: "2", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "56 - 7 √ó 9 = ?", answer: "-7", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "64 √∑ 8 + 32 = ?", answer: "40", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-75) + 25 = ?", answer: "-50", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-44) - 56 = ?", answer: "-100", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "50 √ó (-8) = ?", answer: "-400", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-500) √∑ 100 = ?", answer: "-5", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "150 + ((-25) √ó 4) = ?", answer: "50", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "45 - (90 √∑ (-9)) = ?", answer: "55", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(21-51) √ó(-2) = ?", answer: "60", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((-90)+10) √∑(-8) = ?", answer: "10", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "39-13 √ó 2 = ?", answer: "13", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "144 √∑ 12+13 = ?", answer: "25", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-88)+18 = ?", answer: "-70", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-65)-35 = ?", answer: "-100", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "60 √ó (-3) = ?", answer: "-180", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-180) √∑ 30 = ?", answer: "-6", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "70 √ó (-2)+40 = ?", answer: "-100", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "121-121 √∑ (-11) = ?", answer: "132", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(66-33) √ó 3 = ?", answer: "99", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "30 √ó (15-25) = ?", answer: "-300", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "80-9 √ó 10 = ?", answer: "-10", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "36+144 √∑ 12 = ?", answer: "48", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-99)+(-101) = ?", answer: "-200", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "250-(-50) = ?", answer: "300", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "35 √ó (-10) = ?", answer: "-350", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "225 √∑ (-15) = ?", answer: "-15", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "500+( (-50) √ó 2 ) = ?", answer: "400", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "1-(100 √∑ (-25)) = ?", answer: "5", difficulty: "medium", type: "calculation", requiresInput: true, category: "mixed" },
            ];

            allCards.mission.hard = [
                { question: "(-5) √ó (12 - 7) + 30 = ?", answer: "5", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(100 √∑ (-5)) - (5 √ó 6) = ?", answer: "-50", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((-40) + 15) √ó (18 √∑ (-9)) = ?", answer: "50", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "150 - ((-10) √ó (20-15)) = ?", answer: "200", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((8 - 20) √∑ 3) √ó (-10) = ?", answer: "40", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "-200 √∑ (4 √ó (-5)) - 10 = ?", answer: "0", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-8 - 7) √ó (-2 - 3) = ?", answer: "75", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(50 - (-25)) √∑ ((-10) + 5) = ?", answer: "-15", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "20 √ó (-6) + 100 √∑ (-25) = ?", answer: "-124", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(3 √ó (-15)) + (80 √∑ (-4)) = ?", answer: "-65", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "500 - (20 √ó (-10) + 100) = ?", answer: "600", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((-7) √ó (-9)) - (48 √∑ (-6)) = ?", answer: "71", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "( (27-12) √ó (-4) ) √∑ 15 = ?", answer: "-4", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "1 - ( (10-15) √ó (-2) ) = ?", answer: "-9", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "4 √ó ((-20) √∑ 5) - 14 = ?", answer: "-30", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "100 + (50 √∑ (2-7)) = ?", answer: "90", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((-18) √∑ (-9)) √ó (30-40) = ?", answer: "-20", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(12 √ó 5) - (10 √ó 6) = ?", answer: "0", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "-10 √ó (-10 + (24 √∑ (-3))) = ?", answer: "180", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(55 √∑ (-11)) + (6 √ó (-9)) = ?", answer: "-59", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "300 - (5 √ó (40-60)) = ?", answer: "400", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((-90) √∑ (15-6)) √ó 5 = ?", answer: "-50", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(144 √∑ 12) + (169 √∑ (-13)) = ?", answer: "-1", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "25 √ó (4 - (10 √∑ (-2))) = ?", answer: "225", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((-2) √ó (-3) √ó (-4)) - 10 = ?", answer: "-34", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "75 + (100 √∑ ((-10) - 15)) = ?", answer: "71", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(50 - 150) √ó ((-8) + 6) = ?", answer: "200", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "36 √∑ (2-8) + 42 √∑ (1-8) = ?", answer: "-12", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "120 - ((-6) √ó (-5) √ó (-2)) = ?", answer: "180", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: " ( (100+20) √∑ (-12) ) - 10 = ?", answer: "-20", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: " (-11) √ó (5 - 9) - 50 = ?", answer: "-6", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(1000 √∑ (-20)) - (50 √ó 3) = ?", answer: "-200", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((-60)+12) √ó (25 √∑ (-5)) = ?", answer: "240", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "250 - ((-15) √ó (10-4)) = ?", answer: "340", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((15-45) √∑ 6) √ó (-12) = ?", answer: "60", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "-500 √∑ (10 √ó (-5)) - 20 = ?", answer: "-10", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-9-6) √ó (-4-1) = ?", answer: "75", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(100 - (-50)) √∑ ((-20)+5) = ?", answer: "-10", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "30 √ó (-5) + 200 √∑ (-25) = ?", answer: "-158", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(4 √ó (-20)) + (120 √∑ (-6)) = ?", answer: "-100", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "1000 - (40 √ó (-10)+200) = ?", answer: "1200", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((-8) √ó (-8))-(60 √∑ (-5)) = ?", answer: "76", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((45-25) √ó(-5)) √∑ 20 = ?", answer: "-5", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "10 - ((12-22) √ó(-3)) = ?", answer: "-20", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "5 √ó ((-40) √∑ 8) - 25 = ?", answer: "-50", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "200 + (100 √∑ (4-9)) = ?", answer: "180", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((-36) √∑(-4)) √ó (50-70) = ?", answer: "-180", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(15 √ó 4) - (12 √ó 5) = ?", answer: "0", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "-20 √ó (-5 + (32 √∑ (-4))) = ?", answer: "260", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(121 √∑ (-11)) + (8 √ó (-7)) = ?", answer: "-67", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "400 - (10 √ó (20-50)) = ?", answer: "700", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((-120) √∑ (20-8)) √ó 6 = ?", answer: "-60", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(196 √∑ 14) + (225 √∑ (-15)) = ?", answer: "-1", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "30 √ó (5 - (20 √∑ (-4))) = ?", answer: "300", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((-1) √ó (-2) √ó (-5)) - 15 = ?", answer: "-25", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "90 + (200 √∑ ((-20) - 5)) = ?", answer: "82", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(60-120) √ó ((-10)+7) = ?", answer: "180", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "45 √∑ (3-12) + 56 √∑ (2-9) = ?", answer: "-13", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "150 - ((-7) √ó (-5) √ó (-2)) = ?", answer: "220", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((200+40) √∑ (-24)) - 20 = ?", answer: "-30", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-12) √ó (1-8) - 100 = ?", answer: "-16", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(2000 √∑ (-40)) - (10 √ó 20) = ?", answer: "-250", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((-80)+20) √ó (36 √∑ (-6)) = ?", answer: "360", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "300 - ((-20) √ó (12-5)) = ?", answer: "440", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((25-75) √∑ 10) √ó (-15) = ?", answer: "75", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "-1000 √∑ (20 √ó (-5)) - 30 = ?", answer: "-20", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-10-5) √ó (-3-2) = ?", answer: "75", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(200 - (-100)) √∑ ((-30)+15) = ?", answer: "-20", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "40 √ó (-4) + 300 √∑ (-30) = ?", answer: "-170", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(5 √ó (-15))+(150 √∑ (-5)) = ?", answer: "-105", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "2000 - (50 √ó (-20)+500) = ?", answer: "2500", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((-9) √ó (-9)) - (81 √∑ (-9)) = ?", answer: "90", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((54-24) √ó (-3)) √∑ 9 = ?", answer: "-10", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "20 - ((25-40) √ó (-2)) = ?", answer: "-10", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "6 √ó ((-50) √∑ 10) - 30 = ?", answer: "-60", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "300+(250 √∑(5-30)) = ?", answer: "290", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((-48) √∑(-8)) √ó(10-30) = ?", answer: "-120", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(20 √ó 3) - (30 √ó 2) = ?", answer: "0", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "-30 √ó (-10 + (45 √∑ (-5))) = ?", answer: "570", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(144 √∑ (-12)) + (10 √ó (-10)) = ?", answer: "-112", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "500 - (2 √ó (100-200)) = ?", answer: "700", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((-200) √∑ (25-5)) √ó 7 = ?", answer: "-70", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(400 √∑ 20) + (800 √∑ (-40)) = ?", answer: "0", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "50 √ó (1 - (40 √∑ (-8))) = ?", answer: "300", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((-5) √ó (-4) √ó (-2)) - 20 = ?", answer: "-60", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "125 + (500 √∑ ((-30)-20)) = ?", answer: "115", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(100-200) √ó ((-5)+2) = ?", answer: "300", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "60 √∑ (5-15) + 70 √∑ (3-10) = ?", answer: "-16", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "240 - ((-8) √ó (-5) √ó (-3)) = ?", answer: "360", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: " ( (300+60) √∑ (-36) ) - 30 = ?", answer: "-40", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: " (-15) √ó (2-10) - 20 = ?", answer: "100", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(3000 √∑ (-50)) - (20 √ó 5) = ?", answer: "-160", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((-100)+25) √ó (49 √∑ (-7)) = ?", answer: "525", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "450 - ((-25) √ó (20-10)) = ?", answer: "700", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "((30-90) √∑ 12) √ó (-11) = ?", answer: "55", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "-800 √∑ (40 √ó (-2)) - 40 = ?", answer: "-30", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(-12-8) √ó (-5-5) = ?", answer: "200", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(300 - (-150)) √∑ ((-40)+10) = ?", answer: "-15", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "50 √ó (-3) + 400 √∑ (-20) = ?", answer: "-170", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
                { question: "(6 √ó (-25)) + (200 √∑ (-8)) = ?", answer: "-175", difficulty: "hard", type: "calculation", requiresInput: true, category: "mixed" },
            ];
            
            //--- NEW PUZZLE CARDS ---
            // NOTE: The following are sample questions. You can add up to 100 for each difficulty level.
            allCards.puzzle.easy = [
                { question: "(-5) + 12 = ?", choices: [7, -7, 17, -17], answer: 7, difficulty: 'easy', type: 'multiple_choice' },
                { question: "10 - (-4) = ?", choices: [6, -6, 14, -14], answer: 14, difficulty: 'easy', type: 'multiple_choice' },
                { question: "(-8) √ó 3 = ?", choices: [-24, 24, -5, 11], answer: -24, difficulty: 'easy', type: 'multiple_choice' },
                { question: "(-20) √∑ (-5) = ?", choices: [4, -4, 25, -15], answer: 4, difficulty: 'easy', type: 'multiple_choice' },
                { question: "6 + (-15) = ?", choices: [-9, 9, 21, -21], answer: -9, difficulty: 'easy', type: 'multiple_choice' },
                { question: "7 - 18 = ?", choices: [-11, 11, 25, -25], answer: -11, difficulty: 'easy', type: 'multiple_choice' },
                { question: "(-9) √ó (-6) = ?", choices: [54, -54, -15, 3], answer: 54, difficulty: 'easy', type: 'multiple_choice' },
                { question: "32 √∑ (-4) = ?", choices: [-8, 8, 28, -36], answer: -8, difficulty: 'easy', type: 'multiple_choice' },
                { question: "(-13) + (-8) = ?", choices: [-21, 21, -5, 5], answer: -21, difficulty: 'easy', type: 'multiple_choice' },
                { question: "15 - 8 = ?", choices: [7, -7, 23, -23], answer: 7, difficulty: 'easy', type: "multiple_choice" },
                { question: "5 √ó (-11) = ?", choices: [-55, 55, -6, 16], answer: -55, difficulty: "easy", type: "multiple_choice" },
                { question: "(-48) √∑ 6 = ?", choices: [-8, 8, -42, -54], answer: -8, difficulty: "easy", type: "multiple_choice" },
                { question: "(-3) + 20 = ?", choices: [17, -17, -23, 23], answer: 17, difficulty: "easy", type: "multiple_choice" },
                { question: "9 - (-9) = ?", choices: [18, 0, -18, 1], answer: 18, difficulty: "easy", type: "multiple_choice" },
                { question: "(-7) √ó (-7) = ?", choices: [49, -49, 0, 14], answer: 49, difficulty: "easy", type: "multiple_choice" },
                // Add up to 100 questions here
            ];

            allCards.puzzle.medium = [
                { question: "(8 - 12) √ó 5 = ?", choices: [-20, 20, -16, -28], answer: -20, difficulty: 'medium', type: 'multiple_choice' },
                { question: "30 √∑ ((-2) - 3) = ?", choices: [-6, 6, -10, 10], answer: -6, difficulty: 'medium', type: 'multiple_choice' },
                { question: "(-4) √ó 5 + 10 = ?", choices: [-10, 10, -30, -25], answer: -10, difficulty: 'medium', type: 'multiple_choice' },
                { question: "50 - 10 √ó 2 = ?", choices: [30, 80, 40, 60], answer: 30, difficulty: 'medium', type: 'multiple_choice' },
                { question: "(-5) + (-8) - 10 = ?", choices: [-23, 23, 3, -7], answer: -23, difficulty: 'medium', type: 'multiple_choice' },
                { question: "100 √∑ (-5) + 8 = ?", choices: [-12, -28, 12, 28], answer: -12, difficulty: 'medium', type: 'multiple_choice' },
                { question: "(5 - 9) √ó (2 + 3) = ?", choices: [-20, 20, 35, -35], answer: -20, difficulty: 'medium', type: 'multiple_choice' },
                { question: "6 √ó (-3) - (-5) = ?", choices: [-13, -23, 13, 23], answer: -13, difficulty: 'medium', type: 'multiple_choice' },
                { question: "40 - (15 √∑ (-3)) = ?", choices: [45, 35, -25, 25], answer: 45, difficulty: 'medium', type: 'multiple_choice' },
                { question: "(-1 - 2) * (-3 - 4) = ?", choices: [21, -21, 10, -10], answer: 21, difficulty: "medium", type: "multiple_choice" },
                { question: "20 + 5 * (-2) = ?", choices: [10, -30, 30, -10], answer: 10, difficulty: "medium", type: "multiple_choice" },
                { question: "((-10) + 4) √∑ 2 = ?", choices: [-3, -7, 3, 7], answer: -3, difficulty: "medium", type: "multiple_choice" },
                { question: "8 - (3 * (-4)) = ?", choices: [20, -4, 20, -20], answer: 20, difficulty: "medium", type: "multiple_choice" },
                { question: "(-15 / 3) + (-10 / 2) = ?", choices: [-10, 0, -5, 5], answer: -10, difficulty: "medium", type: "multiple_choice" },
                { question: "7 * ((-2) - (-5)) = ?", choices: [21, -21, -49, 49], answer: 21, difficulty: "medium", type: "multiple_choice" },
                // Add up to 100 questions here
            ];

            allCards.puzzle.hard = [
                { question: "‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ï‡∏≠‡∏ô‡πÄ‡∏ä‡πâ‡∏≤ 5¬∞C ‡∏ï‡∏≠‡∏ô‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô 10¬∞C ‡πÅ‡∏•‡∏∞‡∏ï‡∏≠‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏•‡∏î‡∏•‡∏á 18¬∞C ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ï‡∏≠‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î?", choices: ["-3¬∞C", "3¬∞C", "33¬∞C", "-13¬∞C"], answer: "-3¬∞C", difficulty: 'hard', type: 'multiple_choice' },
                { question: "‡∏°‡∏≤‡∏ô‡∏µ‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô 200 ‡∏ö‡∏≤‡∏ó ‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏ô‡∏°‡πÑ‡∏õ 3 ‡∏ä‡∏¥‡πâ‡∏ô ‡∏ä‡∏¥‡πâ‡∏ô‡∏•‡∏∞ 15 ‡∏ö‡∏≤‡∏ó ‡πÅ‡∏•‡∏∞‡∏ã‡∏∑‡πâ‡∏≠‡∏ô‡πâ‡∏≥ 1 ‡∏Ç‡∏ß‡∏î ‡∏£‡∏≤‡∏Ñ‡∏≤ 25 ‡∏ö‡∏≤‡∏ó ‡∏°‡∏≤‡∏ô‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?", choices: ["130 ‡∏ö‡∏≤‡∏ó", "150 ‡∏ö‡∏≤‡∏ó", "160 ‡∏ö‡∏≤‡∏ó", "110 ‡∏ö‡∏≤‡∏ó"], answer: "130 ‡∏ö‡∏≤‡∏ó", difficulty: 'hard', type: 'multiple_choice' },
                { question: "‡πÄ‡∏£‡∏∑‡∏≠‡∏î‡∏≥‡∏ô‡πâ‡∏≥‡∏≠‡∏¢‡∏π‡πà‡∏•‡∏∂‡∏Å -80 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏î‡∏≥‡∏•‡∏á‡πÑ‡∏õ‡∏≠‡∏µ‡∏Å 50 ‡πÄ‡∏°‡∏ï‡∏£ ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤ 60 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏∑‡∏≠‡∏î‡∏≥‡∏ô‡πâ‡∏≥‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∂‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î?", choices: ["-70 ‡πÄ‡∏°‡∏ï‡∏£", "-90 ‡πÄ‡∏°‡∏ï‡∏£", "-190 ‡πÄ‡∏°‡∏ï‡∏£", "30 ‡πÄ‡∏°‡∏ï‡∏£"], answer: "-70 ‡πÄ‡∏°‡∏ï‡∏£", difficulty: 'hard', type: 'multiple_choice' },
                { question: "‡∏™‡∏°‡∏ä‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡∏µ‡πâ 500 ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏Ç‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏≤ 1,200 ‡∏ö‡∏≤‡∏ó ‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏Ç‡∏≤‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡πÑ‡∏õ‡∏≠‡∏µ‡∏Å 300 ‡∏ö‡∏≤‡∏ó ‡∏™‡∏°‡∏ä‡∏≤‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?", choices: ["400 ‡∏ö‡∏≤‡∏ó", "700 ‡∏ö‡∏≤‡∏ó", "1,400 ‡∏ö‡∏≤‡∏ó", "900 ‡∏ö‡∏≤‡∏ó"], answer: "400 ‡∏ö‡∏≤‡∏ó", difficulty: 'hard', type: 'multiple_choice' },
                { question: "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡πÑ‡∏î‡πâ 15 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å 5 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á 8 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≤‡∏°‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î?", choices: ["43 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô", "38 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô", "33 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô", "48 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô"], answer: "43 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô", difficulty: 'hard', type: 'multiple_choice' },
                { question: "‡∏ï‡∏∂‡∏Å‡∏°‡∏µ 20 ‡∏ä‡∏±‡πâ‡∏ô ‡∏ô‡∏≤‡∏¢ A ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ä‡∏±‡πâ‡∏ô 15 ‡πÄ‡∏Ç‡∏≤‡∏•‡∏á‡∏•‡∏¥‡∏ü‡∏ï‡πå‡πÑ‡∏õ 8 ‡∏ä‡∏±‡πâ‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡∏≠‡∏µ‡∏Å 12 ‡∏ä‡∏±‡πâ‡∏ô ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏ô‡∏≤‡∏¢ A ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ä‡∏±‡πâ‡∏ô‡πÉ‡∏î?", choices: ["‡∏ä‡∏±‡πâ‡∏ô 19", "‡∏ä‡∏±‡πâ‡∏ô 7", "‡∏ä‡∏±‡πâ‡∏ô 5", "‡∏ä‡∏±‡πâ‡∏ô 20"], answer: "‡∏ä‡∏±‡πâ‡∏ô 19", difficulty: 'hard', type: 'multiple_choice' },
                { question: "‡∏û‡πà‡∏≠‡∏Ñ‡πâ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏°‡∏≤ 1,000 ‡∏ö‡∏≤‡∏ó ‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡πÑ‡∏£ 300 ‡∏ö‡∏≤‡∏ó ‡πÅ‡∏ï‡πà‡∏°‡∏µ‡∏ú‡∏•‡πÑ‡∏°‡πâ‡πÄ‡∏ô‡πà‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô 150 ‡∏ö‡∏≤‡∏ó ‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏û‡πà‡∏≠‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡πÑ‡∏£‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î?", choices: ["‡∏Å‡∏≥‡πÑ‡∏£ 150 ‡∏ö‡∏≤‡∏ó", "‡∏Å‡∏≥‡πÑ‡∏£ 300 ‡∏ö‡∏≤‡∏ó", "‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô 150 ‡∏ö‡∏≤‡∏ó", "‡∏Å‡∏≥‡πÑ‡∏£ 450 ‡∏ö‡∏≤‡∏ó"], answer: "‡∏Å‡∏≥‡πÑ‡∏£ 150 ‡∏ö‡∏≤‡∏ó", difficulty: 'hard', type: 'multiple_choice' },
                { question: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ö‡∏¥‡∏ô ‡∏ö‡∏¥‡∏ô‡∏™‡∏π‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏ó‡∏∞‡πÄ‡∏• 10,000 ‡∏ü‡∏∏‡∏ï ‡∏•‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏•‡∏á 2,500 ‡∏ü‡∏∏‡∏ï ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡πÑ‡∏ï‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡∏≠‡∏µ‡∏Å 1,000 ‡∏ü‡∏∏‡∏ï ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ö‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î?", choices: ["8,500 ‡∏ü‡∏∏‡∏ï", "7,500 ‡∏ü‡∏∏‡∏ï", "11,500 ‡∏ü‡∏∏‡∏ï", "9,500 ‡∏ü‡∏∏‡∏ï"], answer: "8,500 ‡∏ü‡∏∏‡∏ï", difficulty: 'hard', type: 'multiple_choice' },
                { question: "‡∏õ‡∏¥‡∏ï‡∏¥‡∏°‡∏µ‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏° -50 ‡πÅ‡∏ï‡πâ‡∏° ‡πÄ‡∏Ç‡∏≤‡∏ó‡∏≥‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÑ‡∏î‡πâ‡πÅ‡∏ï‡πâ‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏° 3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡∏∞ 20 ‡πÅ‡∏ï‡πâ‡∏° ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏õ‡∏¥‡∏ï‡∏¥‡∏°‡∏µ‡πÅ‡∏ï‡πâ‡∏°‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î?", choices: ["10 ‡πÅ‡∏ï‡πâ‡∏°", "-10 ‡πÅ‡∏ï‡πâ‡∏°", "110 ‡πÅ‡∏ï‡πâ‡∏°", "60 ‡πÅ‡∏ï‡πâ‡∏°"], answer: "10 ‡πÅ‡∏ï‡πâ‡∏°", difficulty: 'hard', type: 'multiple_choice' },
                { question: "‡πÉ‡∏ô‡πÄ‡∏Å‡∏°‡πÜ‡∏´‡∏ô‡∏∂‡πà‡∏á ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏°‡∏µ 0 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡∏ñ‡πâ‡∏≤‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡πÑ‡∏î‡πâ 5 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î‡∏ï‡∏¥‡∏î‡∏•‡∏ö 3 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ‡∏™‡∏°‡∏®‡∏£‡∏µ‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å 4 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î 5 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏™‡∏°‡∏®‡∏£‡∏µ‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î?", choices: ["5 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô", "20 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô", "15 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô", "-5 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô"], answer: "5 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô", difficulty: 'hard', type: 'multiple_choice' },
                // Add up to 100 questions here
            ];

            console.log("Static question bank populated.");
        }


        const gameSounds = {
            diceRoll: new Audio("sounds/dice_roll.mp3"),
            playerMove: new Audio("sounds/player_move.mp3"),
            correctAnswer: new Audio("sounds/correct.mp3"),
            incorrectAnswer: new Audio("sounds/incorrect.mp3"),
            powerUp: new Audio("sounds/power_up.mp3"),
            setback: new Audio("sounds/setback.mp3"),
            bonus: new Audio("sounds/bonus.mp3"),
            cardSelect: new Audio("sounds/card_select.mp3"),
            victory: new Audio("sounds/victory.mp3"),
            buttonClick: new Audio("sounds/button_click.mp3"),
            prank: new Audio("sounds/prank_effect.mp3"),
            countdownTick: new Audio("sounds/countdown_tick.mp3")
        };

        function playSound(soundName) {
            const sound = gameSounds[soundName];
            if (sound) {
                sound.currentTime = 0;
                sound.play().catch(error => {
                    console.warn(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á "${soundName}" ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥: `, error);
                });
            } else {
                console.warn(`‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á: ${soundName}`);
            }
        }

        const gameSetupScreen = document.getElementById('gameSetupScreen');
        const boardContainer = document.getElementById('boardContainer');
        const numPlayersSelect = document.getElementById('numPlayersSelect');
        const playerConfigArea = document.getElementById('playerConfigArea');
        const startGameBtn = document.getElementById('startGameBtn');
        const gameBoard = document.getElementById('gameBoard');
        const rollDiceButton = document.getElementById('rollDiceButton');
        const messageArea = document.getElementById('messageArea');
        const centralMessageOverlay = document.getElementById('centralMessageOverlay');
        const centralMessageContent = document.getElementById('centralMessageContent');
        const cardSelectionModal = document.getElementById('cardSelectionModal');
        const cardSelectionTitle = document.getElementById('cardSelectionTitle');
        const cardSelectionGrid = document.getElementById('cardSelectionGrid');
        const playersInfoPanel = document.getElementById('playersInfoPanel');
        const currentPlayerTurnDisplay = document.getElementById('currentPlayerTurn');
        const currentRoundCounterDisplay = document.getElementById('currentRoundCounter');
        const movementDieValueDisplay = document.getElementById('movementDieValue');
        const modal = document.getElementById('questionModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalQuestion = document.getElementById('modalQuestion');
        const modalAnswerInput = document.getElementById('modalAnswerInput');
        const modalSubmitButton = document.getElementById('modalSubmitButton');
        const modalCloseButton = document.getElementById('modalCloseButton');
        const modalFeedback = document.getElementById('modalFeedback');
        const emojiPickerModal = document.getElementById('emojiPickerModal');
        const emojiGrid = document.getElementById('emojiGrid');
        const closeEmojiPickerBtn = document.getElementById('closeEmojiPickerBtn');
        const victoryOverlay = document.getElementById('victoryOverlay');
        const fireworksContainer = document.getElementById('fireworksContainer');
        const winnerNameDisplay = document.getElementById('winnerNameDisplay');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const prankModal = document.getElementById('prankModal');
        const prankTitle = document.getElementById('prankTitle');
        const prankOptionsContainer = document.getElementById('prankOptionsContainer');
        const prankButtonsContainer = document.getElementById('prankButtonsContainer');
        const backgroundMusicElement = document.getElementById('backgroundMusic');
        const diceAnimationOverlay = document.getElementById('diceAnimationOverlay');
        const diceAnimationValue = document.getElementById('diceAnimationValue');
        const diceAnimationText = document.getElementById('diceAnimationText');
        const welcomeScreenModal = document.getElementById('welcomeScreenModal');
        const readyButton = document.getElementById('readyButton');
        const heartbeatOverlay = document.getElementById('heartbeatOverlay'); 


        let currentCardData = null;
        let cardsForSelection = [];
        let currentEffectCards = [];
        let questionTimerInterval = null;
        let timeLeft = 0;
        const QUESTION_TIME_LIMIT = 30;


        readyButton.addEventListener('click', () => {
            playSound('buttonClick');
            welcomeScreenModal.style.display = 'none';
            gameSetupScreen.classList.remove('hidden');
            createPlayerConfigInputs(parseInt(numPlayersSelect.value));
        });

        function createPlayerConfigInputs(num) {
            playerConfigArea.innerHTML = '';
            for (let i = 0; i < num; i++) {
                const entryDiv = document.createElement('div');
                entryDiv.classList.add('player-config-entry', 'p-3', 'bg-gray-50', 'rounded-lg', 'shadow-sm');
                entryDiv.innerHTML = `
                    <label class="font-semibold text-gray-700 w-1/4">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô ${i + 1}:</label>
                    <button type="button" class="player-emoji-select-btn" data-player-index="${i}">${defaultPlayerEmojis[i] || 'üòÉ'}</button>
                    <input type="text" class="player-name-input setup-input flex-grow" placeholder="‡∏ä‡∏∑‡πà‡∏≠ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)">
                `;
                playerConfigArea.appendChild(entryDiv);
            }
            document.querySelectorAll('.player-emoji-select-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    playSound('buttonClick');
                    currentPlayerEmojiSelectionIndex = parseInt(e.target.dataset.playerIndex);
                    openEmojiPicker();
                });
            });
        }
        function openEmojiPicker() {
            emojiGrid.innerHTML = '';
            commonEmojisForPicker.forEach(emoji => {
                const btn = document.createElement('button');
                btn.classList.add('emoji-btn');
                btn.textContent = emoji;
                btn.addEventListener('click', () => { playSound('buttonClick'); selectEmoji(emoji); });
                emojiGrid.appendChild(btn);
            });
            emojiPickerModal.style.display = 'flex';
        }
        function selectEmoji(emoji) {
            const playerEmojiButton = document.querySelector(`.player-emoji-select-btn[data-player-index="${currentPlayerEmojiSelectionIndex}"]`);
            if (playerEmojiButton) { playerEmojiButton.textContent = emoji; }
            emojiPickerModal.style.display = 'none';
        }
        closeEmojiPickerBtn.addEventListener('click', () => { playSound('buttonClick'); emojiPickerModal.style.display = 'none'; });
        numPlayersSelect.addEventListener('change', (e) => { playSound('buttonClick'); createPlayerConfigInputs(parseInt(e.target.value)); });

        function getCurrentDifficulty(playerPosition) {
            if (playerPosition < 15) {
                return 'easy';
            } else if (playerPosition < 35) {
                return 'medium';
            } else {
                return 'hard';
            }
        }

        startGameBtn.addEventListener('click', () => {
            playSound('buttonClick');
            const num = parseInt(numPlayersSelect.value);

            const emojiButtons = document.querySelectorAll('.player-emoji-select-btn');
            const nameInputs = document.querySelectorAll('.player-name-input');

            players = [];
            for (let i = 0; i < num; i++) {
                players.push({
                    id: i + 1,
                    name: nameInputs[i].value.trim() || `‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô ${i + 1}`,
                    emoji: emojiButtons[i].textContent.trim(),
                    position: 0,
                    onBoardPosition: 0,
                    score: 0, 
                    hasShield: false,
                    extraTurnsToTake: 0,
                    hasBeenPrankedThisRound: false
                });
            }

            currentGameQuestionPool = JSON.parse(JSON.stringify(allCards));
            currentRound = 1;
            document.getElementById('currentRoundCounter').textContent = currentRound;

            gameSetupScreen.classList.add('hidden');
            boardContainer.classList.remove('hidden');
            victoryOverlay.style.display = 'none';
            fireworksContainer.innerHTML = '';
            gameActive = true;
            currentPlayerIndex = 0;
            initializeBoard();
            initializePlayersInfoPanel();
            showMessage(`‡πÄ‡∏Å‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô! ‡∏ï‡∏≤‡∏Ç‡∏≠‡∏á ${players[currentPlayerIndex].name}`, 'turn_info');
            rollDiceButton.disabled = false;

            if (backgroundMusicElement) {
                backgroundMusicElement.src = "sounds/background_music.mp3";
                backgroundMusicElement.volume = 0.1;
                backgroundMusicElement.play().catch(error => console.warn("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥:", error));
            }
        });

        playAgainBtn.addEventListener('click', () => {
            playSound('buttonClick');
            if (backgroundMusicElement) { backgroundMusicElement.pause(); backgroundMusicElement.currentTime = 0; }
            victoryOverlay.style.display = 'none';
            fireworksContainer.innerHTML = '';
            boardContainer.classList.add('hidden');
            welcomeScreenModal.style.display = 'flex';
            gameSetupScreen.classList.add('hidden');
            createPlayerConfigInputs(parseInt(numPlayersSelect.value));
        });

        // --- Game Logic Functions ---
        function initializeBoard() {
            gameBoard.innerHTML = '';
            const numRows = 5;
            const numCols = 10;
            for (let i = 0; i < NUM_SQUARES; i++) {
                const squareData = boardConfig[i];
                const squareDiv = document.createElement('div');
                squareDiv.id = `square-${i}`;
                squareDiv.classList.add('board-square', `${squareData.type}-square`);

                const visualRowFromBottom = Math.floor(i / numCols);
                let visualColInRow;
                if (visualRowFromBottom % 2 === 0) {
                    visualColInRow = i % numCols;
                } else {
                    visualColInRow = (numCols - 1) - (i % numCols);
                }

                const cssGridRow = numRows - visualRowFromBottom;
                const cssGridColumn = visualColInRow + 1;

                squareDiv.style.gridRowStart = cssGridRow;
                squareDiv.style.gridColumnStart = cssGridColumn;


                squareDiv.innerHTML = `
                    <span class="square-number">${i + 1}</span>
                    <i class="${squareData.icon} square-icon"></i>
                    <span class="square-text">${squareData.text}</span>
                    <div class="player-slots-container" id="slots-sq-${i}"></div>
                `;
                gameBoard.appendChild(squareDiv);
            }
            renderPlayerPieces();
        }

        function initializePlayersInfoPanel() {
            playersInfoPanel.innerHTML = '';
            players.forEach(player => {
                const playerInfoDiv = document.createElement('div');
                playerInfoDiv.id = `player${player.id}InfoDisplay`;
                playerInfoDiv.classList.add('text-lg', 'mb-2', 'p-2', 'border', 'border-gray-200', 'rounded-lg');
                playerInfoDiv.innerHTML = `
                    <div class="font-bold">${player.name} (${player.emoji})</div>
                    <div>‡∏ä‡πà‡∏≠‡∏á: <span id="player${player.id}Pos" class="font-bold">1</span>
                    <span id="player${player.id}ShieldIcon" class="ml-2">${player.hasShield ? '<i class="fas fa-shield-alt text-blue-500"></i>' : ''}</span></div>
                    <div><i class="fas fa-star text-yellow-500"></i> ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="player${player.id}Score" class="font-bold">0</span></div>
                `;
                playersInfoPanel.appendChild(playerInfoDiv);
            });
            updatePlayerInfo();
        }

        function renderPlayerPieces() {
            document.querySelectorAll('.player-piece').forEach(p => p.remove());
            players.forEach(player => {
                if (player.onBoardPosition < NUM_SQUARES && player.onBoardPosition >= 0) {
                    const slotsContainer = document.getElementById(`slots-sq-${player.onBoardPosition}`);
                    if (slotsContainer) {
                        const pieceDiv = document.createElement('div');
                        pieceDiv.classList.add('player-piece');
                        pieceDiv.textContent = player.emoji;
                        slotsContainer.appendChild(pieceDiv);
                        pieceDiv.classList.add('player-piece-landed');
                        playSound('playerMove');
                        setTimeout(() => {
                            if (pieceDiv) pieceDiv.classList.remove('player-piece-landed');
                        }, 700);
                    }
                }
            });
        }
        
        function updatePlayerInfo() {
            players.forEach(player => {
                const posDisplay = document.getElementById(`player${player.id}Pos`);
                if (posDisplay) { posDisplay.textContent = player.position + 1; }

                const shieldIconDisplay = document.getElementById(`player${player.id}ShieldIcon`);
                if (shieldIconDisplay) { shieldIconDisplay.innerHTML = player.hasShield ? '<i class="fas fa-shield-alt text-blue-500" title="‡∏°‡∏µ‡πÄ‡∏Å‡∏£‡∏≤‡∏∞‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô"></i>' : '';}
                
                const scoreDisplay = document.getElementById(`player${player.id}Score`);
                if (scoreDisplay) { scoreDisplay.textContent = player.score; }
            });
            if (players.length > 0 && players[currentPlayerIndex]) {
                 currentPlayerTurnDisplay.textContent = players[currentPlayerIndex].name;
            } else { currentPlayerTurnDisplay.textContent = "-"; }
            currentRoundCounterDisplay.textContent = currentRound;
        }

        function showMessage(msg, type = 'info', duration = 3500) {
            const bottomMessageArea = document.getElementById('messageArea');
            const centralOverlay = document.getElementById('centralMessageOverlay');
            const centralContent = document.getElementById('centralMessageContent');

            if (type === 'turn_info') {
                bottomMessageArea.textContent = msg;
                bottomMessageArea.className = 'mt-6 p-5 bg-blue-100 text-blue-800 rounded-xl shadow-lg text-center text-lg min-h-[60px]';
            } else {
                centralContent.innerHTML = `<p class="text-2xl font-semibold ${type === 'success' ? 'text-green-600' : type === 'error' ? 'text-red-600' : 'text-indigo-600'}">${msg}</p>`;
                centralOverlay.style.display = 'flex';
                setTimeout(() => {
                    centralOverlay.style.display = 'none';
                }, duration);
            }
        }


        function rollMainGameDie() { return getRandomInt(-3, 9); }
        function getRandomInt(min, max) { min = Math.ceil(min); max = Math.floor(max); return Math.floor(Math.random() * (max - min + 1)) + min; }

        async function animateDiceRoll(finalRollFunction, duration = 1500, intervalTime = 100) {
            playSound('diceRoll');
            diceAnimationOverlay.style.display = 'flex';
            diceAnimationText.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≠‡∏¢‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤...";
            diceAnimationValue.textContent = '?';

            return new Promise(resolve => {
                let rollCount = 0;
                const maxRolls = Math.floor(duration / intervalTime);
                const animationInterval = setInterval(() => {
                    diceAnimationValue.textContent = getRandomInt(-3, 9);
                    rollCount++;
                    if (rollCount >= maxRolls) {
                        clearInterval(animationInterval);
                        const finalValue = finalRollFunction();
                        diceAnimationText.textContent = "‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≠‡∏¢‡πÑ‡∏î‡πâ:";
                        diceAnimationValue.textContent = finalValue;
                        movementDieValueDisplay.textContent = finalValue;
                        setTimeout(() => {
                           diceAnimationOverlay.style.display = 'none';
                        }, 1500);
                        resolve(finalValue);
                    }
                }, intervalTime);
            });
        }
        rollDiceButton.addEventListener('click', async () => {
            if (!gameActive || modal.style.display === 'flex' || cardSelectionModal.style.display === 'flex' || prankModal.style.display === 'flex' || !players[currentPlayerIndex]) return;
            playSound('buttonClick');
            rollDiceButton.disabled = true;

            movementDieResult = await animateDiceRoll(rollMainGameDie);

            setTimeout(() => {
                setTimeout(() => { movePlayer(movementDieResult, false); }, 100);
            }, 1600);
        });

        async function movePlayer(steps, isBonusMove = false) {
            if (!players[currentPlayerIndex]) return;
            const player = players[currentPlayerIndex];
            let targetPosition = player.position + steps;

            if (targetPosition >= NUM_SQUARES - 1) targetPosition = NUM_SQUARES - 1;
            if (targetPosition < 0) targetPosition = 0;

            if (steps < 0 && player.hasShield) {
                showMessage(`${player.name} ‡∏°‡∏µ‡πÄ‡∏Å‡∏£‡∏≤‡∏∞‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô! ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ`, 'success', 3000);
                player.hasShield = false;
                updatePlayerInfo();
                switchTurn();
                return;
            }

            await new Promise(resolve => setTimeout(resolve, 100));

            const moveInterval = 350;
            let currentDisplayPosition = player.onBoardPosition;
            const stepDirection = (targetPosition > currentDisplayPosition) ? 1 : -1;

            function animateStep() {
                if (currentDisplayPosition !== targetPosition) {
                    currentDisplayPosition += stepDirection;
                    player.onBoardPosition = currentDisplayPosition;
                    renderPlayerPieces();
                    setTimeout(animateStep, moveInterval);
                } else {
                    player.position = targetPosition;
                    renderPlayerPieces();
                    updatePlayerInfo();

                    setTimeout(() => {
                        const finalSquare = boardConfig[player.position];
                        if (!isBonusMove) {
                            handleSquareAction(player.position);
                        } else {
                            if (finalSquare.type === 'normal' || finalSquare.type === 'puzzle') {
                                isHandlingBonusMoveQuestion = true;
                                handleSquareAction(player.position);
                            } else if (finalSquare.type === 'finish') {
                                handleSquareAction(player.position);
                            } else {
                                switchTurn();
                            }
                        }
                    }, 500);
                }
            }

            if (player.onBoardPosition !== targetPosition) {
                animateStep();
            } else {
                if (!isBonusMove) {
                    handleSquareAction(player.position);
                } else {
                    switchTurn();
                }
            }
        }


        function displayVictory(winner) {
             playSound('victory');
            gameActive = false;
            rollDiceButton.disabled = true;
            if (backgroundMusicElement) { backgroundMusicElement.pause(); backgroundMusicElement.currentTime = 0; }
            winnerNameDisplay.innerHTML = `üéâ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢ ${winner.name} (${winner.emoji})! üéâ<br>‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡∏¢‡∏≠‡∏î‡πÄ‡∏Ç‡∏≤! (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°: ${winner.score})`;
            victoryOverlay.style.display = 'flex';
            for (let i = 0; i < 20; i++) { setTimeout(() => { createFireworkBurst(); }, i * 150); }
        }
        function createFireworkBurst() {
            const numParticles = 30; const burstX = Math.random() * window.innerWidth; const burstY = Math.random() * (window.innerHeight * 0.7);
            for (let i = 0; i < numParticles; i++) {
                const particle = document.createElement('div'); particle.classList.add('firework-particle');
                particle.style.backgroundColor = fireworkColors[Math.floor(Math.random() * fireworkColors.length)];
                particle.style.left = burstX + 'px'; particle.style.top = burstY + 'px';
                const angle = Math.random() * Math.PI * 2; const radius = Math.random() * 100 + 40;
                particle.style.setProperty('--tx', Math.cos(angle) * radius + 'px'); particle.style.setProperty('--ty', Math.sin(angle) * radius + 'px');
                fireworksContainer.appendChild(particle);
                particle.addEventListener('animationend', () => { particle.remove(); });
            }
        }

        const questionTimerDisplay = document.getElementById('questionTimerDisplay');

        function updateTimerDisplay() {
            if (questionTimerDisplay) {
                questionTimerDisplay.textContent = `‡πÄ‡∏ß‡∏•‡∏≤: ${timeLeft} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;
                if (timeLeft <= 5 && timeLeft > 0) {
                    questionTimerDisplay.classList.add('text-red-600', 'font-bold', 'animate-pulse');
                } else {
                    questionTimerDisplay.classList.remove('text-red-600', 'font-bold', 'animate-pulse');
                }
            }
        }
        
        function stopQuestionTimer() {
            if (questionTimerInterval) {
                clearInterval(questionTimerInterval);
                questionTimerInterval = null;
            }
             if (questionTimerDisplay) {
                questionTimerDisplay.classList.remove('text-red-600', 'font-bold', 'animate-pulse');
                questionTimerDisplay.textContent = '';
            }
            if (heartbeatOverlay) heartbeatOverlay.style.display = 'none';
        }

        let currentQuestionTimeoutCallback = null;

        function startQuestionTimer(onTimeUpCallback) {
            stopQuestionTimer();
            timeLeft = QUESTION_TIME_LIMIT;
            currentQuestionTimeoutCallback = onTimeUpCallback;
            updateTimerDisplay();

            questionTimerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();

                if (timeLeft <= 10 && timeLeft > 0) {
                    heartbeatOverlay.style.display = 'block';
                    playSound('countdownTick');
                }

                if (timeLeft <= 0) {
                    stopQuestionTimer();
                    if (currentQuestionTimeoutCallback) {
                        currentQuestionTimeoutCallback();
                    }
                }
            }, 1000);
        }

        
        function displayCardSelection(cardDeckType, titlePrefix = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î", customSourcePool = null) {
            playSound('cardSelect');
            cardsForSelection = [];
            let sourceDeck;
            let currentDynamicDifficulty = getCurrentDifficulty(players[currentPlayerIndex].position);
        
            if (cardDeckType === 'mission') {
                if (customSourcePool) {
                    sourceDeck = customSourcePool;
                } else {
                    if (currentGameQuestionPool.mission[currentDynamicDifficulty].length === 0) {
                        console.log(`Resetting ${currentDynamicDifficulty} mission cards.`);
                        showMessage(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à (${currentDynamicDifficulty}) ‡πÉ‡∏´‡∏°‡πà!`, 'info', 2000);
                        currentGameQuestionPool.mission[currentDynamicDifficulty] = JSON.parse(JSON.stringify(allCards.mission[currentDynamicDifficulty]));
                    }
                    sourceDeck = currentGameQuestionPool.mission[currentDynamicDifficulty] || [];
                }
                const shuffledMissions = [...sourceDeck].sort(() => 0.5 - Math.random());
                cardsForSelection = shuffledMissions.slice(0, 10);
        
            } else if (cardDeckType === 'puzzle') {
                 if (!currentGameQuestionPool.puzzle[currentDynamicDifficulty] || currentGameQuestionPool.puzzle[currentDynamicDifficulty].length === 0) {
                    console.log(`Resetting ${currentDynamicDifficulty} puzzle cards.`);
                    showMessage(`‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤ (${currentDynamicDifficulty}) ‡πÉ‡∏´‡∏°‡πà!`, 'info', 2000);
                    currentGameQuestionPool.puzzle[currentDynamicDifficulty] = JSON.parse(JSON.stringify(allCards.puzzle[currentDynamicDifficulty]));
                }
                sourceDeck = currentGameQuestionPool.puzzle[currentDynamicDifficulty] || [];
                const shuffledPuzzles = [...sourceDeck].sort(() => 0.5 - Math.random());
                cardsForSelection = shuffledPuzzles.slice(0, 10);
        
            } else { // Effect cards
                sourceDeck = effectCards[cardDeckType] || [];
                const shuffledDeck = [...sourceDeck].sort(() => 0.5 - Math.random());
                cardsForSelection = shuffledDeck.slice(0, 5);
            }
        
            if (cardsForSelection.length === 0) {
                showMessage("‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏´‡∏°‡∏î! ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡∏ï‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ", "info", 3000);
                setTimeout(switchTurn, 1500);
                return;
            }
        
            cardSelectionGrid.innerHTML = '';
            cardSelectionTitle.textContent = `${titlePrefix}!`;
            if (cardDeckType === 'powerUp') cardSelectionTitle.textContent = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏û‡∏•‡∏±‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°";
            else if (cardDeckType === 'setback') cardSelectionTitle.textContent = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ!";
            else if (cardDeckType === 'bonus') cardSelectionTitle.textContent = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÇ‡∏ö‡∏ô‡∏±‡∏™";
        
            cardsForSelection.forEach((cardData, index) => {
                const cardBackDiv = document.createElement('div');
                cardBackDiv.classList.add('card-back');
                if (cardData.icon && (cardDeckType === 'powerUp' || cardDeckType === 'setback' || cardDeckType === 'bonus')) {
                     cardBackDiv.innerHTML = `<i class="${cardData.icon}"></i>`;
                     cardBackDiv.title = cardData.text;
                } else {
                    cardBackDiv.innerHTML = `<i class="fas fa-question"></i>`;
                }
                cardBackDiv.dataset.cardIndex = index;
        
                cardBackDiv.addEventListener('click', async (e) => {
                    playSound('cardSelect');
                    const chosenCardIndex = parseInt(e.currentTarget.dataset.cardIndex);
                    currentCardData = cardsForSelection[chosenCardIndex];
                    
                    if (currentCardData.question) {
                        const difficulty = currentCardData.difficulty;
                        let sourcePoolList;
        
                        if (cardDeckType === 'mission' || cardDeckType === 'puzzle') {
                             if(difficulty) {
                                sourcePoolList = currentGameQuestionPool[cardDeckType][difficulty];
                             }
                        }
        
                        if (sourcePoolList) {
                            const indexToRemove = sourcePoolList.findIndex(q => q.question === currentCardData.question);
                            if (indexToRemove > -1) {
                                sourcePoolList.splice(indexToRemove, 1);
                                console.log(`Removed card: ${currentCardData.question} from ${cardDeckType}.${difficulty}`);
                            }
                        }
                    }
        
                    cardSelectionModal.style.display = 'none';
        
                    if (cardDeckType === 'mission' || cardDeckType === 'puzzle') {
                        const modalTitleText = cardDeckType === 'mission' ? '‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à' : '‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤';
                        showQuestionModal(`${modalTitleText} <i class="fas ${cardDeckType === 'mission' ? 'fa-tasks' : 'fa-question-circle'}"></i>`, currentCardData.question, handleQuestionAnswer);
                    } else {
                        applyEffectCard(currentCardData);
                    }
                });
                cardSelectionGrid.appendChild(cardBackDiv);
            });
            cardSelectionModal.style.display = 'flex';
        }
        
        function applyEffectCard(effectCard) {
            showMessage(`‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î: ${effectCard.text}!`, "success", 3000);
            const player = players[currentPlayerIndex];

            if (effectCard.action.includes("move_forward") || effectCard.action === "get_shield" || effectCard.action === "roll_again") playSound('powerUp');
            if (effectCard.action.includes("move_backward") || effectCard.action === "go_to_start" || effectCard.action === "next_player_extra_turn") playSound('setback');
            if (effectCard.action.includes("go_to_square")) playSound('bonus');

            setTimeout(() => {
                switch (effectCard.action) {
                    case "move_forward": movePlayer(effectCard.value, true); break;
                    case "move_backward": movePlayer(-effectCard.value, true); break;
                    case "get_shield": player.hasShield = true; updatePlayerInfo(); switchTurn(); break;
                    case "roll_again": showMessage("‡∏ó‡∏≠‡∏¢‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πã‡∏≤‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á!", "info", 2000); rollDiceButton.disabled = false; break;
                    case "next_player_extra_turn":
                        let nextPlayerActualIndex = (currentPlayerIndex + 1) % players.length;
                        players[nextPlayerActualIndex].extraTurnsToTake = (players[nextPlayerActualIndex].extraTurnsToTake || 0) + 1;
                        showMessage(`${players[nextPlayerActualIndex].name} ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°!`, "info", 3000);
                        switchTurn();
                        break;
                    case "go_to_start":
                         if (player.hasShield) { showMessage(`${player.name} ‡πÉ‡∏ä‡πâ‡πÄ‡∏Å‡∏£‡∏≤‡∏∞‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô! ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô`, 'success', 3000); player.hasShield = false; updatePlayerInfo(); switchTurn(); }
                         else { player.position = 0; player.onBoardPosition = 0; renderPlayerPieces(); updatePlayerInfo(); switchTurn(); }
                        break;
                    case "go_to_square":
                        let steps = effectCard.value - player.position;
                        movePlayer(steps, true);
                        break;
                    default: switchTurn();
                }
            }, 1500);
        }

        function handleQuestionAnswer(isCorrect, timedOut = false) {
            if (isAnsweringFinalQuestion) {
                isAnsweringFinalQuestion = false;
                if (isCorrect) {
                    players[currentPlayerIndex].score += 50; 
                    updatePlayerInfo();
                    playSound('victory');
                    displayVictory(players[currentPlayerIndex]);
                } else {
                    playSound('incorrectAnswer');
                    showMessage('‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î! ‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏ú‡∏•‡∏±‡∏Å‡∏Å‡∏•‡∏±‡∏ö 1 ‡∏ä‡πà‡∏≠‡∏á', 'error', 3000);
                    setTimeout(() => movePlayer(-1, true), 3100);
                }
                return;
            }

            if (isAnsweringSetbackSave) {
                isAnsweringSetbackSave = false;
                if (isCorrect) {
                    players[currentPlayerIndex].score += 10; 
                    updatePlayerInfo();
                    playSound('powerUp');
                    showMessage('‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å! ‡∏Ñ‡∏∏‡∏ì‡∏£‡∏≠‡∏î‡∏à‡∏≤‡∏Å‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ!', 'success', 3000);
                    pendingSetbackCard = null;
                    setTimeout(switchTurn, 3100);
                } else {
                    playSound('incorrectAnswer');
                    showMessage('‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î! ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏Ç‡∏≠‡∏á‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ', 'error', 3000);
                    const cardToApply = pendingSetbackCard;
                    pendingSetbackCard = null;
                    setTimeout(() => applyEffectCard(cardToApply), 3100);
                }
                return;
            }
            
            if (pendingAction) {
                const actionToRun = pendingAction;
                pendingAction = null; 
                if (isCorrect) {
                    players[currentPlayerIndex].score += 5;
                    updatePlayerInfo();
                    playSound('correctAnswer');
                    showMessage('‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å! ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©!', 'success', 2500);
                    setTimeout(() => actionToRun(), 2600);
                } else {
                    playSound('incorrectAnswer');
                    showMessage('‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î! ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∂‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏û‡∏¥‡πÄ‡∏®‡∏©', 'error', 3000);
                    setTimeout(switchTurn, 3100);
                }
                return;
            }

            if (isHandlingBonusMoveQuestion) {
                isHandlingBonusMoveQuestion = false;
                if (isCorrect) {
                    playSound('correctAnswer');
                    showMessage('‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å!', 'success', 2000);
                } else {
                    playSound('incorrectAnswer');
                    showMessage(`‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î! ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏≠: ${currentCardData.answer}`, 'error', 3000);
                }
                setTimeout(switchTurn, 2500);
                return;
            }

            if (isCorrect) {
                playSound('correctAnswer');
                const player = players[currentPlayerIndex];
                const difficultyPoints = {'easy': 10, 'medium': 20, 'hard': 30};
                const pointsEarned = difficultyPoints[currentCardData.difficulty] || 15;
                player.score += pointsEarned;
                showMessage(`‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å! ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö ${pointsEarned} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!`, 'success', 3000);
                updatePlayerInfo();

                if (players.length > 1) {
                    setTimeout(offerPrankChoice, 1000);
                } else {
                    setTimeout(switchTurn, 3100);
                }
            } else {
                playSound('incorrectAnswer');
                const reason = timedOut ? '‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤!' : '‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î!';
                showMessage(`${reason} ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏≠: ${currentCardData.answer}`, 'error', 3500);
                if (players.length > 1) {
                    setTimeout(initiatePunishment, 1000);
                } else {
                    setTimeout(switchTurn, 3600);
                }
            }
        }

        function offerPrankChoice() {
            if (currentRound === 1 && currentPlayerIndex < players.length - 1) {
                showMessage("‡∏£‡∏≠‡∏ö‡πÅ‡∏£‡∏Å‡∏¢‡∏±‡∏á‡πÅ‡∏Å‡∏•‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏∞!", 'info', 3000);
                setTimeout(switchTurn, 1500);
                return;
            }

            prankTitle.textContent = "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏Å‡∏•‡πâ‡∏á:";
            prankOptionsContainer.innerHTML = ``;
            prankButtonsContainer.innerHTML = '';

            const validTargets = players.filter((p, index) => index !== currentPlayerIndex && !p.hasBeenPrankedThisRound);

            if (validTargets.length === 0) {
                showMessage("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡∏•‡πâ‡∏á‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ!", 'info', 3000);
                setTimeout(switchTurn, 1500);
                return;
            }

            validTargets.forEach(targetData => {
                const pIndex = players.findIndex(p => p.id === targetData.id);
                const btn = document.createElement('button');
                btn.classList.add('prank-target-btn');
                btn.textContent = `${targetData.name} (${targetData.emoji})`;
                btn.onclick = () => {
                    playSound('buttonClick');
                    selectPrankEffect(pIndex);
                };
                prankOptionsContainer.appendChild(btn);
            });

            prankButtonsContainer.innerHTML = `<button id="skipPrankBtn" class="modal-button bg-gray-300 hover:bg-gray-400 text-gray-700">‡πÑ‡∏°‡πà‡πÅ‡∏Å‡∏•‡πâ‡∏á</button>`;
            document.getElementById('skipPrankBtn').onclick = () => {
                playSound('buttonClick');
                prankModal.style.display = 'none';
                switchTurn();
            };
            prankModal.style.display = 'flex';
        }
        
        function selectPrankEffect(targetPlayerIndex) {
            prankTitle.textContent = `‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡∏•‡πâ‡∏á ${players[targetPlayerIndex].name}:`;
            prankOptionsContainer.innerHTML = '';
            const currentPlayer = players[currentPlayerIndex];

            prankEffects.forEach(effect => {
                const btn = document.createElement('button');
                btn.classList.add('prank-effect-btn');
                
                let buttonText = `<i class="${effect.icon} mr-2"></i> ${effect.text}`;
                if (effect.cost) {
                    buttonText += ` (‡πÉ‡∏ä‡πâ ${effect.cost} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)`;
                }
                btn.innerHTML = buttonText;

                if (effect.cost && currentPlayer.score < effect.cost) {
                    btn.disabled = true;
                    btn.title = `‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠ (‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ ${effect.cost})`;
                }

                btn.onclick = () => {
                    playSound('buttonClick');
                    prankModal.style.display = 'none';
                    applyPrankToTarget(targetPlayerIndex, effect);
                };
                prankOptionsContainer.appendChild(btn);
            });

            prankButtonsContainer.innerHTML = `<button id="cancelPrankEffectBtn" class="modal-button bg-gray-300 hover:bg-gray-400 text-gray-700">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>`;
            document.getElementById('cancelPrankEffectBtn').onclick = () => {
                playSound('buttonClick');
                prankModal.style.display = 'none';
                switchTurn();
            };
        }
        
        function applyPrankToTarget(targetPlayerIndex, prankEffect) {
            playSound('prank');
            const targetPlayer = players[targetPlayerIndex];
            targetPlayer.hasBeenPrankedThisRound = true;

            if (prankEffect.cost) {
                const currentPlayer = players[currentPlayerIndex];
                currentPlayer.score -= prankEffect.cost;
                showMessage(`${currentPlayer.name} ‡πÉ‡∏ä‡πâ ${prankEffect.cost} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡∏•‡πâ‡∏á ${targetPlayer.name}!`, 'info', 3000);
                updatePlayerInfo();
            } else {
                showMessage(`${players[currentPlayerIndex].name} ‡πÅ‡∏Å‡∏•‡πâ‡∏á ${targetPlayer.name} ‡πÇ‡∏î‡∏¢ ${prankEffect.text}!`, 'info', 3000);
            }

            setTimeout(() => {
                if (prankEffect.action === "prank_move_backward") {
                    targetPlayer.position -= prankEffect.value;
                    if (targetPlayer.position < 0) targetPlayer.position = 0;
                    targetPlayer.onBoardPosition = targetPlayer.position;
                } else if (prankEffect.action === "prank_skip_turn") {
                    targetPlayer.extraTurnsToTake = (targetPlayer.extraTurnsToTake || 0) - prankEffect.value;
                }
                renderPlayerPieces();
                updatePlayerInfo();
                switchTurn();
            }, 1500);
        }

        function initiatePunishment() {
            const playerToPunish = players[currentPlayerIndex];
            prankTitle.textContent = `${playerToPunish.name} ‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î! ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏ó‡∏•‡∏á‡πÇ‡∏ó‡∏©‡πÄ‡∏•‡∏¢!`;
            prankOptionsContainer.innerHTML = '';
            prankButtonsContainer.innerHTML = '';

            let availablePunishments = punishmentEffects.filter(p =>
                p.for3plusPlayers ? players.length >= 3 : true
            );

            availablePunishments.forEach(effect => {
                const btn = document.createElement('button');
                btn.classList.add('punishment-btn');
                btn.textContent = effect.text;
                btn.onclick = () => {
                    playSound('buttonClick');
                    applyPunishment(effect);
                };
                prankOptionsContainer.appendChild(btn);
            });

            prankModal.style.display = 'flex';
        }

        function applyPunishment(punishmentEffect) {
            prankModal.style.display = 'none';
            playSound('setback');
            const player = players[currentPlayerIndex];
            showMessage(`${player.name} ‡πÇ‡∏î‡∏ô‡∏•‡∏á‡πÇ‡∏ó‡∏©‡πÉ‡∏´‡πâ... ${punishmentEffect.text}!`, 'error', 3000);

            setTimeout(() => {
                movePlayer(-punishmentEffect.value, true);
            }, 1500);
        }

        function initiateSetbackSelectionByOpponents() {
            const player = players[currentPlayerIndex];
            prankTitle.textContent = `${player.name} ‡∏ï‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ! ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏•‡∏¢`;
            prankOptionsContainer.innerHTML = '';
            prankButtonsContainer.innerHTML = '';
            
            const setbackCards = effectCards.setback;
            setbackCards.forEach(card => {
                const btn = document.createElement('button');
                btn.classList.add('setback-choice-btn');
                btn.innerHTML = `<i class="${card.icon} mr-2"></i> ${card.text}`;
                btn.onclick = () => {
                    prankModal.style.display = 'none';
                    pendingSetbackCard = card;
                    askSetbackSaveQuestion();
                };
                prankOptionsContainer.appendChild(btn);
            });
            prankModal.style.display = 'flex';
        }

        function askSetbackSaveQuestion() {
            isAnsweringSetbackSave = true;
            const challengePool = [...currentGameQuestionPool.mission.medium, ...currentGameQuestionPool.mission.hard];

            if (challengePool.length === 0) {
                showMessage('‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏¢‡∏≤‡∏Å‡∏´‡∏°‡∏î! ‡∏Ñ‡∏∏‡∏ì‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ ‡∏£‡∏≠‡∏î‡∏ï‡∏±‡∏ß‡πÑ‡∏õ!', 'success', 3000);
                pendingSetbackCard = null;
                isAnsweringSetbackSave = false;
                setTimeout(switchTurn, 3100);
                return;
            }

            const randomCardIndex = Math.floor(Math.random() * challengePool.length);
            const questionCard = challengePool[randomCardIndex];
            
            currentCardData = questionCard;
            
            const originalPool = currentGameQuestionPool.mission[questionCard.difficulty];
            const indexInOriginalPool = originalPool.findIndex(q => q.question === questionCard.question);
            if(indexInOriginalPool > -1) {
                originalPool.splice(indexInOriginalPool, 1);
            }

            showQuestionModal('‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏î‡∏à‡∏≤‡∏Å‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ!', questionCard.question, handleQuestionAnswer);
        }

        function askFinalQuestion() {
            isAnsweringFinalQuestion = true;
            const hardQuestionPool = currentGameQuestionPool.mission.hard;

            if (hardQuestionPool.length === 0) {
                showMessage('‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î! ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏¢‡∏≤‡∏Å‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß ‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏ô‡∏∞‡πÄ‡∏•‡∏¢!', 'success', 3000);
                setTimeout(() => displayVictory(players[currentPlayerIndex]), 3100);
                return;
            }

            const randomCardIndex = Math.floor(Math.random() * hardQuestionPool.length);
            const finalQuestionCard = hardQuestionPool[randomCardIndex];

            currentCardData = finalQuestionCard;
            hardQuestionPool.splice(randomCardIndex, 1);

            showQuestionModal('‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡∏¢‡∏≠‡∏î‡πÄ‡∏Ç‡∏≤!', finalQuestionCard.question, handleQuestionAnswer);
        }

        async function handleSquareAction(squareIndex) {
            if (!players[currentPlayerIndex]) return;
            const square = boardConfig[squareIndex];

            showMessage(`${square.text}: ${square.instruction}`, 'info', 2000);

            setTimeout(() => {
                switch (square.type) {
                    case 'power-up':
                        pendingAction = () => displayCardSelection('powerUp', '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏û‡∏•‡∏±‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°');
                        const powerUpPool = [...currentGameQuestionPool.mission.medium, ...currentGameQuestionPool.mission.hard];
                        displayCardSelection('mission', '‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ä‡∏¥‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• (‡∏Å‡∏•‡∏≤‡∏á/‡∏¢‡∏≤‡∏Å)!', powerUpPool);
                        break;
                    case 'bonus':
                        pendingAction = () => displayCardSelection('bonus', '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÇ‡∏ö‡∏ô‡∏±‡∏™');
                        const bonusPool = [...currentGameQuestionPool.mission.medium, ...currentGameQuestionPool.mission.hard];
                        displayCardSelection('mission', '‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ä‡∏¥‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• (‡∏Å‡∏•‡∏≤‡∏á/‡∏¢‡∏≤‡∏Å)!', bonusPool);
                        break;
                    case 'setback':
                        initiateSetbackSelectionByOpponents();
                        break;
                    case 'puzzle':
                        displayCardSelection('puzzle', '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤');
                        break;
                    case 'normal':
                        displayCardSelection('mission', '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à');
                        break;
                    case 'event':
                        const randomEvent = groupEvents[Math.floor(Math.random() * groupEvents.length)];
                        showMessage(`‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå: ${randomEvent.text}`, 'info', 4000);
                        setTimeout(() => {
                            randomEvent.action(players, currentPlayerIndex);
                            renderPlayerPieces();
                            updatePlayerInfo();
                            switchTurn();
                        }, 4100);
                        break;
                    case 'finish':
                        askFinalQuestion();
                        break;
                    case 'start':
                    default:
                        switchTurn();
                        break;
                }
            }, 2100);
        }
        
        
        function showQuestionModal(titleHTML, question, answerCallback) {
            modal.answerCallback = answerCallback;
        
            modalTitle.innerHTML = titleHTML;
            modalQuestion.textContent = question;
            modalAnswerInput.value = '';
            modalFeedback.textContent = '';
            modalSubmitButton.disabled = false;
            modalCloseButton.disabled = false;
            modalCloseButton.textContent = "‡∏õ‡∏¥‡∏î";
        
            const oldContainer = document.getElementById('modalChoicesContainer');
            if (oldContainer) {
                oldContainer.remove();
            }
        
            if (currentCardData && (currentCardData.type === 'true_false' || currentCardData.type === 'multiple_choice')) {
                modalAnswerInput.style.display = 'none';
                modalSubmitButton.style.display = 'none';
        
                const answerButtonContainer = document.createElement('div');
                answerButtonContainer.id = 'modalChoicesContainer';
                
                currentCardData.choices.forEach(choice => {
                    const choiceBtn = document.createElement('button');
                    choiceBtn.textContent = choice;
                    choiceBtn.className = 'modal-button modal-submit-button'; // Grid classes are now in CSS
                    choiceBtn.onclick = () => {
                        playSound('buttonClick');
                        stopQuestionTimer();
                        const isCorrect = (choice.toString().toLowerCase() === currentCardData.answer.toString().toLowerCase());
                        modal.style.display = 'none';
                        if (modal.answerCallback) {
                            modal.answerCallback(isCorrect, false);
                        }
                    };
                    answerButtonContainer.appendChild(choiceBtn);
                });
        
                modalFeedback.insertAdjacentElement('beforebegin', answerButtonContainer);
        
            } else {
                modalAnswerInput.style.display = 'block';
                modalSubmitButton.style.display = 'inline-block';
            }
        
            modal.style.display = 'flex';
            if (modalAnswerInput.style.display === 'block') {
                modalAnswerInput.focus();
            }
        
            startQuestionTimer(() => {
                if (modal.style.display === 'flex') {
                    if (modal.answerCallback) {
                        modal.answerCallback(false, true);
                    }
                }
            });
        
            modalSubmitButton.onclick = () => {
                playSound('buttonClick');
                stopQuestionTimer();
        
                let playerAnswer = modalAnswerInput.value.trim();
                let correctAnswer = currentCardData ? currentCardData.answer.toString() : '';
                let isCorrect = false;
                if(currentCardData) {
                     isCorrect = playerAnswer.toLowerCase() === correctAnswer.toLowerCase();
                }
        
                modalSubmitButton.disabled = true;
                modalCloseButton.disabled = true;
                modal.style.display = 'none';
        
                if (modal.answerCallback) {
                    modal.answerCallback(isCorrect, false);
                }
            };
        
            modalCloseButton.onclick = () => {
                playSound('buttonClick');
                stopQuestionTimer();
                modal.style.display = 'none';
                if (modal.answerCallback) modal.answerCallback(false, false); 
            };
        }

        function switchTurn() {
            if (!gameActive || players.length === 0) { rollDiceButton.disabled = true; return; }

            const oldPlayerIndex = currentPlayerIndex;
            let playerWhoJustPlayed = players[currentPlayerIndex];

            if (playerWhoJustPlayed.extraTurnsToTake > 0) {
                playerWhoJustPlayed.extraTurnsToTake--;
                showMessage(`${playerWhoJustPlayed.name} ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏©!`, 'info', 3000);
            } else {
                let nextPlayerIndex = (currentPlayerIndex + 1) % players.length;
                while (players[nextPlayerIndex].extraTurnsToTake < 0) {
                    showMessage(`${players[nextPlayerIndex].name} ‡πÇ‡∏î‡∏ô‡πÅ‡∏Å‡∏•‡πâ‡∏á! ‡∏Ç‡πâ‡∏≤‡∏°‡∏ï‡∏≤‡∏ô‡∏µ‡πâ`, 'error', 2000);
                    players[nextPlayerIndex].extraTurnsToTake++;
                    nextPlayerIndex = (nextPlayerIndex + 1) % players.length;
                }
                currentPlayerIndex = nextPlayerIndex;
            }
            
            if (players[currentPlayerIndex]) {
                players[currentPlayerIndex].hasBeenPrankedThisRound = false;
            }

            if (currentPlayerIndex < oldPlayerIndex || (oldPlayerIndex === players.length - 1 && currentPlayerIndex === 0) ) {
                currentRound++;
                showMessage(`‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà ${currentRound} ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß!`, 'turn_info');
            }

            updatePlayerInfo();
            if (players.length > 0 && players[currentPlayerIndex]) {
                 document.getElementById('messageArea').textContent = `‡∏ï‡∏≤‡∏Ç‡∏≠‡∏á ${players[currentPlayerIndex].name}`;
            }

            rollDiceButton.disabled = false;
            movementDieValueDisplay.textContent = '-';
        }


        window.addEventListener('DOMContentLoaded', (event) => {
            console.log('DOM fully loaded and parsed');
            populateAllCards();
            createPlayerConfigInputs(parseInt(numPlayersSelect.value));
            boardContainer.classList.add('hidden');
            gameSetupScreen.classList.add('hidden');
            welcomeScreenModal.style.display = 'flex';
        });

    </script>
</body>
</html>