<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>โปรแกรมช่วยสอน: พิชิตยอดเขาจำนวนเต็ม (CAI Edition)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Kanit', sans-serif;
            color: #374151;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            padding: 1rem;
            overflow-y: auto;
            position: relative;
        }

        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('BG.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.4;
            z-index: -1;
        }
        
        .cai-modal {
            display: none;
            position: fixed;
            z-index: 150;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.75);
            justify-content: center;
            align-items: center;
        }

        .cai-modal-content {
            background-color: #fff;
            padding: 2.5rem;
            border-radius: 24px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            text-align: center;
            width: 90%;
            max-width: 650px;
            animation: modalAppear 0.5s ease-out;
        }

        #learningHubModal .cai-modal-content {
            max-width: 800px;
            text-align: left;
        }
        
        #reportModal .cai-modal-content {
            max-width: 900px;
            text-align: center;
        }
        
        .learning-section {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .learning-section h3 {
            font-size: 1.5rem;
            color: #4f46e5;
            margin-bottom: 0.75rem;
        }
        .learning-section p {
            font-size: 1.1rem;
            line-height: 1.6;
        }
        .explanation-box {
            margin-top: 1rem;
            padding: 0.75rem;
            background-color: #f3f4f6;
            border-left: 4px solid #4f46e5;
            border-radius: 4px;
        }
        .main-menu-button {
            display: block;
            width: 100%;
            max-width: 350px; /* MODIFIED: Wider for longer text */
            margin: 1rem auto;
            padding: 1rem;
            font-size: 1.5rem;
            font-weight: bold;
            border-radius: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .start-game-btn { background-color: #22c55e; color: white; }
        .start-game-btn:hover { background-color: #16a34a; transform: translateY(-3px); }
        .learning-hub-btn { background-color: #3b82f6; color: white; }
        .learning-hub-btn:hover { background-color: #2563eb; transform: translateY(-3px); }
        .settings-btn { background-color: #64748b; color: white; }
        .settings-btn:hover { background-color: #475569; transform: translateY(-3px); }
        
        #heartbeatOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255, 0, 0, 0.2); z-index: 99; pointer-events: none; animation: heartbeat 1.5s infinite; }
        @keyframes heartbeat { 0% { opacity: 0; } 50% { opacity: 1; } 100% { opacity: 0; } }
        .game-setup-screen, .board-container { background-color: rgba(255, 255, 255, 0.98); border-radius: 24px; box-shadow: 0 12px 35px rgba(0,0,0,0.12); padding: 2rem; width: 100%; max-width: 700px; margin-bottom: 2rem; position: relative; z-index: 1; text-align: center; }
        .board-container { max-width: 1200px; }
        .board-square { width: 78px; height: 78px; border: 2px solid #a5b4fc; display: flex; flex-direction: column; justify-content: space-between; align-items: center; text-align: center; position: relative; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); transition: transform 0.3s ease, box-shadow 0.3s ease; padding: 4px; font-weight: bold; overflow: visible; }
        .board-square:hover { transform: translateY(-4px) scale(1.05); box-shadow: 0 8px 16px rgba(0,0,0,0.2); }
        .square-number { font-size: 0.8rem; color: #4B5563; align-self: flex-start; padding: 1px 4px; background-color: rgba(255,255,255,0.9); border-radius: 4px; }
        .square-icon { font-size: 1.6rem; }
        .square-text { font-size: 0.65rem; line-height: 1.15; color: #1F2937; }
        .player-slots-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 1px; }
        .player-piece { width: 24px; height: 24px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.35); display: flex; justify-content: center; align-items: center; font-size: 16px; color: white; transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); z-index: 10; background-color: transparent !important; }
        @keyframes pieceLandAnimation { 0% { transform: scale(0.8); opacity: 0.7; } 50% { transform: scale(1.4) translateY(-6px); opacity: 1; box-shadow: 0 6px 12px rgba(0,0,0,0.3); } 100% { transform: scale(1); opacity: 1; } }
        .player-piece-landed { animation: pieceLandAnimation 0.7s ease-out; }
        .modal, .emoji-picker-modal, .victory-overlay, .central-message-overlay, .card-selection-modal, .prank-modal, .dice-animation-overlay { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7); justify-content: center; align-items: center; }
        .modal-content, .emoji-picker-content, .central-message-content, .card-selection-content, .prank-modal-content, .dice-animation-content { background-color: #ffffff; margin: auto; padding: 25px; border: none; width: 90%; border-radius: 18px; box-shadow: 0 10px 30px rgba(0,0,0,0.25); animation: modalAppear 0.4s ease-out; }
        .modal-content { max-width: 580px; padding:35px; }
        .emoji-picker-content { max-width: 340px; padding: 20px; }
        .central-message-content { max-width: 600px; padding: 30px; text-align: center; }
        .card-selection-content { max-width: 650px; padding: 30px; text-align: center; }
        .prank-modal-content { max-width: 500px; padding: 30px; text-align: center; }
/* สไตล์สำหรับลูกเต๋า 3 มิติ */
.dice-animation-content { max-width: 350px; padding: 40px; text-align: center; background: none; color: white; border-radius: 20px; box-shadow: none; }
.scene { width: 100px; height: 100px; perspective: 600px; margin: 2rem auto; }
.cube { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 1s; }
.cube.spinning { animation: spin-dice 2s linear infinite; }
.cube-face {
    position: absolute; width: 100px; height: 100px;
    background: rgba(255, 255, 255, 0.9);
    border: 2px solid #333;
    font-size: 4rem; color: #333; font-weight: bold;
    display: flex; justify-content: center; align-items: center;
}
.face-1 { transform: rotateY(0deg) translateZ(50px); }
.face-2 { transform: rotateY(90deg) translateZ(50px); }
.face-3 { transform: rotateY(180deg) translateZ(50px); }
.face-4 { transform: rotateY(-90deg) translateZ(50px); }
.face-5 { transform: rotateX(90deg) translateZ(50px); }
.face-6 { transform: rotateX(-90deg) translateZ(50px); }

@keyframes spin-dice {
    from { transform: rotateX(0deg) rotateY(0deg); }
    to { transform: rotateX(360deg) rotateY(720deg); }
}        @keyframes modalAppear { from { opacity: 0; transform: scale(0.85) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        .emoji-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(45px, 1fr)); gap: 12px; margin-top: 20px; }
        .emoji-btn { font-size: 26px; padding: 6px; border-radius: 10px; cursor: pointer; transition: background-color 0.2s, transform 0.2s; border: 1px solid #d1d5db; }
        .emoji-btn:hover { background-color: #e0f2fe; transform: scale(1.1); }
        .dice-area div p { border: 1px solid #90cdf4; padding: 12px; margin: 6px 0; border-radius: 10px; background-color: #e0f2fe; box-shadow: inset 0 1px 3px rgba(0,0,0,0.05); }
        .dice-value { font-size: 2rem; font-weight: bold; color: #1d4ed8; }
        .dice-label { color: #1e3a8a; }
        .start-square { background-color: #64748b; color: white; border-color: #475569;} .start-square .square-icon { color: #f59e0b; }
        .finish-square { background-color: #f59e0b; color: #475569; border-color: #d97706;} .finish-square .square-icon { color: #b91c1c; }
        .power-up-square { background-color: #22c55e; color: white; border-color: #16a34a;} .power-up-square .square-icon { color: #ecfdf5; }
        .setback-square { background-color: #ef4444; color: white; border-color: #dc2626;} .setback-square .square-icon { color: #fee2e2; }
        .puzzle-square { background-color: #3b82f6; color: white; border-color: #2563eb;} .puzzle-square .square-icon { color: #dbeafe; }
        .bonus-square { background-color: #ec4899; color: white; border-color: #db2777;} .bonus-square .square-icon { color: #fce7f3; }
        .normal-square { background-color: #e0f2fe; border-color: #7dd3fc;} .normal-square .square-icon { color: #0284c7; }
        .event-square { background-color: #a855f7; color: white; border-color: #9333ea;} .event-square .square-icon { color: #f5d0fe; }
        .game-board-grid { display: grid; grid-template-columns: repeat(10, 75px); grid-template-rows: repeat(5, 75px); gap: 6px; margin: 0 auto; }
        .control-panel-item { background-color: rgba(255, 255, 255, 0.95); padding: 1.25rem; border-radius: 12px; box-shadow: 0 6px 12px -1px rgba(0, 0, 0, 0.08), 0 3px 7px -1px rgba(0, 0, 0, 0.05); }
        .main-action-button { background: linear-gradient(to right, #fb923c, #f97316); color: white; font-weight: bold; padding: 0.85rem 1.75rem; border-radius: 0.5rem; font-size: 1.125rem; box-shadow: 0 5px 12px rgba(249, 115, 22, 0.45); transition: all 0.3s ease; border: none; }
        .main-action-button:hover { transform: translateY(-3px) scale(1.03); box-shadow: 0 7px 18px rgba(249, 115, 22, 0.55); }
        .main-action-button:disabled { background: #94a3b8; box-shadow: none; cursor: not-allowed; }
        .modal-button { padding: 0.6rem 1.2rem; border-radius: 0.375rem; font-weight: bold; transition: background-color 0.2s ease, transform 0.2s; }
        .modal-submit-button { background-color: #10b981; color: white; }
        .modal-submit-button:hover { background-color: #059669; transform: translateY(-1px); }
        .modal-close-button { background-color: #e5e7eb; color: #374151; }
        .modal-close-button:hover { background-color: #cbd5e1; transform: translateY(-1px); }
        .setup-input { border: 1px solid #60a5fa; padding: 0.5rem; border-radius: 0.375rem; margin-top: 0.25rem; width: 100%; }
        .player-emoji-select-btn { font-size: 1.5rem; text-align: center; width: 60px; height: 50px; padding: 0.25rem; border: 1px solid #60a5fa; border-radius: 0.375rem; background-color: #fff; cursor: pointer; }
        .player-emoji-select-btn:hover { background-color: #dbeafe; }
        .player-config-entry { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem; }
        .creator-credit { text-align: center; font-size: 0.875rem; color: #4b5563; margin-top: 1.5rem; }
        .card-selection-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 1rem; margin-top: 1.5rem; }
        .card-back { width: 100px; height: 140px; background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%); border-radius: 10px; display: flex; justify-content: center; align-items: center; font-size: 3rem; color: white; cursor: pointer; transition: transform 0.3s ease, box-shadow 0.3s ease; box-shadow: 0 4px 8px rgba(0,0,0,0.2); border: 2px solid white; }
        .card-back:hover { transform: scale(1.05) translateY(-5px); box-shadow: 0 8px 16px rgba(0,0,0,0.3); }
        .card-back i { text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .prank-target-btn, .prank-effect-btn, .punishment-btn, .setback-choice-btn, .bonus-choice-btn { background-color: #f0abfc; color: #701a75; padding: 0.75rem 1rem; border-radius: 8px; font-weight: bold; margin: 0.5rem; transition: background-color 0.2s, transform 0.2s; }
        .punishment-btn { background-color: #fca5a5; color: #991b1b; }
        .setback-choice-btn { background-color: #fca5a5; color: #991b1b; }
        .bonus-choice-btn { background-color: #a5f3fc; color: #0891b2; } /* NEW: For single player bonus */
        .prank-target-btn:hover, .prank-effect-btn:hover { background-color: #e879f9; transform: translateY(-2px); }
        .punishment-btn:hover, .setback-choice-btn:hover { background-color: #f87171; transform: translateY(-2px); }
        .bonus-choice-btn:hover { background-color: #67e8f9; transform: translateY(-2px); }
        .prank-target-btn:disabled, .prank-effect-btn:disabled { background-color: #e5e7eb; color: #9ca3af; cursor: not-allowed; transform: none; }
        #modalChoicesContainer { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; margin-bottom: 1rem; }
    </style>
</head>
<body>
    <div id="heartbeatOverlay"></div>

    <audio id="backgroundMusic" loop>
        <source src="sounds/background_music.mp3" type="audio/mpeg">
    </audio>

    <div id="mainMenuModal" class="cai-modal" style="display: flex;">
        <div class="cai-modal-content">
            <h1 class="text-4xl font-bold text-purple-700 mb-4">ยินดีต้อนรับสู่</h1>
            <h2 class="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600 mb-8">
                🏔️ โปรแกรมช่วยสอน: พิชิตยอดเขาจำนวนเต็ม 🎲
            </h2>
            <button id="mainMenuSinglePlayerBtn" class="main-menu-button bg-teal-500 hover:bg-teal-600 text-white"><i class="fas fa-user mr-3"></i>โหมดท้าทาย (1 คน)</button>
            <button id="mainMenuStartGameBtn" class="main-menu-button start-game-btn"><i class="fas fa-users mr-3"></i>เริ่มเกม (หลายคน)</button>
            <button id="mainMenuLearningHubBtn" class="main-menu-button learning-hub-btn"><i class="fas fa-book-open mr-3"></i>ศูนย์การเรียนรู้</button>
            <button id="mainMenuSettingsBtn" class="main-menu-button settings-btn"><i class="fas fa-cog mr-3"></i>ตั้งค่า</button>
            <p class="creator-credit text-lg mt-10">ผู้จัดทำ: ครูภาณุมาศ แป้นเดช<br>โรงเรียนส่วนป่าอุปถัมภ์<br>หากต้องการให้เกมนี้มีเนื้อหาอื่น ๆ แสดงความคิดเห็นไว้ได้เลยครับ</p>
        </div>
    </div>

    <div id="learningHubModal" class="cai-modal">
        <div class="cai-modal-content">
            <h2 class="text-3xl font-bold text-center mb-6 text-purple-700">ศูนย์การเรียนรู้เรื่องจำนวนเต็ม</h2>
            <div class="learning-section">
                <h3><i class="fas fa-plus-circle text-green-500 mr-2"></i>การบวกจำนวนเต็ม</h3>
                <p>การบวกจำนวนเต็มบวก: ผลลัพธ์เป็นบวก (เช่น 5 + 3 = 8)</p>
                <p>การบวกจำนวนเต็มลบ: ผลลัพธ์เป็นลบ (เช่น (-5) + (-3) = -8)</p>
                <p>การบวกระหว่างบวกและลบ: นำค่าสัมบูรณ์มาลบกัน แล้วใช้เครื่องหมายตามตัวเลขที่มากกว่า (เช่น (-8) + 5 = -3)</p>
            </div>
            <div class="learning-section">
                <h3><i class="fas fa-minus-circle text-red-500 mr-2"></i>การลบจำนวนเต็ม</h3>
                <p>หลักการคือ "ตัวตั้ง + จำนวนตรงข้ามของตัวลบ"</p>
                <div class="explanation-box">
                    <strong>ตัวอย่าง:</strong> 7 - (-3)  เปลี่ยนเป็นการบวกด้วยจำนวนตรงข้าม<br>
                    = 7 + 3 = 10
                </div>
            </div>
            <div class="learning-section">
                <h3><i class="fas fa-times-circle text-blue-500 mr-2"></i>การคูณและหารจำนวนเต็ม</h3>
                <p>เครื่องหมายเหมือนกัน (บวกxบวก, ลบxลบ) -> ผลลัพธ์เป็น <span class="font-bold text-green-600">บวก</span></p>
                <p>เครื่องหมายต่างกัน (บวกxลบ, ลบxบวก) -> ผลลัพธ์เป็น <span class="font-bold text-red-600">ลบ</span></p>
            </div>
             <div class="learning-section">
                <h3><i class="fas fa-sort-numeric-down text-yellow-500 mr-2"></i>ลำดับการดำเนินการ</h3>
                <p>1. คำนวณในวงเล็บ () ก่อนเสมอ</p>
                <p>2. ตามด้วยการคูณ (×) และการหาร (÷) (ทำจากซ้ายไปขวา)</p>
                <p>3. สุดท้ายคือการบวก (+) และการลบ (-) (ทำจากซ้ายไปขวา)</p>
            </div>
            <div class="text-center mt-6">
                 <button id="closeLearningHubBtn" class="modal-button modal-close-button"><i class="fas fa-times mr-2"></i>กลับสู่เมนูหลัก</button>
            </div>
        </div>
    </div>

    <div id="settingsModal" class="cai-modal">
        <div class="cai-modal-content" style="max-width: 400px;">
             <h2 class="text-3xl font-bold text-center mb-6 text-purple-700">ตั้งค่า</h2>
             <div class="flex justify-between items-center text-xl">
                <label for="soundToggle">เสียงประกอบ:</label>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input type="checkbox" id="soundToggle" class="sr-only peer" checked>
                  <div class="w-14 h-8 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-1 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-blue-600"></div>
                </label>
             </div>
              <div class="text-center mt-8">
                 <button id="closeSettingsBtn" class="modal-button modal-close-button"><i class="fas fa-times mr-2"></i>ปิด</button>
            </div>
        </div>
    </div>

    <div id="reportModal" class="cai-modal">
        <div class="cai-modal-content">
            <h2 class="text-3xl font-bold text-center mb-6 text-purple-700">สรุปผลการเรียนรู้</h2>
            <div id="reportContent" class="text-left overflow-x-auto"></div>
            <div class="text-center mt-8">
                 <button id="playAgainFromReportBtn" class="main-menu-button start-game-btn" style="max-width:250px;"><i class="fas fa-redo mr-2"></i>เล่นอีกครั้ง</button>
            </div>
        </div>
    </div>


    <div id="gameSetupScreen" class="game-setup-screen hidden"> <h1 class="text-3xl font-bold text-center mb-6 text-purple-700">ตั้งค่าเกมพิชิตยอดเขา</h1>
        <div class="mb-4">
            <label for="numPlayersSelect" class="block text-lg font-medium text-gray-700">จำนวนผู้เล่น:</label>
            <select id="numPlayersSelect" class="setup-input mt-1 block w-full">
                <option value="2" selected>2 คน</option>
                <option value="3">3 คน</option>
                <option value="4">4 คน</option>
                <option value="5">5 คน</option>
                <option value="6">6 คน</option>
                <option value="7">7 คน</option>
                <option value="8">8 คน</option>
                <option value="9">9 คน</option>
                <option value="10">10 คน</option>
            </select>
        </div>
        <div id="playerConfigArea" class="mb-6 space-y-4"></div>
        <p class="creator-credit">ผู้จัดทำ: ครูภาณุมาศ แป้นเดช โรงเรียนส่วนป่าอุปถัมภ์</p>
        <button id="startGameBtn" class="main-action-button w-full py-3 mt-4"><i class="fas fa-play mr-2"></i>เริ่มเกม!</button>
    </div>

    <div id="boardContainer" class="board-container hidden">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600">
                🏔️ พิชิตยอดเขาจำนวนเต็ม 🎲
            </h1>
        </header>

        <div class="flex flex-col lg:flex-row lg:space-x-6 items-start">
            <div id="playersInfoPanelContainer" class="w-full lg:w-1/5 control-panel-item mb-6 lg:mb-0 order-2 lg:order-1">
                <h2 class="text-2xl font-semibold mb-3 text-gray-800">ข้อมูลผู้เล่น</h2>
                <div id="playersInfoPanel" class="space-y-2"></div>
                <p id="roundDisplay" class="mt-4 text-lg font-bold text-gray-600">รอบที่: <span id="currentRoundCounter">1</span></p>
                <p class="mt-2 text-xl font-bold text-indigo-700">ตาของ: <span id="currentPlayerTurn"></span></p>
            </div>

            <div id="gameBoardOuterContainer" class="w-full lg:flex-grow order-1 lg:order-2 flex justify-center mb-6 lg:mb-0">
                 <div id="gameBoard" class="game-board-grid p-4 bg-blue-50 rounded-xl"></div>
            </div>

            <div id="rightControlPanel" class="w-full lg:w-1/5 space-y-6 order-3">
                <div class="control-panel-item dice-area">
                    <h2 class="text-2xl font-semibold mb-3 text-gray-800">ผลการทอยลูกเต๋า</h2>
                    <div id="diceRollDisplay" class="text-center space-y-1">
                        <p><span class="dice-label">ลูกเต๋าเดินทาง:</span> <span id="movementDieValue" class="dice-value">-</span></p>
                        </div>
                </div>
                <div class="control-panel-item flex flex-col justify-center items-center">
                     <button id="rollDiceButton" class="main-action-button w-full">
                        <i class="fas fa-dice-d6 mr-2"></i> ทอยลูกเต๋า!
                    </button>
                </div>
            </div>
        </div>
        <div id="messageArea" class="mt-6 p-5 bg-white text-gray-700 rounded-xl shadow-lg text-center text-lg min-h-[60px]"></div>
    </div>

    <div id="centralMessageOverlay" class="central-message-overlay">
        <div id="centralMessageContent" class="central-message-content"></div>
    </div>

<div id="diceAnimationOverlay" class="dice-animation-overlay">
    <div class="dice-animation-content">
        <p id="diceAnimationText" class="text-2xl mb-4 text-white font-bold text-shadow-lg">กำลังทอยลูกเต๋า...</p>
        <div class="scene">
            <div class="cube" id="diceCube">
                <div class="cube-face face-1">1</div>
                <div class="cube-face face-2">2</div>
                <div class="cube-face face-3">3</div>
                <div class="cube-face face-4">4</div>
                <div class="cube-face face-5">5</div>
                <div class="cube-face face-6">6</div>
            </div>
        </div>
    </div>
</div>

    <div id="cardSelectionModal" class="card-selection-modal">
        <div class="card-selection-content">
            <h2 id="cardSelectionTitle" class="text-3xl font-bold text-purple-600 mb-6">เลือกการ์ด 1 ใบ!</h2>
            <div id="cardSelectionGrid" class="card-selection-grid"></div>
        </div>
    </div>

    <div id="questionModal" class="modal">
        <div class="modal-content">
             <div id="modalHeader" class="flex justify-between items-center mb-2">
                <h3 id="modalTitle" class="text-2xl font-bold text-gray-800">คำถาม</h3>
                <div id="questionTimerDisplay" class="text-xl font-bold text-orange-500"></div>
            </div>
            <p id="modalQuestion" class="mb-6 text-lg text-gray-700"></p>
            <input type="text" id="modalAnswerInput" class="border border-gray-300 p-3 w-full rounded-lg mb-4 text-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="ใส่คำตอบของคุณ">
            <div id="modalFeedback" class="mb-4 text-md font-semibold"></div>
            <div class="flex justify-end space-x-4">
                <button id="modalSubmitButton" class="modal-button modal-submit-button"><i class="fas fa-check mr-2"></i>ส่งคำตอบ</button>
                <button id="modalCloseButton" class="modal-button modal-close-button"><i class="fas fa-times mr-2"></i>ปิด</button>
            </div>
        </div>
    </div>

    <div id="emojiPickerModal" class="emoji-picker-modal">
        <div class="emoji-picker-content">
            <h3 class="text-xl font-bold text-center mb-4 text-gray-700">เลือก Emoji</h3>
            <div id="emojiGrid" class="emoji-grid"></div>
            <button id="closeEmojiPickerBtn" class="mt-4 w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg">ปิด</button>
        </div>
    </div>

    <div id="victoryOverlay" class="victory-overlay hidden">
        <div id="fireworksContainer" class="absolute inset-0 overflow-hidden"></div>
        <div id="winnerNameDisplay" class="text-white text-3xl md:text-4xl lg:text-5xl font-bold p-6 md:p-8 bg-purple-700 bg-opacity-80 rounded-xl shadow-2xl text-center leading-tight">
            </div>
        <button id="reportBtn" class="mt-8 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg text-lg shadow-md transition-transform transform hover:scale-105"><i class="fas fa-chart-bar mr-2"></i> ดูรายงานผล</button>
        <button id="playAgainBtn" class="mt-8 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-6 rounded-lg text-lg shadow-md transition-transform transform hover:scale-105">เล่นอีกครั้ง?</button>
    </div>

    <div id="prankModal" class="prank-modal">
        <div class="prank-modal-content">
            <h3 id="prankTitle" class="text-2xl font-bold mb-6 text-center text-purple-600"></h3>
            <div id="prankOptionsContainer" class="mb-4">
                </div>
            <div id="prankButtonsContainer" class="flex justify-center space-x-4">
                </div>
        </div>
    </div>


    <script>
        // --- Game Configuration ---
        const NUM_SQUARES = 50;
        let players = [];
        // NEW: State for single player mode
        let isSinglePlayerMode = false;
        
        const defaultPlayerEmojis = ['🚀', '🌟', '🐢', '🦊', '😀', '😂', '😍', '🥳', '🍔', '🍕', '⚽️', '🎨', '💡', '💖', '👍', '💯'];
        const commonEmojisForPicker = [
            '🚀', '🌟', '🐢', '🦊', '😀', '😂', '😍', '🥳', '🍔', '🍕', '⚽️', '🎨', '💡', '💖', '👍', '💯',
            '😊', '😎', '🤩', '🤔', '🎉', '🎈', '🎁', '🏆', '🐱', '🐶', '🐼', '🦄', '🤖', '👽', '👾', '👻',
            '👑', '💎', '🍀', '🍄', '🍓', '🍉', '🍎', '🍊', '🍋', '🍌', '🍍', '🥭', '🍑', '🍒', '🥝', '🍅'
        ];
        const fireworkColors = ['#FF5252', '#FFC107', '#4CAF50', '#2196F3', '#9C27B0', '#FFEB3B', '#00BCD4', '#E91E63'];

        let currentPlayerIndex = 0;
        let gameActive = false;
        let currentPlayerEmojiSelectionIndex = 0;
        let isHandlingBonusMoveQuestion = false;
        let currentGameQuestionPool = {};
        let pendingAction = null;
        let currentRound = 1;
        let pendingSetbackCard = null;
        let isAnsweringSetbackSave = false;
        let isAnsweringFinalQuestion = false;
        let isSoundEnabled = true;

        const boardConfig = [
            { type: 'start', text: 'เริ่มต้น', icon: 'fas fa-mountain', instruction: 'จุดเริ่มต้นการผจญภัย!' },
            { type: 'normal', text: 'ภารกิจ', icon: 'fas fa-tasks', instruction: 'หยิบการ์ดภารกิจ!' },
            { type: 'puzzle', text: 'ปริศนา', icon: 'fas fa-question-circle', instruction: 'หยิบการ์ดปริศนา!' },
            { type: 'normal', text: 'ภารกิจ', icon: 'fas fa-tasks', instruction: 'หยิบการ์ดภารกิจ!' },
            { type: 'power-up', text: 'บวกพลัง', icon: 'fas fa-arrow-up', instruction: 'ตอบถูกเพื่อรับพลัง!' },
            { type: 'event', text: 'อีเวนต์', icon: 'fas fa-users', instruction: 'เกิดเหตุการณ์พิเศษ!' }, // Event 1
            { type: 'setback', text: 'อุปสรรค', icon: 'fas fa-arrow-down', instruction: 'เผชิญหน้ากับอุปสรรค!' },
            { type: 'puzzle', text: 'ปริศนา', icon: 'fas fa-question-circle', instruction: 'หยิบการ์ดปริศนา!' },
            { type: 'normal', text: 'ภารกิจ', icon: 'fas fa-tasks', instruction: 'หยิบการ์ดภารกิจ!' },
            { type: 'setback', text: 'อุปสรรค', icon: 'fas fa-arrow-down', instruction: 'เผชิญหน้ากับอุปสรรค!' },
            { type: 'normal', text: 'ภารกิจ', icon: 'fas fa-tasks', instruction: 'หยิบการ์ดภารกิจ!' },
            { type: 'power-up', text: 'บวกพลัง', icon: 'fas fa-arrow-up', instruction: 'ตอบถูกเพื่อรับพลัง!' },
            { type: 'puzzle', text: 'ปริศนา', icon: 'fas fa-question-circle', instruction: 'หยิบการ์ดปริศนา!' },
            { type: 'setback', text: 'อุปสรรค', icon: 'fas fa-arrow-down', instruction: 'เผชิญหน้ากับอุปสรรค!' },
            { type: 'event', text: 'อีเวนต์', icon: 'fas fa-users', instruction: 'เกิดเหตุการณ์พิเศษ!' }, // Event 2
            { type: 'puzzle', text: 'ปริศนา', icon: 'fas fa-question-circle', instruction: 'หยิบการ์ดปริศนา!' },
            { type: 'normal', text: 'ภารกิจ', icon: 'fas fa-tasks', instruction: 'หยิบการ์ดภารกิจ!' },
            { type: 'power-up', text: 'บวกพลัง', icon: 'fas fa-arrow-up', instruction: 'ตอบถูกเพื่อรับพลัง!' },
            { type: 'normal', text: 'ภารกิจ', icon: 'fas fa-tasks', instruction: 'หยิบการ์ดภารกิจ!' },
            { type: 'setback', text: 'อุปสรรค', icon: 'fas fa-arrow-down', instruction: 'เผชิญหน้ากับอุปสรรค!' },
            { type: 'puzzle', text: 'ปริศนา', icon: 'fas fa-question-circle', instruction: 'หยิบการ์ดปริศนา!' },
            { type: 'normal', text: 'ภารกิจ', icon: 'fas fa-tasks', instruction: 'หยิบการ์ดภารกิจ!' },
            { type: 'power-up', text: 'บวกพลัง', icon: 'fas fa-wind', instruction: 'ตอบถูกเพื่อรับพลัง!' },
            { type: 'event', text: 'อีเวนต์', icon: 'fas fa-users', instruction: 'เกิดเหตุการณ์พิเศษ!' }, // Event 3
            { type: 'bonus', text: 'โบนัส', icon: 'fas fa-star', instruction: 'ตอบถูกเพื่อรับโบนัส!' },
            { type: 'puzzle', text: 'ปริศนา', icon: 'fas fa-question-circle', instruction: 'หยิบการ์ดปริศนา!' },
            { type: 'setback', text: 'อุปสรรค', icon: 'fas fa-skull-crossbones', instruction: 'เผชิญหน้ากับอุปสรรค!' },
            { type: 'normal', text: 'ภารกิจ', icon: 'fas fa-tasks', instruction: 'หยิบการ์ดภารกิจ!' },
            { type: 'power-up', text: 'บวกพลัง', icon: 'fas fa-arrow-up', instruction: 'ตอบถูกเพื่อรับพลัง!' },
            { type: 'puzzle', text: 'ปริศนา', icon: 'fas fa-question-circle', instruction: 'หยิบการ์ดปริศนา!' },
            { type: 'normal', text: 'ภารกิจ', icon: 'fas fa-tasks', instruction: 'หยิบการ์ดภารกิจ!' },
            { type: 'setback', text: 'อุปสรรค', icon: 'fas fa-arrow-down', instruction: 'เผชิญหน้ากับอุปสรรค!' },
            { type: 'event', text: 'อีเวนต์', icon: 'fas fa-users', instruction: 'เกิดเหตุการณ์พิเศษ!' }, // Event 4
            { type: 'puzzle', text: 'ปริศนา', icon: 'fas fa-question-circle', instruction: 'หยิบการ์ดปริศนา!' },
            { type: 'normal', text: 'ภารกิจ', icon: 'fas fa-tasks', instruction: 'หยิบการ์ดภารกิจ!' },
            { type: 'power-up', text: 'บวกพลัง', icon: 'fas fa-bolt', instruction: 'ตอบถูกเพื่อรับพลัง!' },
            { type: 'normal', text: 'ภารกิจ', icon: 'fas fa-tasks', instruction: 'หยิบการ์ดภารกิจ!' },
            { type: 'setback', text: 'อุปสรรค', icon: 'fas fa-poo-storm', instruction: 'เผชิญหน้ากับอุปสรรค!' },
            { type: 'puzzle', text: 'ปริศนา', icon: 'fas fa-question-circle', instruction: 'หยิบการ์ดปริศนา!' },
            { type: 'setback', text: 'อุปสรรค', icon: 'fas fa-arrow-down', instruction: 'เผชิญหน้ากับอุปสรรค!' },
            { type: 'normal', text: 'ภารกิจ', icon: 'fas fa-tasks', instruction: 'หยิบการ์ดภารกิจ!' },
            { type: 'power-up', text: 'บวกพลัง', icon: 'fas fa-shield-alt', instruction: 'ตอบถูกเพื่อรับพลัง!' },
            { type: 'event', text: 'อีเวนต์', icon: 'fas fa-users', instruction: 'เกิดเหตุการณ์พิเศษ!' }, // Event 5
            { type: 'normal', text: 'ภารกิจ', icon: 'fas fa-tasks', instruction: 'หยิบการ์ดภารกิจ!' },
            { type: 'setback', text: 'อุปสรรค', icon: 'fas fa-arrow-down', instruction: 'เผชิญหน้ากับอุปสรรค!' },
            { type: 'normal', text: 'ภารกิจ', icon: 'fas fa-tasks', instruction: 'หยิบการ์ดภารกิจ!' },
            { type: 'puzzle', text: 'ปริศนา', icon: 'fas fa-question-circle', instruction: 'หยิบการ์ดปริศนา!' },
            { type: 'normal', text: 'ภารกิจ', icon: 'fas fa-tasks', instruction: 'หยิบการ์ดภารกิจ!' },
            { type: 'normal', text: 'ภารกิจ', icon: 'fas fa-tasks', instruction: 'หยิบการ์ดภารกิจ!' },
            { type: 'finish', text: 'ยอดเขา!', icon: 'fas fa-flag-checkered', instruction: 'ตอบคำถามสุดท้ายเพื่อชนะ!' }
        ];

        const effectCards = {
            powerUp: [
                { text: "เดินหน้า 2 ช่อง", action: "move_forward", value: 2, icon: "fas fa-shoe-prints" },
                { text: "เดินหน้า 3 ช่อง", action: "move_forward", value: 3, icon: "fas fa-running" },
                { text: "ได้รับเกราะป้องกัน", action: "get_shield", icon: "fas fa-shield-alt" },
                { text: "ทอยลูกเต๋าอีกครั้ง", action: "roll_again", icon: "fas fa-dice-d6" }
            ],
            setback: [
                { text: "ถอยหลัง 3 ช่อง", action: "move_backward", value: 3, icon: "fas fa-undo-alt" },
                { text: "ถอยหลัง 5 ช่อง", action: "move_backward", value: 5, icon: "fas fa-angle-double-left" },
                { text: "ให้เพื่อนหยุดเดิน 1 ตา", action: "prank_skip_turn", value: 1, icon: "fas fa-user-clock" },
            ],
            bonus: [
                { text: "เดินไปช่องที่ 35", action: "go_to_square", value: 34, icon: "fas fa-route" },
                { text: "ทอยลูกเต๋าอีกครั้ง!", action: "roll_again", icon: "fas fa-redo" }
            ]
        };

        const prankEffects = [
            { text: "ให้เพื่อนถอยหลัง 1 ช่อง", action: "prank_move_backward", value: 1, icon: "fas fa-user-minus" },
            { text: "ให้เพื่อนถอยหลัง 2 ช่อง", action: "prank_move_backward", value: 2, icon: "fas fa-users-cog" },
            { text: "ให้เพื่อนหยุดเดิน 1 ตา", action: "prank_skip_turn", value: 1, icon: "fas fa-user-clock", cost: 10 }
        ];

        // MODIFIED: Punishment for multiplayer, Single player has its own logic
        const punishmentEffects = [
            { text: "ถอย 1 ช่อง", action: "punish_move_backward", value: 1 },
            { text: "ถอย 2 ช่อง", action: "punish_move_backward", value: 2 },
            { text: "ถอย 5 ช่อง", action: "punish_move_backward", value: 5, for3plusPlayers: true }
        ];
        
        // MODIFIED: Group events now handle single player mode
        const groupEvents = [
            { 
                text: "พายุสุริยะ! คลื่นแม่เหล็กปั่นป่วน ทำให้ผู้เล่นทุกคนที่อยู่บนช่องเลขคี่ต้องถอยหลัง 1 ช่อง", 
                action: (players, currentPlayerIdx, isSinglePlayer) => {
                    players.forEach(p => {
                        if ((p.position + 1) % 2 !== 0) {
                            p.position = Math.max(0, p.position - 1);
                            p.onBoardPosition = p.position;
                        }
                    });
                    showMessage("ผู้เล่นบนช่องเลขคี่ถอยหลัง 1 ช่อง!", 'info');
                }
            },
            {
                text: "ฝนดาวตก! ผู้เล่นทุกคนได้รับคะแนนโบนัส 15 คะแนน!",
                action: (players, currentPlayerIdx, isSinglePlayer) => {
                    players.forEach(p => p.score += 15);
                    showMessage("ทุกคนได้รับ 15 คะแนน!", 'success');
                }
            },
            {
                text: "แรงโน้มถ่วงผิดปกติ! ผู้เล่นที่อยู่นำหน้าสุด (ยกเว้นคนปัจจุบัน) ต้องสลับตำแหน่งกับผู้เล่นที่อยู่ท้ายสุด",
                action: (players, currentPlayerIdx, isSinglePlayer) => {
                    if (isSinglePlayer || players.length < 3) {
                        showMessage("ลมส่งปริศนา! คุณได้รับสิทธิ์ทอยลูกเต๋าอีกครั้ง!", 'info');
                        // In single player, this event gives an extra roll instead.
                        players[currentPlayerIndex].extraTurnsToTake++;
                        return; 
                    }
                    
                    let sortedPlayers = [...players].sort((a, b) => b.position - a.position);
                    let leader = sortedPlayers[0];
                    let last = sortedPlayers[sortedPlayers.length - 1];
        
                    if (leader.id === players[currentPlayerIdx].id && sortedPlayers.length > 1) {
                        leader = sortedPlayers[1];
                    }
        
                    if (leader && last && leader.id !== last.id) {
                        const tempPos = leader.position;
                        leader.position = last.position;
                        last.position = tempPos;
        
                        leader.onBoardPosition = leader.position;
                        last.onBoardPosition = last.position;
                        showMessage(`${leader.name} สลับตำแหน่งกับ ${last.name}!`, 'info', 4000);
                    } else {
                        showMessage("ไม่สามารถสลับตำแหน่งได้ในตอนนี้", 'info');
                    }
                }
            }
        ];


        // --- Master Question Bank (Augmented with 'category' and 'explanation') ---
        const allCards = {
            mission: { easy: [], medium: [], hard: [] },
            puzzle: { easy: [], medium: [], hard: [] }
        };
        
        function populateAllCards() {
            allCards.mission.easy = [
                { question: "5 + 11 = ?", answer: "16", difficulty: "easy", category: "addition" },
                { question: "18 - 7 = ?", answer: "11", difficulty: "easy", category: "subtraction" },
                { question: "4 × 8 = ?", answer: "32", difficulty: "easy", category: "multiplication" },
                { question: "20 ÷ 5 = ?", answer: "4", difficulty: "easy", category: "division" },
                { question: "(-3) + 9 = ?", answer: "6", difficulty: "easy", category: "addition" },
                { question: "10 + (-4) = ?", answer: "6", difficulty: "easy", category: "addition" },
                { question: "7 - 12 = ?", answer: "-5", difficulty: "easy", category: "subtraction" },
                { question: "(-5) - 3 = ?", answer: "-8", difficulty: "easy", category: "subtraction" },
                { question: "6 × (-3) = ?", answer: "-18", difficulty: "easy", category: "multiplication" },
                { question: "(-2) × 10 = ?", answer: "-20", difficulty: "easy", category: "multiplication" },
                { question: "15 ÷ (-3) = ?", answer: "-5", difficulty: "easy", category: "division" },
                { question: "(-14) ÷ 2 = ?", answer: "-7", difficulty: "easy", category: "division" },
                { question: "(-8) + (-5) = ?", answer: "-13", difficulty: "easy", category: "addition" },
                { question: "(-1) × (-13) = ?", answer: "13", difficulty: "easy", category: "multiplication" },
                { question: "(-25) ÷ (-5) = ?", answer: "5", difficulty: "easy", category: "division" },
                { question: "19 - 9 = ?", answer: "10", difficulty: "easy", category: "subtraction" },
                { question: "2 + 15 = ?", answer: "17", difficulty: "easy", category: "addition" },
                { question: "6 × 6 = ?", answer: "36", difficulty: "easy", category: "multiplication" },
                { question: "30 ÷ 3 = ?", answer: "10", difficulty: "easy", category: "division" },
                { question: "14 + (-14) = ?", answer: "0", difficulty: "easy", category: "addition" },
                { question: "8 - (-2) = ?", answer: "10", difficulty: "easy", category: "subtraction" },
		{ question: "15 + (-8) = ?", answer: "7", difficulty: "easy", category: "addition" },
		{ question: "15 + (-8) = ?", answer: "7", difficulty: "easy", category: "addition" },
		{ question: "12 + 13 = ?", answer: "25", difficulty: "easy", category: "addition" },
		{ question: "(-10) + 5 = ?", answer: "-5", difficulty: "easy", category: "addition" },
		{ question: "(-7) + (-11) = ?", answer: "-18", difficulty: "easy", category: "addition" },
		{ question: "20 + (-20) = ?", answer: "0", difficulty: "easy", category: "addition" },
		{ question: "8 + 9 = ?", answer: "17", difficulty: "easy", category: "addition" },
		{ question: "(-14) + 6 = ?", answer: "-8", difficulty: "easy", category: "addition" },
		{ question: "19 + (-5) = ?", answer: "14", difficulty: "easy", category: "addition" },
		{ question: "(-22) + 12 = ?", answer: "-10", difficulty: "easy", category: "addition" },
		{ question: "16 + (-16) = ?", answer: "0", difficulty: "easy", category: "addition" },
		{ question: "(-3) + 18 = ?", answer: "15", difficulty: "easy", category: "addition" },
		{ question: "11 + 14 = ?", answer: "25", difficulty: "easy", category: "addition" },
		{ question: "(-1) + (-15) = ?", answer: "-16", difficulty: "easy", category: "addition" },
		{ question: "30 + (-10) = ?", answer: "20", difficulty: "easy", category: "addition" },
		{ question: "(-25) + 15 = ?", answer: "-10", difficulty: "easy", category: "addition" },
		{ question: "6 + 17 = ?", answer: "23", difficulty: "easy", category: "addition" },
		{ question: "(-13) + 13 = ?", answer: "0", difficulty: "easy", category: "addition" },
		{ question: "10 + (-21) = ?", answer: "-11", difficulty: "easy", category: "addition" },
		{ question: "(-19) + 9 = ?", answer: "-10", difficulty: "easy", category: "addition" },
		{ question: "22 + (-7) = ?", answer: "15", difficulty: "easy", category: "addition" },
		{ question: "4 + (-12) = ?", answer: "-8", difficulty: "easy", category: "addition" },
		{ question: "(-6) + (-13) = ?", answer: "-19", difficulty: "easy", category: "addition" },
		{ question: "21 + 9 = ?", answer: "30", difficulty: "easy", category: "addition" },
		{ question: "18 + (-25) = ?", answer: "-7", difficulty: "easy", category: "addition" },
		{ question: "(-20) + 11 = ?", answer: "-9", difficulty: "easy", category: "addition" },
		{ question: "20 - 5 = ?", answer: "15", difficulty: "easy", category: "subtraction" },
		{ question: "10 - 15 = ?", answer: "-5", difficulty: "easy", category: "subtraction" },
		{ question: "8 - (-7) = ?", answer: "15", difficulty: "easy", category: "subtraction" },
		{ question: "(-12) - 3 = ?", answer: "-15", difficulty: "easy", category: "subtraction" },
		{ question: "(-15) - (-5) = ?", answer: "-10", difficulty: "easy", category: "subtraction" },
		{ question: "25 - 10 = ?", answer: "15", difficulty: "easy", category: "subtraction" },
		{ question: "9 - 19 = ?", answer: "-10", difficulty: "easy", category: "subtraction" },
		{ question: "14 - (-6) = ?", answer: "20", difficulty: "easy", category: "subtraction" },
		{ question: "(-20) - 5 = ?", answer: "-25", difficulty: "easy", category: "subtraction" },
		{ question: "(-8) - (-10) = ?", answer: "2", difficulty: "easy", category: "subtraction" },
		{ question: "30 - 18 = ?", answer: "12", difficulty: "easy", category: "subtraction" },
		{ question: "7 - 17 = ?", answer: "-10", difficulty: "easy", category: "subtraction" },
		{ question: "19 - (-1) = ?", answer: "20", difficulty: "easy", category: "subtraction" },
		{ question: "(-22) - 8 = ?", answer: "-30", difficulty: "easy", category: "subtraction" },
		{ question: "(-11) - (-11) = ?", answer: "0", difficulty: "easy", category: "subtraction" },
		{ question: "13 - 20 = ?", answer: "-7", difficulty: "easy", category: "subtraction" },
		{ question: "28 - 14 = ?", answer: "14", difficulty: "easy", category: "subtraction" },
		{ question: "6 - (-14) = ?", answer: "20", difficulty: "easy", category: "subtraction" },
		{ question: "(-16) - 4 = ?", answer: "-20", difficulty: "easy", category: "subtraction" },
		{ question: "(-9) - (-18) = ?", answer: "9", difficulty: "easy", category: "subtraction" },
		{ question: "1 - 10 = ?", answer: "-9", difficulty: "easy", category: "subtraction" },
		{ question: "23 - (-7) = ?", answer: "30", difficulty: "easy", category: "subtraction" },
		{ question: "(-30) - (-10) = ?", answer: "-20", difficulty: "easy", category: "subtraction" },
		{ question: "17 - 8 = ?", answer: "9", difficulty: "easy", category: "subtraction" },
		{ question: "(-5) - 15 = ?", answer: "-20", difficulty: "easy", category: "subtraction" },
		{ question: "5 * (-6) = ?", answer: "-30", difficulty: "easy", category: "multiplication" },
		{ question: "(-7) * 4 = ?", answer: "-28", difficulty: "easy", category: "multiplication" },
		{ question: "(-8) * (-3) = ?", answer: "24", difficulty: "easy", category: "multiplication" },
		{ question: "9 * 5 = ?", answer: "45", difficulty: "easy", category: "multiplication" },
		{ question: "10 * (-4) = ?", answer: "-40", difficulty: "easy", category: "multiplication" },
		{ question: "(-11) * 3 = ?", answer: "-33", difficulty: "easy", category: "multiplication" },
		{ question: "(-6) * (-6) = ?", answer: "36", difficulty: "easy", category: "multiplication" },
		{ question: "12 * 2 = ?", answer: "24", difficulty: "easy", category: "multiplication" },
		{ question: "15 * (-1) = ?", answer: "-15", difficulty: "easy", category: "multiplication" },
		{ question: "(-9) * 0 = ?", answer: "0", difficulty: "easy", category: "multiplication" },
		{ question: "7 * (-5) = ?", answer: "-35", difficulty: "easy", category: "multiplication" },
		{ question: "(-4) * 9 = ?", answer: "-36", difficulty: "easy", category: "multiplication" },
		{ question: "(-5) * (-7) = ?", answer: "35", difficulty: "easy", category: "multiplication" },
		{ question: "8 * 6 = ?", answer: "48", difficulty: "easy", category: "multiplication" },
		{ question: "(-1) * 25 = ?", answer: "-25", difficulty: "easy", category: "multiplication" },
		{ question: "11 * (-5) = ?", answer: "-55", difficulty: "easy", category: "multiplication" },
		{ question: "(-3) * (-12) = ?", answer: "36", difficulty: "easy", category: "multiplication" },
		{ question: "6 * 9 = ?", answer: "54", difficulty: "easy", category: "multiplication" },
		{ question: "(-10) * 10 = ?", answer: "-100", difficulty: "easy", category: "multiplication" },
		{ question: "4 * (-12) = ?", answer: "-48", difficulty: "easy", category: "multiplication" },
		{ question: "(-2) * 20 = ?", answer: "-40", difficulty: "easy", category: "multiplication" },
		{ question: "(-8) * (-5) = ?", answer: "40", difficulty: "easy", category: "multiplication" },
		{ question: "7 * 7 = ?", answer: "49", difficulty: "easy", category: "multiplication" },
		{ question: "13 * (-3) = ?", answer: "-39", difficulty: "easy", category: "multiplication" },
		{ question: "(-12) * (-4) = ?", answer: "48", difficulty: "easy", category: "multiplication" },
		{ question: "(-30) / 6 = ?", answer: "-5", difficulty: "easy", category: "division" },
		{ question: "28 / (-4) = ?", answer: "-7", difficulty: "easy", category: "division" },
		{ question: "(-24) / (-3) = ?", answer: "8", difficulty: "easy", category: "division" },
		{ question: "45 / 9 = ?", answer: "5", difficulty: "easy", category: "division" },
		{ question: "(-40) / 10 = ?", answer: "-4", difficulty: "easy", category: "division" },
		{ question: "(-33) / 11 = ?", answer: "-3", difficulty: "easy", category: "division" },
		{ question: "36 / (-6) = ?", answer: "-6", difficulty: "easy", category: "division" },
		{ question: "24 / 12 = ?", answer: "2", difficulty: "easy", category: "division" },
		{ question: "(-15) / (-1) = ?", answer: "15", difficulty: "easy", category: "division" },
		{ question: "0 / (-9) = ?", answer: "0", difficulty: "easy", category: "division" },
		{ question: "(-35) / 5 = ?", answer: "-7", difficulty: "easy", category: "division" },
		{ question: "36 / (-9) = ?", answer: "-4", difficulty: "easy", category: "division" },
		{ question: "(-35) / (-7) = ?", answer: "5", difficulty: "easy", category: "division" },
		{ question: "48 / 8 = ?", answer: "6", difficulty: "easy", category: "division" },
		{ question: "(-25) / 5 = ?", answer: "-5", difficulty: "easy", category: "division" },
		{ question: "(-55) / (-11) = ?", answer: "5", difficulty: "easy", category: "division" },
		{ question: "36 / (-12) = ?", answer: "-3", difficulty: "easy", category: "division" },
		{ question: "54 / 6 = ?", answer: "9", difficulty: "easy", category: "division" },
		{ question: "(-100) / 10 = ?", answer: "-10", difficulty: "easy", category: "division" },
		{ question: "(-48) / (-4) = ?", answer: "12", difficulty: "easy", "category": "division" },
		{ question: "(-40) / 20 = ?", answer: "-2", difficulty: "easy", category: "division" },
		{ question: "40 / (-8) = ?", answer: "-5", difficulty: "easy", category: "division" },
		{ question: "49 / (-7) = ?", answer: "-7", difficulty: "easy", category: "division" },
		{ question: "(-39) / 13 = ?", answer: "-3", difficulty: "easy", category: "division" },
		{ question: "48 / (-12) = ?", answer: "-4", difficulty: "easy", "category": "division" }

            ];

            allCards.mission.medium = [
                { question: "(-25) + 50 = ?", answer: "25", difficulty: "medium", category: "addition" },
                { question: "30 - (-15) = ?", answer: "45", difficulty: "medium", category: "subtraction", explanation: "การลบด้วยจำนวนลบ คือการบวกด้วยจำนวนบวก<br>30 - (-15) = 30 + 15 = 45" },
                { question: "(-12) × 11 = ?", answer: "-132", difficulty: "medium", category: "multiplication", explanation: "จำนวนลบคูณจำนวนบวก ผลลัพธ์เป็นลบ" },
                { question: "50 + (10 × (-2)) = ?", answer: "30", difficulty: "medium", category: "order_of_operations", explanation: "1. ทำในวงเล็บก่อน: 10 × (-2) = -20<br>2. นำไปบวก: 50 + (-20) = 30" },
                { question: "100 - (40 ÷ 5) = ?", answer: "92", difficulty: "medium", category: "order_of_operations", explanation: "1. ทำในวงเล็บก่อน: 40 ÷ 5 = 8<br>2. นำไปลบ: 100 - 8 = 92" },
                { question: "35 - 5 × 4 = ?", answer: "15", difficulty: "medium", category: "order_of_operations", explanation: "ต้องคูณก่อนลบ<br>1. คูณ: 5 × 4 = 20<br>2. ลบ: 35 - 20 = 15" },
                { question: "80 - 30 ÷ (-3) = ?", answer: "90", difficulty: "medium", category: "order_of_operations", explanation: "ต้องหารก่อนลบ<br>1. หาร: 30 ÷ (-3) = -10<br>2. ลบ: 80 - (-10) = 80 + 10 = 90" },
                { question: "12 × (10 - 15) = ?", answer: "-60", difficulty: "medium", category: "order_of_operations", explanation: "1. ทำในวงเล็บก่อน: 10 - 15 = -5<br>2. นำไปคูณ: 12 × (-5) = -60" },
// --- ชุดคำถามภารกิจระดับปานกลาง 100 ข้อ (เน้นลำดับการดำเนินการ) ---
{ question: "5 * (9 - 4) = ?", answer: "25", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 9 - 4 = 5<br>2. คูณ: 5 * 5 = 25" },
{ question: "(8 + (-12)) * 3 = ?", answer: "-12", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 8 + (-12) = -4<br>2. คูณ: -4 * 3 = -12" },
{ question: "20 / (2 - 7) = ?", answer: "-4", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 2 - 7 = -5<br>2. หาร: 20 / (-5) = -4" },
{ question: "(-30) / (8 + 7) = ?", answer: "-2", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 8 + 7 = 15<br>2. หาร: -30 / 15 = -2" },
{ question: "10 + (4 * 5) = ?", answer: "30", difficulty: "medium", category: "order_of_operations", explanation: "1. คูณก่อน: 4 * 5 = 20<br>2. บวก: 10 + 20 = 30" },
{ question: "18 - (6 * 3) = ?", answer: "0", difficulty: "medium", category: "order_of_operations", explanation: "1. คูณก่อน: 6 * 3 = 18<br>2. ลบ: 18 - 18 = 0" },
{ question: "(-7) * 2 + 10 = ?", answer: "-4", difficulty: "medium", category: "order_of_operations", explanation: "1. คูณก่อน: (-7) * 2 = -14<br>2. บวก: -14 + 10 = -4" },
{ question: "40 / 5 - 2 = ?", answer: "6", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: 40 / 5 = 8<br>2. ลบ: 8 - 2 = 6" },
{ question: "(5 - 15) * (-2) = ?", answer: "20", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 5 - 15 = -10<br>2. คูณ: -10 * (-2) = 20" },
{ question: "50 + (30 / (-6)) = ?", answer: "45", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: 30 / (-6) = -5<br>2. บวก: 50 + (-5) = 45" },
{ question: "3 * (-4) + 20 = ?", answer: "8", difficulty: "medium", category: "order_of_operations", explanation: "1. คูณก่อน: 3 * (-4) = -12<br>2. บวก: -12 + 20 = 8" },
{ question: "16 - 20 / 4 = ?", answer: "11", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: 20 / 4 = 5<br>2. ลบ: 16 - 5 = 11" },
{ question: "(22 - 2) / (-5) = ?", answer: "-4", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 22 - 2 = 20<br>2. หาร: 20 / (-5) = -4" },
{ question: "(-8) - 3 * 2 = ?", answer: "-14", difficulty: "medium", category: "order_of_operations", explanation: "1. คูณก่อน: 3 * 2 = 6<br>2. ลบ: -8 - 6 = -14" },
{ question: "14 + ((-10) / 2) = ?", answer: "9", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: (-10) / 2 = -5<br>2. บวก: 14 + (-5) = 9" },
{ question: "6 * ((-3) + 1) = ?", answer: "-12", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: (-3) + 1 = -2<br>2. คูณ: 6 * (-2) = -12" },
{ question: "(-18 / 9) - 1 = ?", answer: "-3", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: -18 / 9 = -2<br>2. ลบ: -2 - 1 = -3" },
{ question: "7 - (4 - 8) = ?", answer: "11", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 4 - 8 = -4<br>2. ลบ: 7 - (-4) = 11" },
{ question: "5 * (-2) - 10 = ?", answer: "-20", difficulty: "medium", category: "order_of_operations", explanation: "1. คูณก่อน: 5 * (-2) = -10<br>2. ลบ: -10 - 10 = -20" },
{ question: "24 / (-4) + 6 = ?", answer: "0", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: 24 / (-4) = -6<br>2. บวก: -6 + 6 = 0" },
{ question: "100 / (10 + 10) = ?", answer: "5", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 10 + 10 = 20<br>2. หาร: 100 / 20 = 5" },
{ question: "(5 + 5) * (-5) = ?", answer: "-50", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 5 + 5 = 10<br>2. คูณ: 10 * (-5) = -50" },
{ question: "40 - 8 * 3 = ?", answer: "16", difficulty: "medium", category: "order_of_operations", explanation: "1. คูณก่อน: 8 * 3 = 24<br>2. ลบ: 40 - 24 = 16" },
{ question: "30 + ((-20) / 4) = ?", answer: "25", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: -20 / 4 = -5<br>2. บวก: 30 + (-5) = 25" },
{ question: "(-9 - 6) / 3 = ?", answer: "-5", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: -9 - 6 = -15<br>2. หาร: -15 / 3 = -5" },
{ question: "2 * (15 - 20) = ?", answer: "-10", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 15 - 20 = -5<br>2. คูณ: 2 * (-5) = -10" },
{ question: "12 - ((-4) * 2) = ?", answer: "20", difficulty: "medium", category: "order_of_operations", explanation: "1. คูณก่อน: (-4) * 2 = -8<br>2. ลบ: 12 - (-8) = 20" },
{ question: "60 / (-10) + 7 = ?", answer: "1", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: 60 / (-10) = -6<br>2. บวก: -6 + 7 = 1" },
{ question: "4 * (-5) - (-2) = ?", answer: "-18", difficulty: "medium", category: "order_of_operations", explanation: "1. คูณก่อน: 4 * (-5) = -20<br>2. ลบ: -20 - (-2) = -18" },
{ question: "(-36 / 6) + 6 = ?", answer: "0", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: -36 / 6 = -6<br>2. บวก: -6 + 6 = 0" },
{ question: "8 * (3 - 3) = ?", answer: "0", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 3 - 3 = 0<br>2. คูณ: 8 * 0 = 0" },
{ question: "(14 - 24) * 1 = ?", answer: "-10", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 14 - 24 = -10<br>2. คูณ: -10 * 1 = -10" },
{ question: "25 + 5 * (-4) = ?", answer: "5", difficulty: "medium", category: "order_of_operations", explanation: "1. คูณก่อน: 5 * (-4) = -20<br>2. บวก: 25 + (-20) = 5" },
{ question: "32 / (-8) - 1 = ?", answer: "-5", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: 32 / (-8) = -4<br>2. ลบ: -4 - 1 = -5" },
{ question: "(-7 + 2) * 6 = ?", answer: "-30", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: -7 + 2 = -5<br>2. คูณ: -5 * 6 = -30" },
{ question: "10 - (10 - 20) = ?", answer: "20", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 10 - 20 = -10<br>2. ลบ: 10 - (-10) = 20" },
{ question: "(-50 / (-5)) + 3 = ?", answer: "13", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: -50 / (-5) = 10<br>2. บวก: 10 + 3 = 13" },
{ question: "9 * (2 - (-2)) = ?", answer: "36", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 2 - (-2) = 4<br>2. คูณ: 9 * 4 = 36" },
{ question: "13 + (-2) * 5 = ?", answer: "3", difficulty: "medium", category: "order_of_operations", explanation: "1. คูณก่อน: (-2) * 5 = -10<br>2. บวก: 13 + (-10) = 3" },
{ question: "(21 / 7) - 7 = ?", answer: "-4", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: 21 / 7 = 3<br>2. ลบ: 3 - 7 = -4" },
{ question: "3 * ((-10) + 5) = ?", answer: "-15", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: (-10) + 5 = -5<br>2. คูณ: 3 * (-5) = -15" },
{ question: "19 - (-3) * 2 = ?", answer: "25", difficulty: "medium", category: "order_of_operations", explanation: "1. คูณก่อน: (-3) * 2 = -6<br>2. ลบ: 19 - (-6) = 25" },
{ question: "44 / ((-5) - 6) = ?", answer: "-4", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: -5 - 6 = -11<br>2. หาร: 44 / (-11) = -4" },
{ question: "1 - (12 / (-4)) = ?", answer: "4", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: 12 / (-4) = -3<br>2. ลบ: 1 - (-3) = 4" },
{ question: "(-8) * (1 + 4) = ?", answer: "-40", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 1 + 4 = 5<br>2. คูณ: (-8) * 5 = -40" },
{ question: "30 / (10 - 20) = ?", answer: "-3", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 10 - 20 = -10<br>2. หาร: 30 / (-10) = -3" },
{ question: "6 - 6 * 2 = ?", answer: "-6", difficulty: "medium", category: "order_of_operations", explanation: "1. คูณก่อน: 6 * 2 = 12<br>2. ลบ: 6 - 12 = -6" },
{ question: "50 / (-25) + 2 = ?", answer: "0", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: 50 / (-25) = -2<br>2. บวก: -2 + 2 = 0" },
{ question: "(-11 + 1) * (-3) = ?", answer: "30", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: -11 + 1 = -10<br>2. คูณ: -10 * (-3) = 30" },
{ question: "40 - (10 - 5) = ?", answer: "35", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 10 - 5 = 5<br>2. ลบ: 40 - 5 = 35" },
{ question: "(-10) - ((-10) / 5) = ?", answer: "-8", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: (-10) / 5 = -2<br>2. ลบ: -10 - (-2) = -8" },
{ question: "7 * (-2 + 2) = ?", answer: "0", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: -2 + 2 = 0<br>2. คูณ: 7 * 0 = 0" },
{ question: "15 / (1 - 4) = ?", answer: "-5", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 1 - 4 = -3<br>2. หาร: 15 / (-3) = -5" },
{ question: "20 + (-10) * 2 = ?", answer: "0", difficulty: "medium", category: "order_of_operations", explanation: "1. คูณก่อน: -10 * 2 = -20<br>2. บวก: 20 + (-20) = 0" },
{ question: "35 / 7 - 10 = ?", answer: "-5", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: 35 / 7 = 5<br>2. ลบ: 5 - 10 = -5" },
{ question: "(-6 - 4) * 3 = ?", answer: "-30", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: -6 - 4 = -10<br>2. คูณ: -10 * 3 = -30" },
{ question: "9 - (18 / (-9)) = ?", answer: "11", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: 18 / (-9) = -2<br>2. ลบ: 9 - (-2) = 11" },
{ question: "8 * (-1 - 1) = ?", answer: "-16", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: -1 - 1 = -2<br>2. คูณ: 8 * (-2) = -16" },
{ question: "(-20 + 5) / 5 = ?", answer: "-3", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: -20 + 5 = -15<br>2. หาร: -15 / 5 = -3" },
{ question: "17 - 4 * 3 = ?", answer: "5", difficulty: "medium", category: "order_of_operations", explanation: "1. คูณก่อน: 4 * 3 = 12<br>2. ลบ: 17 - 12 = 5" },
{ question: "30 / (-3) + 20 = ?", answer: "10", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: 30 / (-3) = -10<br>2. บวก: -10 + 20 = 10" },
{ question: "(4 - 9) * 4 = ?", answer: "-20", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 4 - 9 = -5<br>2. คูณ: -5 * 4 = -20" },
{ question: "22 - (2 * 11) = ?", answer: "0", difficulty: "medium", category: "order_of_operations", explanation: "1. คูณก่อน: 2 * 11 = 22<br>2. ลบ: 22 - 22 = 0" },
{ question: "(-100 / 10) - 10 = ?", answer: "-20", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: -100 / 10 = -10<br>2. ลบ: -10 - 10 = -20" },
{ question: "6 * (-8 + 4) = ?", answer: "-24", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: -8 + 4 = -4<br>2. คูณ: 6 * (-4) = -24" },
{ question: "1 - (-5 * 2) = ?", answer: "11", difficulty: "medium", category: "order_of_operations", explanation: "1. คูณก่อน: -5 * 2 = -10<br>2. ลบ: 1 - (-10) = 11" },
{ question: "28 / (10 - 3) = ?", answer: "4", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 10 - 3 = 7<br>2. หาร: 28 / 7 = 4" },
{ question: "(-6) * (-3) + 2 = ?", answer: "20", difficulty: "medium", category: "order_of_operations", explanation: "1. คูณก่อน: (-6) * (-3) = 18<br>2. บวก: 18 + 2 = 20" },
{ question: "50 - 100 / 2 = ?", answer: "0", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: 100 / 2 = 50<br>2. ลบ: 50 - 50 = 0" },
{ question: "(30 - 40) * (-1) = ?", answer: "10", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 30 - 40 = -10<br>2. คูณ: -10 * (-1) = 10" },
{ question: "15 + (45 / (-9)) = ?", answer: "10", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: 45 / (-9) = -5<br>2. บวก: 15 + (-5) = 10" },
{ question: "2 * (-20 + 5) = ?", answer: "-30", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: -20 + 5 = -15<br>2. คูณ: 2 * (-15) = -30" },
{ question: "14 - 7 * 3 = ?", answer: "-7", difficulty: "medium", category: "order_of_operations", explanation: "1. คูณก่อน: 7 * 3 = 21<br>2. ลบ: 14 - 21 = -7" },
{ question: "(-81 / 9) + 9 = ?", answer: "0", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: -81 / 9 = -9<br>2. บวก: -9 + 9 = 0" },
{ question: "11 * (5 - 8) = ?", answer: "-33", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 5 - 8 = -3<br>2. คูณ: 11 * (-3) = -33" },
{ question: "20 - ((-15) / 3) = ?", answer: "25", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: (-15) / 3 = -5<br>2. ลบ: 20 - (-5) = 25" },
{ question: "(-4 - 4) * 4 = ?", answer: "-32", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: -4 - 4 = -8<br>2. คูณ: -8 * 4 = -32" },
{ question: "(-12) + 6 / (-2) = ?", answer: "-15", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: 6 / (-2) = -3<br>2. บวก: -12 + (-3) = -15" },
{ question: "70 / (2 - 9) = ?", answer: "-10", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 2 - 9 = -7<br>2. หาร: 70 / (-7) = -10" },
{ question: "(-5) * 5 + 5 = ?", answer: "-20", difficulty: "medium", category: "order_of_operations", explanation: "1. คูณก่อน: -5 * 5 = -25<br>2. บวก: -25 + 5 = -20" },
{ question: "13 - (13 - 1) = ?", answer: "1", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 13 - 1 = 12<br>2. ลบ: 13 - 12 = 1" },
{ question: "(49 / (-7)) + 8 = ?", answer: "1", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: 49 / (-7) = -7<br>2. บวก: -7 + 8 = 1" },
{ question: "9 * (-3 - 2) = ?", answer: "-45", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: -3 - 2 = -5<br>2. คูณ: 9 * (-5) = -45" },
{ question: "21 + 27 / (-3) = ?", answer: "12", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: 27 / (-3) = -9<br>2. บวก: 21 + (-9) = 12" },
{ question: "(-25 + 10) * 2 = ?", answer: "-30", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: -25 + 10 = -15<br>2. คูณ: -15 * 2 = -30" },
{ question: "100 - 10 * 5 = ?", answer: "50", difficulty: "medium", category: "order_of_operations", explanation: "1. คูณก่อน: 10 * 5 = 50<br>2. ลบ: 100 - 50 = 50" },
{ question: "64 / (-8) - (-8) = ?", answer: "0", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: 64 / (-8) = -8<br>2. ลบ: -8 - (-8) = 0" },
{ question: "7 * (4 - 11) = ?", answer: "-49", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: 4 - 11 = -7<br>2. คูณ: 7 * (-7) = -49" },
{ question: "3 - (30 / (-5)) = ?", answer: "9", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: 30 / (-5) = -6<br>2. ลบ: 3 - (-6) = 9" },
{ question: "(-14 - 6) / 2 = ?", answer: "-10", difficulty: "medium", category: "order_of_operations", explanation: "1. ในวงเล็บ: -14 - 6 = -20<br>2. หาร: -20 / 2 = -10" },
{ question: "(-9) * 3 + 7 = ?", answer: "-20", difficulty: "medium", category: "order_of_operations", explanation: "1. คูณก่อน: -9 * 3 = -27<br>2. บวก: -27 + 7 = -20" },
{ question: "33 / (-3) - 3 = ?", answer: "-14", difficulty: "medium", category: "order_of_operations", explanation: "1. หารก่อน: 33 / (-3) = -11<br>2. ลบ: -11 - 3 = -14" }
            ];

            allCards.mission.hard = [
                { question: "(-5) × (12 - 7) + 30 = ?", answer: "5", difficulty: "hard", category: "order_of_operations", explanation: "1. ทำในวงเล็บ: 12 - 7 = 5<br>2. คูณ: (-5) × 5 = -25<br>3. บวก: -25 + 30 = 5" },
                { question: "(100 ÷ (-5)) - (5 × 6) = ?", answer: "-50", difficulty: "hard", category: "order_of_operations", explanation: "1. ทำวงเล็บซ้าย: 100 ÷ (-5) = -20<br>2. ทำวงเล็บขวา: 5 × 6 = 30<br>3. นำผลมาลบกัน: -20 - 30 = -50" },
                { question: "((-40) + 15) × (18 ÷ (-9)) = ?", answer: "50", difficulty: "hard", category: "order_of_operations", explanation: "1. ทำวงเล็บซ้าย: -40 + 15 = -25<br>2. ทำวงเล็บขวา: 18 ÷ (-9) = -2<br>3. นำผลมาคูณกัน: (-25) × (-2) = 50" },
                { question: "-200 ÷ (4 × (-5)) - 10 = ?", answer: "0", difficulty: "hard", category: "order_of_operations", explanation: "1. ทำในวงเล็บ: 4 × (-5) = -20<br>2. หาร: -200 ÷ (-20) = 10<br>3. ลบ: 10 - 10 = 0" },
                { question: "(3 × (-15)) + (80 ÷ (-4)) = ?", answer: "-65", difficulty: "hard", category: "order_of_operations", explanation: "1. ทำวงเล็บซ้าย: 3 × (-15) = -45<br>2. ทำวงเล็บขวา: 80 ÷ (-4) = -20<br>3. นำผลมาบวกกัน: -45 + (-20) = -65" },
// --- ชุดคำถามภารกิจระดับยาก 100 ข้อ (เน้นลำดับการดำเนินการที่ซับซ้อน) ---
{ question: "(5 * (-4)) + (6 * 3) = ?", answer: "-2", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บแรก: 5*(-4) = -20<br>2. วงเล็บสอง: 6*3 = 18<br>3. บวก: -20 + 18 = -2" },
{ question: "(40 / -8) - (10 / 2) = ?", answer: "-10", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บแรก: 40/(-8) = -5<br>2. วงเล็บสอง: 10/2 = 5<br>3. ลบ: -5 - 5 = -10" },
{ question: "((-2) - 8) * (5 - 7) = ?", answer: "20", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บแรก: -2 - 8 = -10<br>2. วงเล็บสอง: 5 - 7 = -2<br>3. คูณ: (-10) * (-2) = 20" },
{ question: "100 - (5 * (10 + 2)) = ?", answer: "40", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บในสุด: 10+2=12<br>2. คูณในวงเล็บใหญ่: 5*12=60<br>3. ลบ: 100 - 60 = 40" },
{ question: "((8 - 2) * 5) / (-3) = ?", answer: "-10", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บในสุด: 8-2=6<br>2. คูณ: 6*5=30<br>3. หาร: 30 / (-3) = -10" },
{ question: "20 + 30 / (-2) * 3 = ?", answer: "-25", difficulty: "hard", category: "order_of_operations", explanation: "1. หาร: 30/(-2)=-15<br>2. คูณ: -15*3=-45<br>3. บวก: 20 + (-45) = -25" },
{ question: "8 * (-5) - 20 / 4 = ?", answer: "-45", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณ: 8*(-5)=-40<br>2. หาร: 20/4=5<br>3. ลบ: -40 - 5 = -45" },
{ question: "50 / ((-10) + (-15)) = ?", answer: "-2", difficulty: "hard", category: "order_of_operations", explanation: "1. ในวงเล็บ: -10 + (-15) = -25<br>2. หาร: 50 / (-25) = -2" },
{ question: "(7 - 12) * ((-4) + 2) = ?", answer: "10", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บแรก: 7-12=-5<br>2. วงเล็บสอง: -4+2=-2<br>3. คูณ: (-5) * (-2) = 10" },
{ question: "30 - (100 / (5 * (-4))) = ?", answer: "35", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บในสุด: 5*(-4)=-20<br>2. หาร: 100/(-20)=-5<br>3. ลบ: 30 - (-5) = 35" },
{ question: "(6 * (-6)) + (8 * 2) = ?", answer: "-20", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บแรก: 6*(-6)=-36<br>2. วงเล็บสอง: 8*2=16<br>3. บวก: -36 + 16 = -20" },
{ question: "(81 / 9) - (4 * 5) = ?", answer: "-11", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บแรก: 81/9=9<br>2. วงเล็บสอง: 4*5=20<br>3. ลบ: 9 - 20 = -11" },
{ question: "((15 - 5) * (-2)) / 4 = ?", answer: "-5", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บในสุด: 15-5=10<br>2. คูณ: 10*(-2)=-20<br>3. หาร: -20 / 4 = -5" },
{ question: "10 * 3 - 50 / 5 = ?", answer: "20", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณ: 10*3=30<br>2. หาร: 50/5=10<br>3. ลบ: 30 - 10 = 20" },
{ question: "70 / (2 * 5 - 17) = ?", answer: "-10", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณในวงเล็บ: 2*5=10<br>2. ลบในวงเล็บ: 10-17=-7<br>3. หาร: 70 / (-7) = -10" },
{ question: "((-9) + 4) * ((-10) / 2) = ?", answer: "25", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บแรก: -9+4=-5<br>2. วงเล็บสอง: -10/2=-5<br>3. คูณ: (-5) * (-5) = 25" },
{ question: "40 - 5 * 6 + 10 = ?", answer: "20", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณ: 5*6=30<br>2. ลบ: 40-30=10<br>3. บวก: 10 + 10 = 20" },
{ question: "(-1) * (100 - 20 * 4) = ?", answer: "-20", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณในวงเล็บ: 20*4=80<br>2. ลบในวงเล็บ: 100-80=20<br>3. คูณ: (-1) * 20 = -20" },
{ question: "(36 / (-6)) + ((-14) / 2) = ?", answer: "-13", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บแรก: 36/(-6)=-6<br>2. วงเล็บสอง: -14/2=-7<br>3. บวก: -6 + (-7) = -13" },
{ question: "50 + (10 - 2 * 8) = ?", answer: "44", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณในวงเล็บ: 2*8=16<br>2. ลบในวงเล็บ: 10-16=-6<br>3. บวก: 50 + (-6) = 44" },
{ question: "(7 * (-3)) - (12 / (-4)) = ?", answer: "-18", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บแรก: 7*(-3)=-21<br>2. วงเล็บสอง: 12/(-4)=-3<br>3. ลบ: -21 - (-3) = -18" },
{ question: "((20 + 20) / 4) * (-1) = ?", answer: "-10", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บในสุด: 20+20=40<br>2. หาร: 40/4=10<br>3. คูณ: 10 * (-1) = -10" },
{ question: "12 * (-2) + 8 * 3 = ?", answer: "0", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณซ้าย: 12*(-2)=-24<br>2. คูณขวา: 8*3=24<br>3. บวก: -24 + 24 = 0" },
{ question: "90 / ((-15) * (4 - 1)) = ?", answer: "-2", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บในสุด: 4-1=3<br>2. คูณในวงเล็บใหญ่: -15*3=-45<br>3. หาร: 90 / (-45) = -2" },
{ question: "(-5 - 5 - 5) * 5 = ?", answer: "-75", difficulty: "hard", category: "order_of_operations", explanation: "1. ในวงเล็บ: -5-5-5=-15<br>2. คูณ: -15 * 5 = -75" },
{ question: "2 - (3 * (4 - (5 * 2))) = ?", answer: "20", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บในสุด: 5*2=10<br>2. วงเล็บกลาง: 4-10=-6<br>3. คูณ: 3*(-6)=-18<br>4. ลบ: 2 - (-18) = 20" },
{ question: "(60 / (-10)) * (30 / (-6)) = ?", answer: "30", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บแรก: 60/(-10)=-6<br>2. วงเล็บสอง: 30/(-6)=-5<br>3. คูณ: (-6) * (-5) = 30" },
{ question: "25 - (10 * 3) + (20 / 4) = ?", answer: "0", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณ: 10*3=30<br>2. หาร: 20/4=5<br>3. คำนวณ: 25-30+5=0" },
{ question: "(((-10) * (-10)) / 10) - 10 = ?", answer: "0", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณในวงเล็บ: (-10)*(-10)=100<br>2. หารในวงเล็บ: 100/10=10<br>3. ลบ: 10 - 10 = 0" },
{ question: "-10 * -2 / -4 + 5 = ?", answer: "0", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณ: -10*(-2)=20<br>2. หาร: 20/(-4)=-5<br>3. บวก: -5 + 5 = 0" },
{ question: "50 - ((-5) * (-5) - 5) = ?", answer: "30", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณในวงเล็บ: (-5)*(-5)=25<br>2. ลบในวงเล็บ: 25-5=20<br>3. ลบ: 50 - 20 = 30" },
{ question: "(4 * 5 * 6) / 10 = ?", answer: "12", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณในวงเล็บ: 4*5*6=120<br>2. หาร: 120 / 10 = 12" },
{ question: "2 * (2 * (2 * (2 - 5))) = ?", answer: "-24", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บในสุด: 2-5=-3<br>2. วงเล็บกลาง: 2*(-3)=-6<br>3. วงเล็บนอก: 2*(-6)=-12<br>4. คูณสุดท้าย: 2 * (-12) = -24" },
{ question: "(7 * 8) - (9 * 6) = ?", answer: "2", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บแรก: 7*8=56<br>2. วงเล็บสอง: 9*6=54<br>3. ลบ: 56 - 54 = 2" },
{ question: "100 / (-2) / 5 / (-1) = ?", answer: "10", difficulty: "hard", category: "order_of_operations", explanation: "ทำจากซ้ายไปขวา<br>1. 100/(-2)=-50<br>2. -50/5=-10<br>3. -10/(-1)=10" },
{ question: "30 - 3 * (10 - 3) = ?", answer: "9", difficulty: "hard", category: "order_of_operations", explanation: "1. ในวงเล็บ: 10-3=7<br>2. คูณ: 3*7=21<br>3. ลบ: 30 - 21 = 9" },
{ question: "((6-10) * (-5)) / (2-4) = ?", answer: "-10", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บเศษ: 6-10=-4<br>2. คูณเศษ: -4*(-5)=20<br>3. วงเล็บส่วน: 2-4=-2<br>4. หาร: 20/(-2)=-10" },
{ question: "4 * (-2) * (-3) - 10 = ?", answer: "14", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณ: 4*(-2)=-8<br>2. คูณ: -8*(-3)=24<br>3. ลบ: 24 - 10 = 14" },
{ question: "200 / (8 * 5 - 30) = ?", answer: "20", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณในวงเล็บ: 8*5=40<br>2. ลบในวงเล็บ: 40-30=10<br>3. หาร: 200 / 10 = 20" },
{ question: "(10 * (-2)) + (10 * 3) = ?", answer: "10", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บแรก: 10*(-2)=-20<br>2. วงเล็บสอง: 10*3=30<br>3. บวก: -20+30=10" },
{ question: "-50 + (100 / 5) * 3 = ?", answer: "10", difficulty: "hard", category: "order_of_operations", explanation: "1. หาร: 100/5=20<br>2. คูณ: 20*3=60<br>3. บวก: -50+60=10" },
{ question: "((12 - 4) * (-10)) / 8 = ?", answer: "-10", difficulty: "hard", category: "order_of_operations", explanation: "1. ในวงเล็บ: 12-4=8<br>2. คูณ: 8*(-10)=-80<br>3. หาร: -80 / 8 = -10" },
{ question: "(13 * 0) - (14 * -1) = ?", answer: "14", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บแรก: 13*0=0<br>2. วงเล็บสอง: 14*(-1)=-14<br>3. ลบ: 0 - (-14) = 14" },
{ question: "200 - 100 - 50 - 10 = ?", answer: "40", difficulty: "hard", category: "order_of_operations", explanation: "ทำจากซ้ายไปขวา<br>1. 200-100=100<br>2. 100-50=50<br>3. 50-10=40" },
{ question: "10 - (20 - (30 - 5)) = ?", answer: "15", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บในสุด: 30-5=25<br>2. วงเล็บกลาง: 20-25=-5<br>3. ลบ: 10 - (-5) = 15" },
{ question: "(48 / (-6)) * (20 / (-4)) = ?", answer: "40", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บแรก: 48/(-6)=-8<br>2. วงเล็บสอง: 20/(-4)=-5<br>3. คูณ: (-8)*(-5)=40" },
{ question: "5 * 5 - 6 * 6 = ?", answer: "-11", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณซ้าย: 5*5=25<br>2. คูณขวา: 6*6=36<br>3. ลบ: 25 - 36 = -11" },
{ question: "((5 - 20) / 3) * (-2) = ?", answer: "10", difficulty: "hard", category: "order_of_operations", explanation: "1. ในวงเล็บ: 5-20=-15<br>2. หาร: -15/3=-5<br>3. คูณ: -5 * (-2) = 10" },
{ question: "18 / 3 + 12 / 4 = ?", answer: "9", difficulty: "hard", category: "order_of_operations", explanation: "1. หารซ้าย: 18/3=6<br>2. หารขวา: 12/4=3<br>3. บวก: 6+3=9" },
{ question: "100 / (5 * (-2) - 10) = ?", answer: "-5", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณในวงเล็บ: 5*(-2)=-10<br>2. ลบในวงเล็บ: -10-10=-20<br>3. หาร: 100 / (-20) = -5" },
{ question: "(4 - 14) * (2 - 2) = ?", answer: "0", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บแรก: 4-14=-10<br>2. วงเล็บสอง: 2-2=0<br>3. คูณ: -10 * 0 = 0" },
{ question: "-100 + 50 * 3 / 2 = ?", answer: "-25", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณ: 50*3=150<br>2. หาร: 150/2=75<br>3. บวก: -100 + 75 = -25" },
{ question: "((8 * 4) - 2) / (-6) = ?", answer: "-5", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณในวงเล็บ: 8*4=32<br>2. ลบในวงเล็บ: 32-2=30<br>3. หาร: 30 / (-6) = -5" },
{ question: "(10 * 10) - (100 / 10) = ?", answer: "90", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บแรก: 10*10=100<br>2. วงเล็บสอง: 100/10=10<br>3. ลบ: 100 - 10 = 90" },
{ question: "20 * (5 - (4 / (-2))) = ?", answer: "140", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บในสุด: 4/(-2)=-2<br>2. วงเล็บกลาง: 5-(-2)=7<br>3. คูณ: 20 * 7 = 140" },
{ question: "3 * 3 * 3 - 7 = ?", answer: "20", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณ: 3*3=9<br>2. คูณ: 9*3=27<br>3. ลบ: 27-7=20" },
{ question: "100 - 2 * (10 + 20) = ?", answer: "40", difficulty: "hard", category: "order_of_operations", explanation: "1. ในวงเล็บ: 10+20=30<br>2. คูณ: 2*30=60<br>3. ลบ: 100 - 60 = 40" },
{ question: "((-4) * (-5) * (-1)) - 10 = ?", answer: "-30", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณ: -4*(-5)=20<br>2. คูณ: 20*(-1)=-20<br>3. ลบ: -20 - 10 = -30" },
{ question: "99 / (10 - 1) - 11 = ?", answer: "0", difficulty: "hard", category: "order_of_operations", explanation: "1. ในวงเล็บ: 10-1=9<br>2. หาร: 99/9=11<br>3. ลบ: 11 - 11 = 0" },
{ question: "(50 / (-2)) + (60 / (-3)) = ?", answer: "-45", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บแรก: 50/(-2)=-25<br>2. วงเล็บสอง: 60/(-3)=-20<br>3. บวก: -25 + (-20) = -45" },
{ question: "8 - (4 * 3 / 2) = ?", answer: "2", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณในวงเล็บ: 4*3=12<br>2. หารในวงเล็บ: 12/2=6<br>3. ลบ: 8 - 6 = 2" },
{ question: "((10-1) * (10-2)) / 9 = ?", answer: "8", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บแรก: 10-1=9<br>2. วงเล็บสอง: 10-2=8<br>3. คูณ: 9*8=72<br>4. หาร: 72/9=8" },
{ question: "2 * (-5) + 3 * (-4) = ?", answer: "-22", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณซ้าย: 2*(-5)=-10<br>2. คูณขวา: 3*(-4)=-12<br>3. บวก: -10+(-12)=-22" },
{ question: "40 / (2 - 10) + 5 = ?", answer: "0", difficulty: "hard", category: "order_of_operations", explanation: "1. ในวงเล็บ: 2-10=-8<br>2. หาร: 40/(-8)=-5<br>3. บวก: -5+5=0" },
{ question: "1 - 2 * 3 - 4 = ?", answer: "-9", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณ: 2*3=6<br>2. ลบ: 1-6=-5<br>3. ลบ: -5-4=-9" },
{ question: "200 / (10 * (-2) + 10) = ?", answer: "-20", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณในวงเล็บ: 10*(-2)=-20<br>2. บวกในวงเล็บ: -20+10=-10<br>3. หาร: 200/(-10)=-20" },
{ question: "(8 * (-3)) - (10 * (-2)) = ?", answer: "-4", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บแรก: 8*(-3)=-24<br>2. วงเล็บสอง: 10*(-2)=-20<br>3. ลบ: -24 - (-20) = -4" },
{ question: "-10 - (-10) * (-10) / (-10) = ?", answer: "0", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณ: (-10)*(-10)=100<br>2. หาร: 100/(-10)=-10<br>3. ลบ: -10 - (-10) = 0" },
{ question: "((6*6) - (5*5)) * 1 = ?", answer: "11", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บซ้าย: 6*6=36<br>2. วงเล็บขวา: 5*5=25<br>3. ลบในวงเล็บ: 36-25=11<br>4. คูณ: 11*1=11" },
{ question: "50 - 5 * 5 * 2 = ?", answer: "0", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณ: 5*5=25<br>2. คูณ: 25*2=50<br>3. ลบ: 50 - 50 = 0" },
{ question: "300 / (100 - 50 - 20) = ?", answer: "10", difficulty: "hard", category: "order_of_operations", explanation: "1. ในวงเล็บ: 100-50-20=30<br>2. หาร: 300 / 30 = 10" },
{ question: "(8 / (-2)) * (15 / (-3)) = ?", answer: "20", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บแรก: 8/(-2)=-4<br>2. วงเล็บสอง: 15/(-3)=-5<br>3. คูณ: (-4)*(-5)=20" },
{ question: "10 + (2 * (3 - 8)) / 5 = ?", answer: "8", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บในสุด: 3-8=-5<br>2. คูณ: 2*(-5)=-10<br>3. หาร: -10/5=-2<br>4. บวก: 10+(-2)=8" },
{ question: "((10+20+30) / 6) * (-2) = ?", answer: "-20", difficulty: "hard", category: "order_of_operations", explanation: "1. ในวงเล็บ: 10+20+30=60<br>2. หาร: 60/6=10<br>3. คูณ: 10*(-2)=-20" },
{ question: "1 - (2 - (3 - 4)) = ?", answer: "-2", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บในสุด: 3-4=-1<br>2. วงเล็บกลาง: 2-(-1)=3<br>3. ลบ: 1-3=-2" },
{ question: "6 * (-5) + 100 / 2 = ?", answer: "20", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณ: 6*(-5)=-30<br>2. หาร: 100/2=50<br>3. บวก: -30+50=20" },
{ question: "(-10 / -2) * ((-10) / 5) = ?", answer: "-10", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บแรก: -10/(-2)=5<br>2. วงเล็บสอง: (-10)/5=-2<br>3. คูณ: 5*(-2)=-10" },
{ question: "2 * (50 - 5 * 9) = ?", answer: "10", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณในวงเล็บ: 5*9=45<br>2. ลบในวงเล็บ: 50-45=5<br>3. คูณ: 2*5=10" },
{ question: "(((-3) * 4) / 6) * 10 = ?", answer: "-20", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณในวงเล็บ: -3*4=-12<br>2. หารในวงเล็บ: -12/6=-2<br>3. คูณ: -2*10=-20" },
{ question: "20 * 3 / 10 * 2 = ?", answer: "12", difficulty: "hard", category: "order_of_operations", explanation: "ทำจากซ้ายไปขวา<br>1. 20*3=60<br>2. 60/10=6<br>3. 6*2=12" },
{ question: "50 - (2 * (10 + 15)) = ?", answer: "0", difficulty: "hard", category: "order_of_operations", explanation: "1. ในวงเล็บ: 10+15=25<br>2. คูณ: 2*25=50<br>3. ลบ: 50-50=0" },
{ question: "(-8 - 2) * (-4 - 1) = ?", answer: "50", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บแรก: -8-2=-10<br>2. วงเล็บสอง: -4-1=-5<br>3. คูณ: -10*(-5)=50" },
{ question: "100 / (-10) - 10 * (-1) = ?", answer: "0", difficulty: "hard", category: "order_of_operations", explanation: "1. หาร: 100/(-10)=-10<br>2. คูณ: 10*(-1)=-10<br>3. ลบ: -10 - (-10) = 0" },
{ question: "25 * ((-10) / (8 - 3)) = ?", answer: "-50", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บในสุด: 8-3=5<br>2. หารในวงเล็บ: -10/5=-2<br>3. คูณ: 25*(-2)=-50" },
{ question: "((12*10) / (2*3)) / 4 = ?", answer: "5", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บเศษ: 12*10=120<br>2. วงเล็บส่วน: 2*3=6<br>3. หาร: 120/6=20<br>4. หาร: 20/4=5" },
{ question: "5 - ((-100) / 20 * 3) = ?", answer: "20", difficulty: "hard", category: "order_of_operations", explanation: "1. หารในวงเล็บ: -100/20=-5<br>2. คูณในวงเล็บ: -5*3=-15<br>3. ลบ: 5 - (-15) = 20" },
{ question: "9 * 8 - 8 * 7 = ?", answer: "16", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณซ้าย: 9*8=72<br>2. คูณขวา: 8*7=56<br>3. ลบ: 72-56=16" },
{ question: "(50 + 50) / (-20 + 10) = ?", answer: "-10", difficulty: "hard", category: "order_of_operations", explanation: "1. วงเล็บเศษ: 50+50=100<br>2. วงเล็บส่วน: -20+10=-10<br>3. หาร: 100/(-10)=-10" },
{ question: "4 * (5 - (6 * 2)) + 10 = ?", answer: "-18", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณในวงเล็บ: 6*2=12<br>2. ลบในวงเล็บ: 5-12=-7<br>3. คูณ: 4*(-7)=-28<br>4. บวก: -28+10=-18" },
{ question: "(-1 - 2 - 3) * (-4) = ?", answer: "24", difficulty: "hard", category: "order_of_operations", explanation: "1. ในวงเล็บ: -1-2-3=-6<br>2. คูณ: -6*(-4)=24" },
{ question: "30 / (2 * 3) + 5 = ?", answer: "10", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณในวงเล็บ: 2*3=6<br>2. หาร: 30/6=5<br>3. บวก: 5+5=10" },
{ question: "(40 - 10 * 2) / 5 = ?", answer: "4", difficulty: "hard", category: "order_of_operations", explanation: "1. คูณในวงเล็บ: 10*2=20<br>2. ลบในวงเล็บ: 40-20=20<br>3. หาร: 20/5=4" }
            ];
            
            allCards.puzzle.easy = [
                { question: "(-5) + 12 = ?", choices: [7, -7, 17, -17], answer: 7, difficulty: 'easy', category: 'addition' },
                { question: "10 - (-4) = ?", choices: [6, -6, 14, -14], answer: 14, difficulty: 'easy', category: 'subtraction' },
                { question: "(-8) × 3 = ?", choices: [-24, 24, -5, 11], answer: -24, difficulty: 'easy', category: 'multiplication' },
                { question: "(-20) ÷ (-5) = ?", choices: [4, -4, 25, -15], answer: 4, difficulty: 'easy', category: 'division' },
// --- ชุดคำถามปริศนาระดับง่าย 100 ข้อ ---
// --- หมวดการบวก (Addition) ---
{ question: "12 + (-5) = ?", choices: [7, -7, 17, -17], answer: 7, difficulty: 'easy', category: 'addition' },
{ question: "(-8) + 10 = ?", choices: [2, -2, 18, -18], answer: 2, difficulty: 'easy', category: 'addition' },
{ question: "(-7) + (-6) = ?", choices: [13, -13, 1, -1], answer: -13, difficulty: 'easy', category: 'addition' },
{ question: "15 + 8 = ?", choices: [23, -23, 7, -7], answer: 23, difficulty: 'easy', category: 'addition' },
{ question: "20 + (-10) = ?", choices: [10, -10, 30, -30], answer: 10, difficulty: 'easy', category: 'addition' },
{ question: "(-14) + 14 = ?", choices: [0, 28, -28, 1], answer: 0, difficulty: 'easy', category: 'addition' },
{ question: "9 + (-15) = ?", choices: [6, -6, 24, -24], answer: -6, difficulty: 'easy', category: 'addition' },
{ question: "(-11) + 20 = ?", choices: [9, -9, 31, -31], answer: 9, difficulty: 'easy', category: 'addition' },
{ question: "(-4) + (-16) = ?", choices: [20, -20, 12, -12], answer: -20, difficulty: 'easy', category: 'addition' },
{ question: "18 + (-9) = ?", choices: [9, -9, 27, -27], answer: 9, difficulty: 'easy', category: 'addition' },
{ question: "13 + 7 = ?", choices: [20, -20, 6, -6], answer: 20, difficulty: 'easy', category: 'addition' },
{ question: "(-10) + 10 = ?", choices: [0, 20, -20, 1], answer: 0, difficulty: 'easy', category: 'addition' },
{ question: "(-1) + (-9) = ?", choices: [10, -10, 8, -8], answer: -10, difficulty: 'easy', category: 'addition' },
{ question: "22 + (-12) = ?", choices: [10, -10, 34, -34], answer: 10, difficulty: 'easy', category: 'addition' },
{ question: "6 + (-18) = ?", choices: [12, -12, 24, -24], answer: -12, difficulty: 'easy', category: 'addition' },
{ question: "(-17) + 7 = ?", choices: [10, -10, 24, -24], answer: -10, difficulty: 'easy', category: 'addition' },
{ question: "10 + 11 = ?", choices: [21, -21, 1, -1], answer: 21, difficulty: 'easy', category: 'addition' },
{ question: "(-25) + 5 = ?", choices: [20, -20, 30, -30], answer: -20, difficulty: 'easy', category: 'addition' },
{ question: "19 + (-19) = ?", choices: [0, 38, -38, 1], answer: 0, difficulty: 'easy', category: 'addition' },
{ question: "(-3) + 20 = ?", choices: [17, -17, 23, -23], answer: 17, difficulty: 'easy', category: 'addition' },
{ question: "5 + (-12) = ?", choices: [7, -7, 17, -17], answer: -7, difficulty: 'easy', category: 'addition' },
{ question: "(-13) + (-7) = ?", choices: [20, -20, 6, -6], answer: -20, difficulty: 'easy', category: 'addition' },
{ question: "16 + 6 = ?", choices: [22, -22, 10, -10], answer: 22, difficulty: 'easy', category: 'addition' },
{ question: "(-2) + 15 = ?", choices: [13, -13, 17, -17], answer: 13, difficulty: 'easy', category: 'addition' },
{ question: "30 + (-15) = ?", choices: [15, -15, 45, -45], answer: 15, difficulty: 'easy', category: 'addition' },

// --- หมวดการลบ (Subtraction) ---
{ question: "15 - 8 = ?", choices: [7, -7, 23, -23], answer: 7, difficulty: 'easy', category: 'subtraction' },
{ question: "10 - 12 = ?", choices: [2, -2, 22, -22], answer: -2, difficulty: 'easy', category: 'subtraction' },
{ question: "9 - (-5) = ?", choices: [14, -14, 4, -4], answer: 14, difficulty: 'easy', category: 'subtraction' },
{ question: "(-11) - 4 = ?", choices: [15, -15, 7, -7], answer: -15, difficulty: 'easy', category: 'subtraction' },
{ question: "(-14) - (-7) = ?", choices: [7, -7, 21, -21], answer: -7, difficulty: 'easy', category: 'subtraction' },
{ question: "20 - 10 = ?", choices: [10, -10, 30, -30], answer: 10, difficulty: 'easy', category: 'subtraction' },
{ question: "8 - 18 = ?", choices: [10, -10, 26, -26], answer: -10, difficulty: 'easy', category: 'subtraction' },
{ question: "12 - (-12) = ?", choices: [0, 24, -24, 1], answer: 24, difficulty: 'easy', category: 'subtraction' },
{ question: "(-20) - 10 = ?", choices: [10, -10, 30, -30], answer: -30, difficulty: 'easy', category: 'subtraction' },
{ question: "(-6) - (-10) = ?", choices: [4, -4, 16, -16], answer: 4, difficulty: 'easy', category: 'subtraction' },
{ question: "25 - 15 = ?", choices: [10, -10, 40, -40], answer: 10, difficulty: 'easy', category: 'subtraction' },
{ question: "5 - 15 = ?", choices: [10, -10, 20, -20], answer: -10, difficulty: 'easy', category: 'subtraction' },
{ question: "17 - (-3) = ?", choices: [20, -20, 14, -14], answer: 20, difficulty: 'easy', category: 'subtraction' },
{ question: "(-18) - 2 = ?", choices: [20, -20, 16, -16], answer: -20, difficulty: 'easy', category: 'subtraction' },
{ question: "(-10) - (-10) = ?", choices: [0, 20, -20, 1], answer: 0, difficulty: 'easy', category: 'subtraction' },
{ question: "11 - 22 = ?", choices: [11, -11, 33, -33], answer: -11, difficulty: 'easy', category: 'subtraction' },
{ question: "30 - 11 = ?", choices: [19, -19, 41, -41], answer: 19, difficulty: 'easy', category: 'subtraction' },
{ question: "7 - (-13) = ?", choices: [20, -20, 6, -6], answer: 20, difficulty: 'easy', category: 'subtraction' },
{ question: "(-1) - 9 = ?", choices: [10, -10, 8, -8], answer: -10, difficulty: 'easy', category: 'subtraction' },
{ question: "(-5) - (-15) = ?", choices: [10, -10, 20, -20], answer: 10, difficulty: 'easy', category: 'subtraction' },
{ question: "3 - 10 = ?", choices: [7, -7, 13, -13], answer: -7, difficulty: 'easy', category: 'subtraction' },
{ question: "21 - (-9) = ?", choices: [30, -30, 12, -12], answer: 30, difficulty: 'easy', category: 'subtraction' },
{ question: "(-25) - (-5) = ?", choices: [20, -20, 30, -30], answer: -20, difficulty: 'easy', category: 'subtraction' },
{ question: "16 - 9 = ?", choices: [7, -7, 25, -25], answer: 7, difficulty: 'easy', category: 'subtraction' },
{ question: "(-2) - 18 = ?", choices: [20, -20, 16, -16], answer: -20, difficulty: 'easy', category: 'subtraction' },

// --- หมวดการคูณ (Multiplication) ---
{ question: "6 * (-5) = ?", choices: [30, -30, 1, -1], answer: -30, difficulty: 'easy', category: 'multiplication' },
{ question: "(-8) * 3 = ?", choices: [24, -24, -5, 11], answer: -24, difficulty: 'easy', category: 'multiplication' },
{ question: "(-7) * (-4) = ?", choices: [28, -28, -11, 3], answer: 28, difficulty: 'easy', category: 'multiplication' },
{ question: "9 * 6 = ?", choices: [54, -54, 15, 3], answer: 54, difficulty: 'easy', category: 'multiplication' },
{ question: "10 * (-2) = ?", choices: [20, -20, 8, 12], answer: -20, difficulty: 'easy', category: 'multiplication' },
{ question: "(-11) * 1 = ?", choices: [11, -11, -10, 12], answer: -11, difficulty: 'easy', category: 'multiplication' },
{ question: "(-5) * (-5) = ?", choices: [25, -25, 0, -10], answer: 25, difficulty: 'easy', category: 'multiplication' },
{ question: "12 * 3 = ?", choices: [36, -36, 15, 9], answer: 36, difficulty: 'easy', category: 'multiplication' },
{ question: "1 * (-15) = ?", choices: [15, -15, -14, 16], answer: -15, difficulty: 'easy', category: 'multiplication' },
{ question: "(-8) * 0 = ?", choices: [0, 8, -8, 1], answer: 0, difficulty: 'easy', category: 'multiplication' },
{ question: "7 * (-6) = ?", choices: [42, -42, 1, 13], answer: -42, difficulty: 'easy', category: 'multiplication' },
{ question: "(-4) * 8 = ?", choices: [32, -32, 4, 12], answer: -32, difficulty: 'easy', category: 'multiplication' },
{ question: "(-3) * (-10) = ?", choices: [30, -30, -7, 13], answer: 30, difficulty: 'easy', category: 'multiplication' },
{ question: "9 * 9 = ?", choices: [81, -81, 18, 0], answer: 81, difficulty: 'easy', category: 'multiplication' },
{ question: "(-1) * 30 = ?", choices: [30, -30, 29, -29], answer: -30, difficulty: 'easy', category: 'multiplication' },

// --- หมวดการหาร (Division) ---
{ question: "(-20) / 5 = ?", choices: [4, -4, 25, 15], answer: -4, difficulty: 'easy', category: 'division' },
{ question: "18 / (-3) = ?", choices: [6, -6, 21, 15], answer: -6, difficulty: 'easy', category: 'division' },
{ question: "(-24) / (-6) = ?", choices: [4, -4, 18, 30], answer: 4, difficulty: 'easy', category: 'division' },
{ question: "30 / 10 = ?", choices: [3, -3, 20, 40], answer: 3, difficulty: 'easy', category: 'division' },
{ question: "(-50) / 10 = ?", choices: [5, -5, 60, 40], answer: -5, difficulty: 'easy', category: 'division' },
{ question: "(-22) / 2 = ?", choices: [11, -11, 20, 24], answer: -11, difficulty: 'easy', category: 'division' },
{ question: "40 / (-8) = ?", choices: [5, -5, 32, 48], answer: -5, difficulty: 'easy', category: 'division' },
{ question: "21 / 7 = ?", choices: [3, -3, 14, 28], answer: 3, difficulty: 'easy', category: 'division' },
{ question: "(-14) / (-7) = ?", choices: [2, -2, 7, 21], answer: 2, difficulty: 'easy', category: 'division' },
{ question: "0 / (-5) = ?", choices: [0, 5, -5, 1], answer: 0, difficulty: 'easy', category: 'division' },
{ question: "(-45) / 9 = ?", choices: [5, -5, 54, 36], answer: -5, difficulty: 'easy', category: 'division' },
{ "question": "60 / (-6) = ?", "choices": [10, -10, 66, 54], "answer": -10, "difficulty": "easy", "category": "division" },
{ question: "(-16) / (-4) = ?", choices: [4, -4, 12, 20], answer: 4, difficulty: 'easy', category: 'division' },
{ question: "35 / 5 = ?", choices: [7, -7, 30, 40], answer: 7, difficulty: 'easy', category: 'division' },
{ question: "(-100) / 10 = ?", choices: [10, -10, 110, 90], answer: -10, difficulty: 'easy', category: 'division' }
            ];

            allCards.puzzle.medium = [
                { question: "(8 - 12) × 5 = ?", choices: [-20, 20, -16, -28], answer: -20, difficulty: 'medium', category: 'order_of_operations' },
                { question: "30 ÷ ((-2) - 3) = ?", choices: [-6, 6, -10, 10], answer: -6, difficulty: 'medium', category: 'order_of_operations' },
                { question: "50 - 10 × 2 = ?", choices: [30, 80, 40, 60], answer: 30, difficulty: 'medium', category: 'order_of_operations' },
                { question: "40 - (15 ÷ (-3)) = ?", choices: [45, 35, -25, 25], answer: 45, difficulty: 'medium', category: 'order_of_operations' },
// --- ชุดคำถามปริศนาระดับปานกลาง 100 ข้อ ---
{ question: "5 * (8 - 3) = ?", choices: [25, -25, 40, 13], answer: 25, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(10 + (-20)) * 2 = ?", choices: [20, -20, -10, 10], answer: -20, difficulty: 'medium', category: 'order_of_operations' },
{ question: "30 / (1 - 6) = ?", choices: [5, -5, -6, 6], answer: -6, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(-40) / (5 + 3) = ?", choices: [5, -5, 8, -8], answer: -5, difficulty: 'medium', category: 'order_of_operations' },
{ question: "12 + (5 * 2) = ?", choices: [22, 34, 14, 19], answer: 22, difficulty: 'medium', category: 'order_of_operations' },
{ question: "20 - (10 / 2) = ?", choices: [15, 5, 25, 18], answer: 15, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(-8) * 3 + 4 = ?", choices: [-20, 20, -28, -1], answer: -20, difficulty: 'medium', category: 'order_of_operations' },
{ question: "50 / 10 - 5 = ?", choices: [0, 45, 10, -10], answer: 0, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(4 - 10) * (-3) = ?", choices: [18, -18, 22, -22], answer: 18, difficulty: 'medium', category: 'order_of_operations' },
{ question: "40 + (20 / (-4)) = ?", choices: [35, 45, -5, 5], answer: 35, difficulty: 'medium', category: 'order_of_operations' },
{ question: "4 * (-5) + 30 = ?", choices: [10, -10, 20, -20], answer: 10, difficulty: 'medium', category: 'order_of_operations' },
{ question: "18 - 24 / 6 = ?", choices: [14, -1, 1, 22], answer: 14, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(25 - 5) / (-4) = ?", choices: [5, -5, -10, 10], answer: -5, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(-10) - 5 * 3 = ?", choices: [-25, -5, 5, 25], answer: -25, difficulty: 'medium', category: 'order_of_operations' },
{ question: "16 + ((-20) / 4) = ?", choices: [11, -11, 21, -21], answer: 11, difficulty: 'medium', category: 'order_of_operations' },
{ question: "7 * ((-5) + 2) = ?", choices: [-21, 21, -49, -9], answer: -21, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(-27 / 9) - 2 = ?", choices: [-5, -1, 1, 5], answer: -5, difficulty: 'medium', category: 'order_of_operations' },
{ question: "9 - (5 - 10) = ?", choices: [14, 4, -4, -14], answer: 14, difficulty: 'medium', category: 'order_of_operations' },
{ question: "6 * (-3) - 2 = ?", choices: [-20, 20, -16, 16], answer: -20, difficulty: 'medium', category: "order_of_operations" },
{ question: "30 / (-5) + 5 = ?", choices: [0, -1, 1, -10], answer: -1, difficulty: 'medium', category: 'order_of_operations' },
{ question: "80 / (8 + 2) = ?", choices: [8, 12, 18, 2], answer: 8, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(10 + 10) * (-2) = ?", choices: [40, -40, -20, 20], answer: -40, difficulty: 'medium', category: 'order_of_operations' },
{ question: "50 - 10 * 3 = ?", choices: [20, 120, 40, 30], answer: 20, difficulty: 'medium', category: 'order_of_operations' },
{ question: "40 + ((-30) / 5) = ?", choices: [34, 46, 2, 10], answer: 34, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(-12 - 8) / 4 = ?", choices: [-5, 5, -2, 2], answer: -5, difficulty: 'medium', category: 'order_of_operations' },
{ question: "3 * (12 - 20) = ?", choices: [-24, 24, 16, -16], answer: -24, difficulty: 'medium', category: 'order_of_operations' },
{ question: "15 - ((-5) * 2) = ?", choices: [25, 5, -5, -25], answer: 25, difficulty: 'medium', category: 'order_of_operations' },
{ question: "48 / (-8) + 1 = ?", choices: [-5, 5, -7, 7], answer: -5, difficulty: 'medium', category: 'order_of_operations' },
{ question: "5 * (-4) - (-5) = ?", choices: [-15, 15, -25, 25], answer: -15, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(-49 / 7) + 7 = ?", choices: [0, 14, -14, 7], answer: 0, difficulty: 'medium', category: 'order_of_operations' },
{ question: "9 * (4 - 4) = ?", choices: [0, 9, 1, 36], answer: 0, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(18 - 28) * (-1) = ?", choices: [10, -10, -46, 46], answer: 10, difficulty: 'medium', category: 'order_of_operations' },
{ question: "30 + 6 * (-5) = ?", choices: [0, -120, 150, -150], answer: 0, difficulty: 'medium', category: 'order_of_operations' },
{ question: "45 / (-9) - 5 = ?", choices: [-10, 0, 10, 4], answer: -10, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(-10 + 5) * 7 = ?", choices: [-35, 35, 25, -25], answer: -35, difficulty: 'medium', category: 'order_of_operations' },
{ question: "20 - (20 - 30) = ?", choices: [30, 10, -10, -30], answer: 30, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(-60 / (-6)) + 4 = ?", choices: [14, 6, -6, -14], answer: 14, difficulty: 'medium', category: 'order_of_operations' },
{ question: "8 * (3 - (-2)) = ?", choices: [40, 8, -16, -40], answer: 40, difficulty: 'medium', category: 'order_of_operations' },
{ question: "14 + (-3) * 4 = ?", choices: [2, 44, -2, -44], answer: 2, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(33 / 11) - 5 = ?", choices: [-2, 2, 8, -8], answer: -2, difficulty: 'medium', category: 'order_of_operations' },
{ question: "5 * ((-12) + 6) = ?", choices: [-30, 30, -1, -11], answer: -30, difficulty: 'medium', category: 'order_of_operations' },
{ question: "17 - (-4) * 3 = ?", choices: [29, 39, 5, 15], answer: 29, difficulty: 'medium', category: 'order_of_operations' },
{ question: "55 / ((-1) - 10) = ?", choices: [-5, 5, -11, 11], answer: -5, difficulty: 'medium', category: 'order_of_operations' },
{ question: "2 - (15 / (-3)) = ?", choices: [7, -3, 3, -7], answer: 7, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(-9) * (2 + 3) = ?", choices: [-45, -15, 15, 45], answer: -45, difficulty: 'medium', category: 'order_of_operations' },
{ question: "40 / (12 - 22) = ?", choices: [-4, 4, -8, 8], answer: -4, difficulty: 'medium', category: 'order_of_operations' },
{ question: "8 - 8 * 3 = ?", choices: [-16, 0, 16, 24], answer: -16, difficulty: 'medium', category: 'order_of_operations' },
{ question: "100 / (-50) + 3 = ?", choices: [1, -1, 53, -53], answer: 1, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(-15 + 5) * (-4) = ?", choices: [40, -40, 80, -80], answer: 40, difficulty: 'medium', category: 'order_of_operations' },
{ question: "50 - (15 - 5) = ?", choices: [40, 60, 30, 50], answer: 40, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(-20) - ((-20) / 4) = ?", choices: [-15, -25, 10, -10], answer: -15, difficulty: 'medium', category: 'order_of_operations' },
{ question: "8 * (-3 + 3) = ?", choices: [0, 8, -21, 21], answer: 0, difficulty: 'medium', category: 'order_of_operations' },
{ question: "21 / (2 - 5) = ?", choices: [-7, 7, -3, 3], answer: -7, difficulty: 'medium', category: 'order_of_operations' },
{ question: "30 + (-12) * 2 = ?", choices: [6, 36, -6, -36], answer: 6, difficulty: 'medium', category: 'order_of_operations' },
{ question: "42 / 7 - 10 = ?", choices: [-4, 4, 6, -6], answer: -4, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(-8 - 2) * 5 = ?", choices: [-50, 50, -30, 30], answer: -50, difficulty: 'medium', category: 'order_of_operations' },
{ question: "10 - (27 / (-9)) = ?", choices: [13, 7, -7, -13], answer: 13, difficulty: 'medium', category: 'order_of_operations' },
{ question: "9 * (-2 - 2) = ?", choices: [-36, 36, -18, 18], answer: -36, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(-30 + 10) / 5 = ?", choices: [-4, 4, -8, 8], answer: -4, difficulty: 'medium', category: 'order_of_operations' },
{ question: "19 - 5 * 3 = ?", choices: [4, 42, -4, -42], answer: 4, difficulty: 'medium', category: 'order_of_operations' },
{ question: "40 / (-4) + 15 = ?", choices: [5, -5, 10, -10], answer: 5, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(6 - 11) * 5 = ?", choices: [-25, 25, 21, -21], answer: -25, difficulty: 'medium', category: 'order_of_operations' },
{ question: "25 - (3 * 10) = ?", choices: [-5, 5, 220, -220], answer: -5, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(-200 / 10) - 10 = ?", choices: [-30, -10, 10, 30], answer: -30, difficulty: 'medium', category: 'order_of_operations' },
{ question: "7 * (-9 + 5) = ?", choices: [-28, 28, -18, 18], answer: -28, difficulty: 'medium', category: 'order_of_operations' },
{ question: "2 - (-6 * 3) = ?", choices: [20, -16, 16, -20], answer: 20, difficulty: 'medium', category: 'order_of_operations' },
{ question: "35 / (10 - 3) = ?", choices: [5, -5, 7, -7], answer: 5, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(-7) * (-4) + 2 = ?", choices: [30, -26, 26, -30], answer: 30, difficulty: 'medium', category: 'order_of_operations' },
{ question: "60 - 120 / 2 = ?", choices: [0, -30, 30, -60], answer: 0, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(40 - 50) * (-2) = ?", choices: [20, -20, 180, -180], answer: 20, difficulty: 'medium', category: 'order_of_operations' },
{ question: "18 + (54 / (-9)) = ?", choices: [12, 24, -12, -24], answer: 12, difficulty: 'medium', category: 'order_of_operations' },
{ question: "4 * (-10 + 5) = ?", choices: [-20, 20, -60, 60], answer: -20, difficulty: 'medium', category: 'order_of_operations' },
{ question: "16 - 8 * 4 = ?", choices: [-16, 32, 16, -32], answer: -16, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(-64 / 8) + 8 = ?", choices: [0, 16, -16, 8], answer: 0, difficulty: 'medium', category: 'order_of_operations' },
{ question: "12 * (6 - 9) = ?", choices: [-36, 36, 18, -18], answer: -36, difficulty: 'medium', category: 'order_of_operations' },
{ question: "5 - (40 / (-8)) = ?", choices: [10, 0, -10, 5], answer: 10, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(-20 - 5) / 5 = ?", choices: [-5, 5, -3, 3], answer: -5, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(-8) * 4 + 12 = ?", choices: [-20, 20, 44, -44], answer: -20, difficulty: 'medium', category: 'order_of_operations' },
{ question: "44 / (-4) - 4 = ?", choices: [-15, -7, 7, 15], answer: -15, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(-6) * 6 + 6 = ?", choices: [-30, 30, 0, 42], answer: -30, difficulty: 'medium', category: 'order_of_operations' },
{ question: "14 - (14 - 2) = ?", choices: [2, 26, -2, -26], answer: 2, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(81 / (-9)) + 10 = ?", choices: [1, -1, 19, -19], answer: 1, difficulty: 'medium', category: 'order_of_operations' },
{ question: "10 * (-4 - 1) = ?", choices: [-50, -30, 30, 50], answer: -50, difficulty: 'medium', category: 'order_of_operations' },
{ question: "25 + 35 / (-5) = ?", choices: [18, -12, -18, 12], answer: 18, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(-30 + 15) * 3 = ?", choices: [-45, 45, -15, 15], answer: -45, difficulty: 'medium', category: 'order_of_operations' },
{ question: "200 - 20 * 5 = ?", choices: [100, 900, 0, 180], answer: 100, difficulty: 'medium', category: 'order_of_operations' },
{ question: "72 / (-9) - (-2) = ?", choices: [-6, -10, 10, 6], answer: -6, difficulty: 'medium', category: 'order_of_operations' },
{ question: "6 * (5 - 12) = ?", choices: [-42, 42, 18, -18], answer: -42, difficulty: 'medium', category: 'order_of_operations' },
{ question: "4 - (36 / (-6)) = ?", choices: [10, -2, 2, -10], answer: 10, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(-18 - 12) / 3 = ?", choices: [-10, 10, -2, 2], answer: -10, difficulty: 'medium', category: 'order_of_operations' },
{ question: "(-7) * 5 + 15 = ?", choices: [-20, 50, 20, -50], answer: -20, difficulty: 'medium', category: 'order_of_operations' },
{ question: "55 / (-11) - 11 = ?", choices: [-16, 6, -6, 16], answer: -16, difficulty: 'medium', category: 'order_of_operations' }
            ];

            allCards.puzzle.hard = [
                { question: "อุณหภูมิตอนเช้า 5°C ตอนเที่ยงเพิ่มขึ้น 10°C และตอนกลางคืนลดลง 18°C อุณหภูมิตอนกลางคืนเป็นเท่าใด?", choices: ["-3°C", "3°C", "33°C", "-13°C"], answer: "-3°C", difficulty: 'hard', category: 'word_problem', explanation: "สมการคือ: 5 + 10 - 18<br>1. 5 + 10 = 15<br>2. 15 - 18 = -3" },
                { question: "เรือดำน้ำอยู่ลึก -80 เมตร ดำลงไปอีก 50 เมตร แล้วลอยขึ้นมา 60 เมตร ขณะนี้เรือดำน้ำอยู่ที่ระดับความลึกเท่าใด?", choices: ["-70 เมตร", "-90 เมตร", "-190 เมตร", "30 เมตร"], answer: "-70 เมตร", difficulty: 'hard', category: 'word_problem', explanation: "การดำลงคือค่าลบเพิ่มขึ้น, การลอยขึ้นคือค่าบวก<br>สมการคือ: (-80) - 50 + 60<br>1. -80 - 50 = -130<br>2. -130 + 60 = -70" },
                { question: "ในเกมๆหนึ่ง เริ่มต้นทุกคนมี 0 คะแนน ถ้าตอบถูกได้ 5 คะแนน ตอบผิดติดลบ 3 คะแนน สมศรีตอบถูก 4 ครั้ง ตอบผิด 5 ครั้ง สมศรีมีคะแนนรวมเท่าใด?", choices: ["5 คะแนน", "20 คะแนน", "15 คะแนน", "-5 คะแนน"], answer: "5 คะแนน", difficulty: 'hard', category: 'word_problem', explanation: "คะแนนจากตอบถูก: 4 × 5 = 20<br>คะแนนจากตอบผิด: 5 × (-3) = -15<br>คะแนนรวม: 20 + (-15) = 5" },
// --- ชุดคำถามปริศนาระดับยาก 100 ข้อ (เน้นโจทย์ปัญหาและการคำนวณซับซ้อน) ---
{ question: "(4 * (-5)) + (30 / 6) = ?", choices: [-15, 25, -25, 15], answer: -15, difficulty: 'hard', category: 'order_of_operations' },
{ question: "100 - (10 * (2 + 3)) = ?", choices: [50, 450, -50, -450], answer: 50, difficulty: 'hard', category: 'order_of_operations' },
{ question: "((15 - 25) * 2) / 5 = ?", choices: [-4, 4, -8, 8], answer: -4, difficulty: 'hard', category: 'order_of_operations' },
{ question: "(-8 * 5) - (20 / -4) = ?", choices: [-35, -45, 35, 45], answer: -35, difficulty: 'hard', category: 'order_of_operations' },
{ question: "เรือดำน้ำอยู่ที่ระดับ -150 ม. ดำลงไปอีก 80 ม. แล้วลอยขึ้น 50 ม. ขณะนี้อยู่ที่ระดับใด?", choices: ["-180 ม.", "-20 ม.", "-280 ม.", "-230 ม."], answer: "-180 ม.", difficulty: 'hard', category: 'word_problem', explanation: "-150 - 80 + 50 = -180" },
{ question: "50 + 10 * (-2) - 10 = ?", choices: [20, -80, 70, -70], answer: 20, difficulty: 'hard', category: 'order_of_operations' },
{ question: "100 / ((-20) + 10) * 2 = ?", choices: [-20, 20, -5, 5], answer: -20, difficulty: 'hard', category: 'order_of_operations' },
{ question: "นักวิทยาศาสตร์ลดอุณหภูมิสารจาก 25°C ลงชั่วโมงละ 5°C เป็นเวลา 6 ชั่วโมง สารจะมีอุณหภูมิเท่าใด?", choices: ["-5°C", "5°C", "30°C", "-30°C"], answer: "-5°C", difficulty: 'hard', category: 'word_problem', explanation: "25 - (5 * 6) = 25 - 30 = -5" },
{ question: "(-3 - 7) * (4 - 9) = ?", choices: [50, -50, -14, 14], answer: 50, difficulty: 'hard', category: 'order_of_operations' },
{ question: "(50 / (-5)) + (21 / (-7)) = ?", choices: [-13, 13, -7, 7], answer: -13, difficulty: 'hard', category: 'order_of_operations' },
{ question: "สมศักดิ์มีเงิน 500 บาท ซื้อหนังสือ 250 บาท และได้รับเงินจากแม่อีก 100 บาท เขามีเงินเหลือเท่าไหร่?", choices: ["350 บาท", "150 บาท", "250 บาท", "450 บาท"], answer: "350 บาท", difficulty: 'hard', category: 'word_problem', explanation: "500 - 250 + 100 = 350" },
{ question: "2 * (3 * (4 - 10)) = ?", choices: [-36, 36, -18, 18], answer: -36, difficulty: 'hard', category: 'order_of_operations' },
{ question: "20 - 3 * (10 - 4) = ?", choices: [2, 102, -2, -102], answer: 2, difficulty: 'hard', category: 'order_of_operations' },
{ question: "คะแนนสอบครั้งแรกได้ 80 คะแนน ครั้งที่สองลดลง 15 คะแนน ครั้งที่สามเพิ่มขึ้น 10 คะแนน คะแนนเฉลี่ยสามครั้งคือเท่าใด?", choices: ["75 คะแนน", "85 คะแนน", "70 คะแนน", "80 คะแนน"], answer: "75 คะแนน", difficulty: 'hard', category: 'word_problem', explanation: "ครั้งสอง: 80-15=65<br>ครั้งสาม: 65+10=75<br>เฉลี่ย: (80+65+75)/3 = 75" },
{ question: "((8 * -3) + 4) / 5 = ?", choices: [-4, 4, -5.6, 5.6], answer: -4, difficulty: 'hard', category: 'order_of_operations' },
{ question: "10 * 5 - 8 * 5 = ?", choices: [10, 80, -10, -80], answer: 10, difficulty: 'hard', category: 'order_of_operations' },
{ question: "บริษัทขาดทุน 20,000 บาทในปีก่อน แต่ปีนี้มีกำไร 50,000 บาท ผลประกอบการสองปีรวมกันเป็นอย่างไร?", choices: ["กำไร 30,000", "ขาดทุน 30,000", "กำไร 70,000", "ขาดทุน 70,000"], answer: "กำไร 30,000", difficulty: 'hard', category: 'word_problem', explanation: "-20000 + 50000 = 30000" },
{ question: "100 / (-5) / (-2) = ?", choices: [10, -10, 40, -40], answer: 10, difficulty: 'hard', category: 'order_of_operations' },
{ question: "(-100 + 10) / (-3 * 3) = ?", choices: [10, -10, 30, -30], answer: 10, difficulty: 'hard', category: 'order_of_operations' },
{ question: "เครื่องบินบินสูง 10,000 ฟุต ลดระดับลง 2,000 ฟุต แล้วไต่ระดับขึ้น 1,500 ฟุต ความสูงสุดท้ายคือเท่าใด?", choices: ["9,500 ฟุต", "10,500 ฟุต", "8,000 ฟุต", "13,500 ฟุต"], answer: "9,500 ฟุต", difficulty: 'hard', category: 'word_problem', explanation: "10000 - 2000 + 1500 = 9500" },
{ question: "20 - (50 / (2 - 7)) = ?", choices: [30, 10, -6, 6], answer: 30, difficulty: 'hard', category: 'order_of_operations' },
{ question: "(6 * 6) - (7 * 7) = ?", choices: [-13, 13, 1, -1], answer: -13, difficulty: 'hard', category: 'order_of_operations' },
{ question: "ในการแข่งขัน ตอบถูกได้ 10 แต้ม ตอบผิดติดลบ 5 แต้ม ถ้ามานีตอบถูก 8 ข้อ ผิด 4 ข้อ มานีได้กี่คะแนน?", choices: ["60 คะแนน", "80 คะแนน", "40 คะแนน", "100 คะแนน"], answer: "60 คะแนน", difficulty: 'hard', category: 'word_problem', explanation: "(8*10) + (4*(-5)) = 80-20=60" },
{ question: "1 - 2 * (3 - 4 * 5) = ?", choices: [35, -33, 15, -15], answer: 35, difficulty: 'hard', category: 'order_of_operations' },
{ question: "((-10*5) + (-20)) / 10 = ?", choices: [-7, 7, -3, 3], answer: -7, difficulty: 'hard', category: 'order_of_operations' },
{ question: "อุณหภูมิห้องแช่แข็งคือ -18°C เมื่อไฟฟ้าดับ อุณหภูมิสูงขึ้น 12°C แล้วลดลง 4°C หลังจากไฟมา อุณหภูมิตอนนี้คือเท่าใด?", choices: ["-10°C", "-6°C", "-22°C", "-14°C"], answer: "-10°C", difficulty: 'hard', category: 'word_problem', explanation: "-18 + 12 - 4 = -10" },
{ question: "(30 - 3 * 5) * 2 = ?", choices: [30, 135, -30, -135], answer: 30, difficulty: 'hard', category: 'order_of_operations' },
{ question: "-5 * -4 * -3 = ?", choices: [-60, 60, -12, 12], answer: -60, difficulty: 'hard', category: 'order_of_operations' },
{ question: "ยอดเขา A สูง 1,200 ม. ยอดเขา B สูงกว่ายอดเขา A อยู่ 500 ม. แต่ต่ำกว่ายอดเขา C อยู่ 300 ม. ยอดเขา C สูงเท่าใด?", choices: ["2,000 ม.", "1,700 ม.", "1,400 ม.", "900 ม."], answer: "2,000 ม.", difficulty: 'hard', category: 'word_problem', explanation: "B=1200+500=1700<br>C=B+300=1700+300=2000" },
{ question: "(100 / (10 - 20)) - 5 = ?", choices: [-15, 5, -5, 15], answer: -15, difficulty: 'hard', category: 'order_of_operations' },
{ question: "10 + 20 * 3 / (-6) = ?", choices: [0, -15, 15, -5], answer: 0, difficulty: 'hard', category: 'order_of_operations' },
{ question: "คนงานขุดบ่อลึกวันละ 2 เมตร เป็นเวลา 5 วัน แล้วถมกลับขึ้นมา 3 เมตร บ่อจะลึกเท่าใด?", choices: ["-7 เมตร", "-10 เมตร", "-13 เมตร", "-3 เมตร"], answer: "-7 เมตร", difficulty: 'hard', category: 'word_problem', explanation: "(5*(-2)) + 3 = -10+3 = -7" },
{ question: "2 * ((-10 * 3) + 20) = ?", choices: [-20, 20, 20, -10], answer: -20, difficulty: 'hard', category: 'order_of_operations' },
{ question: "(-50 + 10) / (5 - 1) = ?", choices: [-10, 10, -15, 15], answer: -10, difficulty: 'hard', category: 'order_of_operations' },
{ question: "เติมน้ำในถัง 50 ลิตร ใช้ไป 15 ลิตร แล้วเติมอีก 20 ลิตร สุดท้ายน้ำรั่วออก 10 ลิตร ในถังมีน้ำเท่าใด?", choices: ["45 ลิตร", "50 ลิตร", "35 ลิตร", "40 ลิตร"], answer: "45 ลิตร", difficulty: 'hard', category: 'word_problem', explanation: "50-15+20-10=45" },
{ question: "100 - (100 / (10 / 2)) = ?", choices: [80, 0, 180, 20], answer: 80, difficulty: 'hard', category: 'order_of_operations' },
{ question: "(8 * 9) - (7 * 10) = ?", choices: [2, 162, -2, -162], answer: 2, difficulty: 'hard', category: 'order_of_operations' },
{ question: "รถยนต์วิ่งไปทางเหนือ 100 กม. แล้วย้อนกลับมาทางใต้ 120 กม. รถอยู่ห่างจากจุดเริ่มต้นไปทางทิศใด กี่ กม.?", choices: ["ทิศใต้ 20 กม.", "ทิศเหนือ 20 กม.", "ทิศใต้ 220 กม.", "ทิศเหนือ 220 กม."], answer: "ทิศใต้ 20 กม.", difficulty: 'hard', category: 'word_problem', explanation: "100 - 120 = -20 (ค่าลบคือทิศใต้)" },
{ question: "3 * (-5) * 2 + 10 = ?", choices: [-20, 40, -40, 20], answer: -20, difficulty: 'hard', category: 'order_of_operations' },
{ question: "((-7+2) * (-8+3)) / 5 = ?", choices: [5, -5, 25, -25], answer: 5, difficulty: 'hard', category: 'order_of_operations' },
{ question: "คะแนนเต็ม 100 ได้คะแนน 85 แต่โดนหัก 3 คะแนนเพราะส่งช้า และได้คะแนนพิเศษ 5 คะแนนเพราะทำสวยงาม คะแนนสุทธิคือเท่าใด?", choices: ["87 คะแนน", "82 คะแนน", "93 คะแนน", "77 คะแนน"], answer: "87 คะแนน", difficulty: 'hard', category: 'word_problem', explanation: "85 - 3 + 5 = 87" },
{ question: "200 / 10 / 5 / 2 = ?", choices: [2, 8, 20, 40], answer: 2, difficulty: 'hard', category: 'order_of_operations' },
{ question: "10 * (10 - (10 / (-10))) = ?", choices: [110, 90, -90, -110], answer: 110, difficulty: 'hard', category: 'order_of_operations' },
{ question: "เริ่มเกมมี 0 คะแนน เล่น 5 รอบ ได้คะแนนดังนี้ +10, -5, +20, -15, +5 คะแนนรวมสุดท้ายคือเท่าไหร่?", choices: ["15 คะแนน", "20 คะแนน", "10 คะแนน", "25 คะแนน"], answer: "15 คะแนน", difficulty: 'hard', category: 'word_problem', explanation: "10-5+20-15+5 = 15" },
{ question: "20 - ((-5 * 4) + 30) = ?", choices: [10, 30, -10, -30], answer: 10, difficulty: 'hard', category: 'order_of_operations' },
{ question: "((8 - 12) * (6 - 1)) / -2 = ?", choices: [10, -10, 20, -20], answer: 10, difficulty: 'hard', category: 'order_of_operations' },
{ question: "ซื้อไข่มา 30 ฟอง ทำแตกไป 4 ฟอง ใช้ทำอาหาร 10 ฟอง ซื้อมาเพิ่มอีก 12 ฟอง ตอนนี้มีไข่กี่ฟอง?", choices: ["28 ฟอง", "16 ฟอง", "6 ฟอง", "48 ฟอง"], answer: "28 ฟอง", difficulty: 'hard', category: 'word_problem', explanation: "30 - 4 - 10 + 12 = 28" },
{ question: "(-5 + (-10)) / 3 + 5 = ?", choices: [0, -10, 10, 5], answer: 0, difficulty: 'hard', category: 'order_of_operations' },
{ question: "1 - (10 * 2) / 5 = ?", choices: [-3, 3, -1, 1], answer: -3, difficulty: 'hard', category: 'order_of_operations' },
{ question: "ตึกสูง 20 ชั้น ดำรงอยู่ชั้น 15 เขาลงลิฟต์ไป 8 ชั้น แล้วขึ้นไปอีก 10 ชั้น ตอนนี้เขาอยู่ชั้นอะไร?", choices: ["ชั้น 17", "ชั้น 7", "ชั้น 3", "ชั้น 23"], answer: "ชั้น 17", difficulty: 'hard', category: 'word_problem', explanation: "15 - 8 + 10 = 17" },
{ question: "(7 * 5) - (6 * 5) = ?", choices: [5, 65, -5, -65], answer: 5, difficulty: 'hard', category: 'order_of_operations' },
{ question: "50 + (-10) * 2 / 4 = ?", choices: [45, 20, -20, -45], answer: 45, difficulty: 'hard', category: 'order_of_operations' },
{ question: "เด็กคนหนึ่งสูง 150 ซม. ยืนบนเก้าอี้สูง 50 ซม. แล้วชูมือขึ้นไปอีก 20 ซม. มือของเขาจะสูงจากพื้นเท่าไหร่?", choices: ["220 ซม.", "180 ซม.", "120 ซม.", "200 ซม."], answer: "220 ซม.", difficulty: 'hard', category: 'word_problem', explanation: "150 + 50 + 20 = 220" },
{ question: "10 - (10 - (10 - 20)) = ?", choices: [-10, 10, 0, 20], answer: -10, difficulty: 'hard', category: 'order_of_operations' },
{ question: "(-12 / -2) * (-1 - 4) = ?", choices: [-30, 30, -20, 20], answer: -30, difficulty: 'hard', category: 'order_of_operations' },
{ question: "ฝากเงิน 1,000 บาท ถอนมา 300 บาท แล้วฝากเพิ่ม 500 บาท แต่โดนค่าธรรมเนียม 25 บาท ยอดคงเหลือคือเท่าใด?", choices: ["1,175 บาท", "1,225 บาท", "775 บาท", "825 บาท"], answer: "1,175 บาท", difficulty: 'hard', category: 'word_problem', explanation: "1000 - 300 + 500 - 25 = 1175" },
{ question: "3 * (100 / (-25)) - 2 = ?", choices: [-14, 10, -10, 14], answer: -14, difficulty: 'hard', category: 'order_of_operations' },
{ question: "(5 * 6) + (7 * 8) = ?", choices: [86, -26, 26, -86], answer: 86, difficulty: 'hard', category: 'order_of_operations' },
{ question: "อุณหภูมิที่ขั้วโลกคือ -30°C ถ้าอุ่นขึ้น 12°C แล้วหนาวลงอีก 5°C อุณหภูมิสุดท้ายคือเท่าใด?", choices: ["-23°C", "-13°C", "-47°C", "-18°C"], answer: "-23°C", difficulty: 'hard', category: 'word_problem', explanation: "-30 + 12 - 5 = -23" },
{ question: "(-2 * -3 * -4) + 4 = ?", choices: [-20, 28, 20, -28], answer: -20, difficulty: 'hard', category: 'order_of_operations' },
{ question: "100 / (2 * (30 - 5)) = ?", choices: [2, 10, -2, -10], answer: 2, difficulty: 'hard', category: 'order_of_operations' },
{ question: "มีหนี้ 500 บาท ใช้ไป 300 บาท แล้วมีคนให้ยืมอีก 200 บาท สรุปแล้วมีหนี้เท่าใด?", choices: ["หนี้ 600 บาท", "หนี้ 400 บาท", "หนี้ 1000 บาท", "ไม่มีหนี้"], answer: "หนี้ 400 บาท", difficulty: 'hard', category: 'word_problem', explanation: "การมีหนี้คือค่าลบ การใช้หนี้คือค่าบวก ยืมเพิ่มคือค่าลบ<br>-500 + 300 - 200 = -400" },
{ question: "((10-2)*(20-10))/8 = ?", choices: [10, 80, 8, 1], answer: 10, difficulty: 'hard', category: 'order_of_operations' },
{ question: "25 - 5 * (10 / 2) = ?", choices: [0, 100, -100, 50], answer: 0, difficulty: 'hard', category: 'order_of_operations' },
{ question: "นักประดาน้ำอยู่ที่ -20 ม. ดำลงไปลึกเป็น 2 เท่าของเดิม แล้วลอยขึ้นมา 10 ม. เขาอยู่ที่ระดับใด?", choices: ["-30 ม.", "-50 ม.", "-10 ม.", "0 ม."], answer: "-30 ม.", difficulty: 'hard', category: 'word_problem', explanation: "(-20 * 2) + 10 = -40+10 = -30" },
{ question: "40 - (10 + 20 + 30) / 6 = ?", choices: [30, 5, -30, -5], answer: 30, difficulty: 'hard', category: 'order_of_operations' },
{ question: "(9*9 - 1) / (-10) = ?", choices: [-8, 8, -9, 9], answer: -8, difficulty: 'hard', category: 'order_of_operations' },
{ question: "ถ้า a = -2, b = 5 แล้ว 3a + 2b มีค่าเท่าใด?", choices: [4, -16, 16, -4], answer: 4, difficulty: 'hard', category: 'word_problem', explanation: "(3*(-2)) + (2*5) = -6+10=4" },
{ question: "10 * ((-20) / 4 + 5) = ?", choices: [0, 10, -10, 100], answer: 0, difficulty: 'hard', category: 'order_of_operations' },
{ question: "2 * 3 * 4 - 5 * 6 = ?", choices: [-6, 6, 84, -84], answer: -6, difficulty: 'hard', category: 'order_of_operations' },
{ question: "น้ำในแก้วมี 200 มล. ดื่มไป 50 มล. เติม 100 มล. แล้วทำหกไป 25 มล. เหลือน้ำเท่าไหร่?", choices: ["225 มล.", "125 มล.", "175 มล.", "275 มล."], answer: "225 มล.", difficulty: 'hard', 'category': 'word_problem', "explanation": "200-50+100-25=225" },
{ question: "(-100 / (50 / -2)) * 1 = ?", choices: [4, -4, 1, -1], answer: 4, difficulty: 'hard', 'category': 'order_of_operations' },
{ question: "10 - 2 * (3 + (-8)) = ?", choices: [20, 0, -20, 40], answer: 20, difficulty: 'hard', 'category': 'order_of_operations' },
{ question: "วันจันทร์หุ้นขึ้น 10 บาท วันอังคารลง 15 บาท วันพุธขึ้น 5 บาท รวมสามวัน หุ้นเปลี่ยนแปลงไปเท่าใด?", choices: ["ไม่เปลี่ยนแปลง", "ขึ้น 10 บาท", "ลง 5 บาท", "ขึ้น 30 บาท"], answer: "ไม่เปลี่ยนแปลง", 'difficulty': 'hard', 'category': 'word_problem', "explanation": "10 - 15 + 5 = 0" },
{ question: "50 - ((-10 * -2) + 10) = ?", choices: [20, 80, -20, -80], answer: 20, difficulty: 'hard', 'category': 'order_of_operations' },
{ question: "(-40 / -4) * (-3 - 2) = ?", choices: [-50, 50, -2, 2], answer: -50, difficulty: 'hard', 'category': 'order_of_operations' },
{ question: "ถ้า x = 10, y = -3 แล้ว 2x + 5y มีค่าเท่าใด?", choices: [5, -5, 35, -35], answer: 5, difficulty: 'hard', 'category': 'word_problem', "explanation": "(2*10)+(5*(-3)) = 20-15=5" },
{ question: "((5 - 1) * (1 - 5)) / 4 = ?", choices: [-4, 4, 0, 1], answer: -4, difficulty: 'hard', 'category': 'order_of_operations' },
{ question: "30 / 3 * 2 - 10 = ?", choices: [10, -5, 5, -10], answer: 10, difficulty: 'hard', 'category': 'order_of_operations' },
{ question: "เดินขึ้นบันได 20 ขั้น เดินลง 12 ขั้น แล้วขึ้นไปอีก 15 ขั้น สรุปแล้วขึ้นบันไดไปกี่ขั้นจากจุดเริ่มต้น?", choices: ["23 ขั้น", "7 ขั้น", "47 ขั้น", "17 ขั้น"], answer: "23 ขั้น", difficulty: 'hard', 'category': 'word_problem', "explanation": "20 - 12 + 15 = 23" },
{ question: "100 - (200 / (10 - 30)) = ?", choices: [110, 90, 0, 200], answer: 110, difficulty: 'hard', 'category': 'order_of_operations' },
{ question: "(-5 * -5) - (4 * 4) = ?", choices: [9, -9, 41, -41], answer: 9, difficulty: 'hard', 'category': 'order_of_operations' },
{ question: "ในลิฟต์มีคน 5 คน จอดชั้นต่อไปมีคนลง 3 คน ขึ้น 8 คน ชั้นต่อมาลง 5 คน ขึ้น 2 คน ขณะนี้ในลิฟต์มีกี่คน?", choices: ["7 คน", "6 คน", "8 คน", "5 คน"], answer: "7 คน", difficulty: 'hard', 'category': 'word_problem', "explanation": "5-3+8-5+2=7" },
{ question: "10 * (-2) + 20 * (-1) = ?", choices: [-40, 0, 40, 20], answer: -40, difficulty: 'hard', 'category': 'order_of_operations' },
{ question: "(10 - 1) * (20 - 2) / 9 = ?", choices: [18, -18, 9, -9], answer: 18, difficulty: 'hard', 'category': 'order_of_operations' },
{ question: "ถ้าอุณหภูมิเริ่มต้นคือ -5°C และเพิ่มขึ้น 2°C ทุกๆชั่วโมง หลังจากผ่านไป 5 ชั่วโมง อุณหภูมิจะเป็นเท่าใด?", choices: ["5°C", "10°C", "-15°C", "15°C"], answer: "5°C", difficulty: 'hard', 'category': 'word_problem', "explanation": "-5 + (2*5) = -5+10=5" },
{ question: "100 + (100 / (-5)) * 2 = ?", choices: [60, -60, -140, 140], answer: 60, difficulty: 'hard', 'category': 'order_of_operations' }
            ];

            console.log("Static question bank populated.");
        }


        const gameSounds = {
            diceRoll: new Audio("sounds/dice_roll.mp3"),
            playerMove: new Audio("sounds/player_move.mp3"),
            correctAnswer: new Audio("sounds/correct.mp3"),
            incorrectAnswer: new Audio("sounds/incorrect.mp3"),
            powerUp: new Audio("sounds/power_up.mp3"),
            setback: new Audio("sounds/setback.mp3"),
            bonus: new Audio("sounds/bonus.mp3"),
            cardSelect: new Audio("sounds/card_select.mp3"),
            victory: new Audio("sounds/victory.mp3"),
            buttonClick: new Audio("sounds/button_click.mp3"),
            prank: new Audio("sounds/prank_effect.mp3"),
            countdownTick: new Audio("sounds/countdown_tick.mp3")
        };

        function playSound(soundName) {
            if (!isSoundEnabled) return;
            const sound = gameSounds[soundName];
            if (sound) {
                sound.currentTime = 0;
                sound.play().catch(error => {
                    console.warn(`ไม่สามารถเล่นเสียง "${soundName}" อัตโนมัติ: `, error);
                });
            } else {
                console.warn(`ไม่พบเสียง: ${soundName}`);
            }
        }
        
        // --- DOM Elements ---
        const mainMenuModal = document.getElementById('mainMenuModal');
        const learningHubModal = document.getElementById('learningHubModal');
        const settingsModal = document.getElementById('settingsModal');
        const reportModal = document.getElementById('reportModal');
        const gameSetupScreen = document.getElementById('gameSetupScreen');
        const boardContainer = document.getElementById('boardContainer');
        const numPlayersSelect = document.getElementById('numPlayersSelect');
        const playerConfigArea = document.getElementById('playerConfigArea');
        const startGameBtn = document.getElementById('startGameBtn');
        const gameBoard = document.getElementById('gameBoard');
        const rollDiceButton = document.getElementById('rollDiceButton');
        const messageArea = document.getElementById('messageArea');
        const centralMessageOverlay = document.getElementById('centralMessageOverlay');
        const centralMessageContent = document.getElementById('centralMessageContent');
        const cardSelectionModal = document.getElementById('cardSelectionModal');
        const cardSelectionTitle = document.getElementById('cardSelectionTitle');
        const cardSelectionGrid = document.getElementById('cardSelectionGrid');
        const playersInfoPanel = document.getElementById('playersInfoPanel');
        const currentPlayerTurnDisplay = document.getElementById('currentPlayerTurn');
        const currentRoundCounterDisplay = document.getElementById('currentRoundCounter');
        const movementDieValueDisplay = document.getElementById('movementDieValue');
        const modal = document.getElementById('questionModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalQuestion = document.getElementById('modalQuestion');
        const modalAnswerInput = document.getElementById('modalAnswerInput');
        const modalSubmitButton = document.getElementById('modalSubmitButton');
        const modalCloseButton = document.getElementById('modalCloseButton');
        const modalFeedback = document.getElementById('modalFeedback');
        const emojiPickerModal = document.getElementById('emojiPickerModal');
        const emojiGrid = document.getElementById('emojiGrid');
        const closeEmojiPickerBtn = document.getElementById('closeEmojiPickerBtn');
        const victoryOverlay = document.getElementById('victoryOverlay');
        const fireworksContainer = document.getElementById('fireworksContainer');
        const winnerNameDisplay = document.getElementById('winnerNameDisplay');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const reportBtn = document.getElementById('reportBtn');
        const prankModal = document.getElementById('prankModal');
        const prankTitle = document.getElementById('prankTitle');
        const prankOptionsContainer = document.getElementById('prankOptionsContainer');
        const prankButtonsContainer = document.getElementById('prankButtonsContainer');
        const backgroundMusicElement = document.getElementById('backgroundMusic');
        const diceAnimationOverlay = document.getElementById('diceAnimationOverlay');
        const diceAnimationValue = document.getElementById('diceAnimationValue');
        const diceAnimationText = document.getElementById('diceAnimationText');
        const heartbeatOverlay = document.getElementById('heartbeatOverlay'); 
        const soundToggle = document.getElementById('soundToggle');


        let currentCardData = null;
        let cardsForSelection = [];
        let currentEffectCards = [];
        let questionTimerInterval = null;
        let timeLeft = 0;
        const QUESTION_TIME_LIMIT = 60;
        
        // --- CAI Navigation & Mode Selection Listeners ---
        // MODIFIED: Multiplayer button
        document.getElementById('mainMenuStartGameBtn').addEventListener('click', () => {
            playSound('buttonClick');
            isSinglePlayerMode = false; // Set mode
            mainMenuModal.style.display = 'none';
            gameSetupScreen.classList.remove('hidden');
        });

        // NEW: Single player button
        document.getElementById('mainMenuSinglePlayerBtn').addEventListener('click', () => {
            playSound('buttonClick');
            isSinglePlayerMode = true; // Set mode
            mainMenuModal.style.display = 'none';
            startSinglePlayerGame();
        });


        document.getElementById('mainMenuLearningHubBtn').addEventListener('click', () => {
            playSound('buttonClick');
            mainMenuModal.style.display = 'none';
            learningHubModal.style.display = 'flex';
        });

        document.getElementById('closeLearningHubBtn').addEventListener('click', () => {
            playSound('buttonClick');
            learningHubModal.style.display = 'none';
            mainMenuModal.style.display = 'flex';
        });
        
        document.getElementById('mainMenuSettingsBtn').addEventListener('click', () => {
            playSound('buttonClick');
            mainMenuModal.style.display = 'none';
            settingsModal.style.display = 'flex';
        });

        document.getElementById('closeSettingsBtn').addEventListener('click', () => {
            playSound('buttonClick');
            settingsModal.style.display = 'none';
            mainMenuModal.style.display = 'flex';
        });

        soundToggle.addEventListener('change', (e) => {
            isSoundEnabled = e.target.checked;
            if (isSoundEnabled) {
                 backgroundMusicElement.play().catch(err => console.log(err));
            } else {
                 backgroundMusicElement.pause();
            }
        });


        function createPlayerConfigInputs(num) {
            playerConfigArea.innerHTML = '';
            for (let i = 0; i < num; i++) {
                const entryDiv = document.createElement('div');
                entryDiv.classList.add('player-config-entry', 'p-3', 'bg-gray-50', 'rounded-lg', 'shadow-sm');
                entryDiv.innerHTML = `
                    <label class="font-semibold text-gray-700 w-1/4">ผู้เล่น ${i + 1}:</label>
                    <button type="button" class="player-emoji-select-btn" data-player-index="${i}">${defaultPlayerEmojis[i] || '😃'}</button>
                    <input type="text" class="player-name-input setup-input flex-grow" placeholder="ชื่อ (ไม่บังคับ)">
                `;
                playerConfigArea.appendChild(entryDiv);
            }
            document.querySelectorAll('.player-emoji-select-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    playSound('buttonClick');
                    currentPlayerEmojiSelectionIndex = parseInt(e.target.dataset.playerIndex);
                    openEmojiPicker();
                });
            });
        }
        function openEmojiPicker() {
            emojiGrid.innerHTML = '';
            commonEmojisForPicker.forEach(emoji => {
                const btn = document.createElement('button');
                btn.classList.add('emoji-btn');
                btn.textContent = emoji;
                btn.addEventListener('click', () => { playSound('buttonClick'); selectEmoji(emoji); });
                emojiGrid.appendChild(btn);
            });
            emojiPickerModal.style.display = 'flex';
        }
        function selectEmoji(emoji) {
            const playerEmojiButton = document.querySelector(`.player-emoji-select-btn[data-player-index="${currentPlayerEmojiSelectionIndex}"]`);
            if (playerEmojiButton) { playerEmojiButton.textContent = emoji; }
            emojiPickerModal.style.display = 'none';
        }
        closeEmojiPickerBtn.addEventListener('click', () => { playSound('buttonClick'); emojiPickerModal.style.display = 'none'; });
        numPlayersSelect.addEventListener('change', (e) => { playSound('buttonClick'); createPlayerConfigInputs(parseInt(e.target.value)); });

        function getCurrentDifficulty(playerPosition) {
            if (playerPosition < 10) return 'easy';
            if (playerPosition < 28) return 'medium';
            return 'hard';
        }

        // NEW: Function to start a single player game directly
        function startSinglePlayerGame() {
            players = [{
                id: 1,
                name: 'นักผจญภัย',
                emoji: '🧑‍🚀',
                position: 0,
                onBoardPosition: 0,
                score: 0,
                hasShield: false,
                extraTurnsToTake: 0,
                hasBeenPrankedThisRound: false,
                performanceLog: []
            }];
            
            startGameFlow();
        }

        startGameBtn.addEventListener('click', () => {
            playSound('buttonClick');
            const num = parseInt(numPlayersSelect.value);
            const emojiButtons = document.querySelectorAll('.player-emoji-select-btn');
            const nameInputs = document.querySelectorAll('.player-name-input');

            players = [];
            for (let i = 0; i < num; i++) {
                players.push({
                    id: i + 1,
                    name: nameInputs[i].value.trim() || `ผู้เล่น ${i + 1}`,
                    emoji: emojiButtons[i].textContent.trim(),
                    position: 0,
                    onBoardPosition: 0,
                    score: 0, 
                    hasShield: false,
                    extraTurnsToTake: 0,
                    hasBeenPrankedThisRound: false,
                    performanceLog: []
                });
            }

            startGameFlow();
        });

        // NEW: Common game start logic
        function startGameFlow() {
            currentGameQuestionPool = JSON.parse(JSON.stringify(allCards));
            currentRound = 1;

            gameSetupScreen.classList.add('hidden');
            boardContainer.classList.remove('hidden');
            victoryOverlay.style.display = 'none';
            fireworksContainer.innerHTML = '';
            gameActive = true;
            currentPlayerIndex = 0;

            initializeBoard();
            initializePlayersInfoPanel();
            showMessage(`เกมเริ่มต้น! ตาของ ${players[currentPlayerIndex].name}`, 'turn_info');
            rollDiceButton.disabled = false;

            if (isSoundEnabled && backgroundMusicElement) {
                backgroundMusicElement.src = "sounds/background_music.mp3";
                backgroundMusicElement.volume = 0.1;
                backgroundMusicElement.play().catch(error => console.warn("ไม่สามารถเล่นเพลงพื้นหลังอัตโนมัติ:", error));
            }
        }


        function resetGame() {
            playSound('buttonClick');
            if (backgroundMusicElement) { backgroundMusicElement.pause(); backgroundMusicElement.currentTime = 0; }
            victoryOverlay.style.display = 'none';
            reportModal.style.display = 'none';
            fireworksContainer.innerHTML = '';
            boardContainer.classList.add('hidden');
            gameSetupScreen.classList.add('hidden'); // Hide setup screen too
            mainMenuModal.style.display = 'flex';
            createPlayerConfigInputs(parseInt(numPlayersSelect.value));
        }
        
        playAgainBtn.addEventListener('click', resetGame);
        document.getElementById('playAgainFromReportBtn').addEventListener('click', resetGame);


        // --- Game Logic Functions ---
        function initializeBoard() {
            gameBoard.innerHTML = '';
            const numRows = 5;
            const numCols = 10;
            for (let i = 0; i < NUM_SQUARES; i++) {
                const squareData = boardConfig[i];
                const squareDiv = document.createElement('div');
                squareDiv.id = `square-${i}`;
                squareDiv.classList.add('board-square', `${squareData.type}-square`);
                const visualRowFromBottom = Math.floor(i / numCols);
                let visualColInRow;
                if (visualRowFromBottom % 2 === 0) {
                    visualColInRow = i % numCols;
                } else {
                    visualColInRow = (numCols - 1) - (i % numCols);
                }
                const cssGridRow = numRows - visualRowFromBottom;
                const cssGridColumn = visualColInRow + 1;
                squareDiv.style.gridRowStart = cssGridRow;
                squareDiv.style.gridColumnStart = cssGridColumn;
                squareDiv.innerHTML = `
                    <span class="square-number">${i + 1}</span>
                    <i class="${squareData.icon} square-icon"></i>
                    <span class="square-text">${squareData.text}</span>
                    <div class="player-slots-container" id="slots-sq-${i}"></div>
                `;
                gameBoard.appendChild(squareDiv);
            }
            renderPlayerPieces();
        }

        function initializePlayersInfoPanel() {
            playersInfoPanel.innerHTML = '';
            players.forEach(player => {
                const playerInfoDiv = document.createElement('div');
                playerInfoDiv.id = `player${player.id}InfoDisplay`;
                playerInfoDiv.classList.add('text-lg', 'mb-2', 'p-2', 'border', 'border-gray-200', 'rounded-lg');
                playerInfoDiv.innerHTML = `
                    <div class="font-bold">${player.name} (${player.emoji})</div>
                    <div>ช่อง: <span id="player${player.id}Pos" class="font-bold">1</span>
                    <span id="player${player.id}ShieldIcon" class="ml-2">${player.hasShield ? '<i class="fas fa-shield-alt text-blue-500"></i>' : ''}</span></div>
                    <div><i class="fas fa-star text-yellow-500"></i> คะแนน: <span id="player${player.id}Score" class="font-bold">0</span></div>
                `;
                playersInfoPanel.appendChild(playerInfoDiv);
            });
            updatePlayerInfo();
        }

        function renderPlayerPieces() {
            document.querySelectorAll('.player-piece').forEach(p => p.remove());
            players.forEach(player => {
                if (player.onBoardPosition < NUM_SQUARES && player.onBoardPosition >= 0) {
                    const slotsContainer = document.getElementById(`slots-sq-${player.onBoardPosition}`);
                    if (slotsContainer) {
                        const pieceDiv = document.createElement('div');
                        pieceDiv.classList.add('player-piece');
                        pieceDiv.textContent = player.emoji;
                        slotsContainer.appendChild(pieceDiv);
                        pieceDiv.classList.add('player-piece-landed');
                        playSound('playerMove');
                        setTimeout(() => {
                            if (pieceDiv) pieceDiv.classList.remove('player-piece-landed');
                        }, 700);
                    }
                }
            });
        }
        
        function updatePlayerInfo() {
            players.forEach(player => {
                const posDisplay = document.getElementById(`player${player.id}Pos`);
                if (posDisplay) { posDisplay.textContent = player.position + 1; }
                const shieldIconDisplay = document.getElementById(`player${player.id}ShieldIcon`);
                if (shieldIconDisplay) { shieldIconDisplay.innerHTML = player.hasShield ? '<i class="fas fa-shield-alt text-blue-500" title="มีเกราะป้องกัน"></i>' : '';}
                const scoreDisplay = document.getElementById(`player${player.id}Score`);
                if (scoreDisplay) { scoreDisplay.textContent = player.score; }
            });
            if (players.length > 0 && players[currentPlayerIndex]) {
                 currentPlayerTurnDisplay.textContent = players[currentPlayerIndex].name;
            } else { currentPlayerTurnDisplay.textContent = "-"; }
            currentRoundCounterDisplay.textContent = currentRound;
        }

        function showMessage(msg, type = 'info', duration = 3500) {
            let messageContent;
            let overlayToShow;
        
            // Simplified logic: use central overlay for most messages now
            if (type === 'turn_info') {
                 messageArea.innerHTML = msg; // Use innerHTML to render potential HTML tags
                 messageArea.className = 'mt-6 p-5 bg-blue-100 text-blue-800 rounded-xl shadow-lg text-center text-lg min-h-[60px]';
                 return; // Return early as this is a separate display area
            } else {
                messageContent = centralMessageContent;
                overlayToShow = centralMessageOverlay;
            }

            messageContent.innerHTML = `<div class="p-4">${msg}</div>`;
            overlayToShow.style.display = 'flex';
        
            // Automatically hide after duration
            setTimeout(() => {
                overlayToShow.style.display = 'none';
            }, duration);
        }


        function rollMainGameDie() { return getRandomInt(1, 6); }
        function getRandomInt(min, max) { min = Math.ceil(min); max = Math.floor(max); return Math.floor(Math.random() * (max - min + 1)) + min; }

// ฟังก์ชันควบคุมลูกเต๋า 3 มิติ
async function animateDiceRoll(finalRollFunction, duration = 2000) {
    playSound('diceRoll');
    const diceCube = document.getElementById('diceCube');
    diceAnimationOverlay.style.display = 'flex';
    diceAnimationText.textContent = "กำลังทอยลูกเต๋า...";
    diceCube.classList.add('spinning');

    return new Promise(resolve => {
        setTimeout(() => {
            const finalValue = finalRollFunction();
            diceCube.classList.remove('spinning');

            // หมุนลูกเต๋าไปแสดงหน้าที่ถูกต้อง (สุ่มหน้า 1-6 สำหรับการแสดงผล)
            const displayFace = Math.min(6, Math.max(1, finalValue > 0 ? finalValue : (Math.floor(Math.random() * 6) + 1)));
            const rotations = {
                1: 'rotateY(0deg) rotateX(0deg)',
                2: 'rotateY(-90deg) rotateX(0deg)',
                3: 'rotateY(-180deg) rotateX(0deg)',
                4: 'rotateY(90deg) rotateX(0deg)',
                5: 'rotateX(-90deg) rotateY(0deg)',
                6: 'rotateX(90deg) rotateY(0deg)'
            };
            diceCube.style.transform = rotations[displayFace];

            diceAnimationText.innerHTML = `คุณทอยได้: <span class="text-yellow-300 text-5xl">${finalValue}</span>`;
            movementDieValueDisplay.textContent = finalValue;

            setTimeout(() => {
               diceAnimationOverlay.style.display = 'none';
               resolve(finalValue);
            }, 1500); // รอแสดงผล 1.5 วินาที
        }, duration); // ระยะเวลาที่หมุน
    });
}        rollDiceButton.addEventListener('click', async () => {
            if (!gameActive || modal.style.display === 'flex' || cardSelectionModal.style.display === 'flex' || prankModal.style.display === 'flex' || !players[currentPlayerIndex]) return;
            playSound('buttonClick');
            rollDiceButton.disabled = true;
            movementDieResult = await animateDiceRoll(rollMainGameDie);
            setTimeout(() => {
                setTimeout(() => { movePlayer(movementDieResult, false); }, 100);
            }, 1600);
        });

        async function movePlayer(steps, isBonusMove = false) {
            if (!players[currentPlayerIndex]) return;
            const player = players[currentPlayerIndex];
            let targetPosition = player.position + steps;

            if (targetPosition >= NUM_SQUARES - 1) targetPosition = NUM_SQUARES - 1;
            if (targetPosition < 0) targetPosition = 0;

            if (steps < 0 && player.hasShield) {
                showMessage(`<p class="text-2xl font-semibold text-green-600">${player.name} มีเกราะป้องกัน! ไม่ต้องถอยหลังครั้งนี้</p>`, 'success', 3000);
                player.hasShield = false;
                updatePlayerInfo();
                switchTurn();
                return;
            }

            await new Promise(resolve => setTimeout(resolve, 100));

            const moveInterval = 350;
            let currentDisplayPosition = player.onBoardPosition;
            const stepDirection = (targetPosition > currentDisplayPosition) ? 1 : -1;

            function animateStep() {
                if (currentDisplayPosition !== targetPosition) {
                    currentDisplayPosition += stepDirection;
                    player.onBoardPosition = currentDisplayPosition;
                    renderPlayerPieces();
                    setTimeout(animateStep, moveInterval);
                } else {
                    player.position = targetPosition;
                    renderPlayerPieces();
                    updatePlayerInfo();
                    setTimeout(() => {
                        const finalSquare = boardConfig[player.position];
                        if (!isBonusMove) {
                            handleSquareAction(player.position);
                        } else {
                            if (finalSquare.type === 'normal' || finalSquare.type === 'puzzle' || finalSquare.type === 'finish') {
                                isHandlingBonusMoveQuestion = true;
                                handleSquareAction(player.position);
                            } else {
                                switchTurn();
                            }
                        }
                    }, 500);
                }
            }

            if (player.onBoardPosition !== targetPosition) animateStep();
            else { if (!isBonusMove) handleSquareAction(player.position); else switchTurn(); }
        }

        reportBtn.addEventListener('click', () => {
            playSound('buttonClick');
            victoryOverlay.style.display = 'none';
            generateAndShowReport();
        });
        
        function generateAndShowReport() {
            const reportContent = document.getElementById('reportContent');
            let html = `<table class="w-full text-sm text-left text-gray-500">
                <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                    <tr>
                        <th scope="col" class="px-6 py-3">ผู้เล่น</th>
                        <th scope="col" class="px-6 py-3 text-center">ความแม่นยำรวม</th>
                        <th scope="col" class="px-6 py-3 text-center">การบวก</th>
                        <th scope="col" class="px-6 py-3 text-center">การลบ</th>
                        <th scope="col" class="px-6 py-3 text-center">การคูณ</th>
                        <th scope="col" class="px-6 py-3 text-center">การหาร</th>
                        <th scope="col" class="px-6 py-3 text-center">ลำดับ/โจทย์ปัญหา</th>
                    </tr>
                </thead><tbody>`;

            const categories = ['addition', 'subtraction', 'multiplication', 'division', 'order_of_operations', 'word_problem'];

            players.forEach(player => {
                const stats = {};
                categories.forEach(cat => stats[cat] = { correct: 0, total: 0 });
                let totalCorrect = 0;
                let totalAnswered = 0;

                player.performanceLog.forEach(log => {
                    totalAnswered++;
                    if (log.correct) totalCorrect++;
                    
                    const logCategory = (log.category === 'order_of_operations' || log.category === 'word_problem') ? 'order_of_operations' : log.category;
                    if (stats[logCategory]) {
                        stats[logCategory].total++;
                        if (log.correct) stats[logCategory].correct++;
                    }
                });

                const overallAccuracy = totalAnswered > 0 ? ((totalCorrect / totalAnswered) * 100).toFixed(0) : 'N/A';
                
                html += `<tr class="bg-white border-b">
                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">${player.emoji} ${player.name}</th>
                    <td class="px-6 py-4 text-center font-bold">${overallAccuracy}%</td>`;
                
                categories.forEach(cat => {
                    const catStat = (cat === 'order_of_operations') ? 
                        { correct: stats.order_of_operations.correct + stats.word_problem.correct, total: stats.order_of_operations.total + stats.word_problem.total } : 
                        stats[cat];
                    if (cat === 'word_problem') return;

                    html += `<td class="px-6 py-4 text-center">${catStat.correct}/${catStat.total}</td>`;
                });
                
                html += `</tr>`;
            });

            html += `</tbody></table>`;
            reportContent.innerHTML = html;
            reportModal.style.display = 'flex';
        }


        // MODIFIED: Victory display now handles single player mode
        function displayVictory(winner) {
             playSound('victory');
            gameActive = false;
            rollDiceButton.disabled = true;
            if (backgroundMusicElement) { backgroundMusicElement.pause(); backgroundMusicElement.currentTime = 0; }
            
            if (isSinglePlayerMode) {
                winnerNameDisplay.innerHTML = `🎉 ยินดีด้วย! คุณพิชิตยอดเขาสำเร็จ! 🎉<br>คะแนนรวม: ${winner.score}<br>ใช้ไปทั้งหมด: ${currentRound} รอบ`;
            } else {
                winnerNameDisplay.innerHTML = `🎉 ยินดีด้วย ${winner.name} (${winner.emoji})! 🎉<br>คุณคือผู้พิชิตยอดเขา! (คะแนนรวม: ${winner.score})`;
            }

            victoryOverlay.style.display = 'flex';
            for (let i = 0; i < 20; i++) { setTimeout(() => { createFireworkBurst(); }, i * 150); }
        }

        function createFireworkBurst() {
            const numParticles = 30; const burstX = Math.random() * window.innerWidth; const burstY = Math.random() * (window.innerHeight * 0.7);
            for (let i = 0; i < numParticles; i++) {
                const particle = document.createElement('div'); particle.className = 'firework-particle absolute w-2 h-2 rounded-full'; 
                particle.style.backgroundColor = fireworkColors[Math.floor(Math.random() * fireworkColors.length)];
                particle.style.left = burstX + 'px'; particle.style.top = burstY + 'px';
                const angle = Math.random() * Math.PI * 2; const radius = Math.random() * 100 + 40;
                particle.style.animation = `fireworks-explode 0.7s ease-out forwards`;
                particle.style.setProperty('--tx', Math.cos(angle) * radius + 'px'); particle.style.setProperty('--ty', Math.sin(angle) * radius + 'px');
                fireworksContainer.appendChild(particle);
                particle.addEventListener('animationend', () => { particle.remove(); });
            }
        }
        const styleSheet = document.createElement("style");
        styleSheet.type = "text/css";
        styleSheet.innerText = `@keyframes fireworks-explode { from { transform: translate(0, 0) scale(1); opacity: 1; } to { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; } }`;
        document.head.appendChild(styleSheet);


        const questionTimerDisplay = document.getElementById('questionTimerDisplay');

        function updateTimerDisplay() {
            if (questionTimerDisplay) {
                questionTimerDisplay.textContent = `เวลา: ${timeLeft} วินาที`;
                if (timeLeft <= 5 && timeLeft > 0) questionTimerDisplay.classList.add('text-red-600', 'font-bold', 'animate-pulse');
                else questionTimerDisplay.classList.remove('text-red-600', 'font-bold', 'animate-pulse');
            }
        }
        
        function stopQuestionTimer() {
            if (questionTimerInterval) { clearInterval(questionTimerInterval); questionTimerInterval = null; }
            if (questionTimerDisplay) { questionTimerDisplay.classList.remove('text-red-600', 'font-bold', 'animate-pulse'); questionTimerDisplay.textContent = ''; }
            if (heartbeatOverlay) heartbeatOverlay.style.display = 'none';
        }

        let currentQuestionTimeoutCallback = null;

        function startQuestionTimer(onTimeUpCallback) {
            stopQuestionTimer();
            timeLeft = QUESTION_TIME_LIMIT;
            currentQuestionTimeoutCallback = onTimeUpCallback;
            updateTimerDisplay();
            questionTimerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 10 && timeLeft > 0) { heartbeatOverlay.style.display = 'block'; playSound('countdownTick'); }
                if (timeLeft <= 0) { stopQuestionTimer(); if (currentQuestionTimeoutCallback) currentQuestionTimeoutCallback(); }
            }, 1000);
        }

        
        function displayCardSelection(cardDeckType, titlePrefix = "เลือกการ์ด", customSourcePool = null) {
            playSound('cardSelect');
            cardsForSelection = [];
            let sourceDeck;
            let currentDynamicDifficulty = getCurrentDifficulty(players[currentPlayerIndex].position);
        
            if (cardDeckType === 'mission' || cardDeckType === 'puzzle') {
                const pool = customSourcePool || currentGameQuestionPool[cardDeckType][currentDynamicDifficulty] || [];
                if (pool.length === 0) {
                    showMessage("การ์ดหมด! ข้ามไปตานต่อไป", "info", 3000);
                    setTimeout(switchTurn, 1500);
                    return;
                }
                const shuffled = [...pool].sort(() => 0.5 - Math.random());
                cardsForSelection = shuffled.slice(0, 10);
            } else { // Effect cards
                sourceDeck = effectCards[cardDeckType] || [];
                const shuffledDeck = [...sourceDeck].sort(() => 0.5 - Math.random());
                cardsForSelection = shuffledDeck.slice(0, 5);
            }
        
            if (cardsForSelection.length === 0) {
                showMessage("การ์ดหมด! ข้ามไปตานต่อไป", "info", 3000);
                setTimeout(switchTurn, 1500);
                return;
            }
        
            cardSelectionGrid.innerHTML = '';
            cardSelectionTitle.textContent = `${titlePrefix}!`;
        
            cardsForSelection.forEach((cardData, index) => {
                const cardBackDiv = document.createElement('div');
                cardBackDiv.classList.add('card-back');
                cardBackDiv.innerHTML = `<i class="${cardData.icon || 'fas fa-question'}"></i>`;
                cardBackDiv.dataset.cardIndex = index;
                cardBackDiv.addEventListener('click', (e) => onCardSelected(e, cardDeckType));
                cardSelectionGrid.appendChild(cardBackDiv);
            });
            cardSelectionModal.style.display = 'flex';
        }
        
        function onCardSelected(event, cardDeckType) {
            playSound('cardSelect');
            const chosenCardIndex = parseInt(event.currentTarget.dataset.cardIndex);
            currentCardData = cardsForSelection[chosenCardIndex];

            // Remove selected question from pool to avoid repetition
            if (currentCardData.question) {
                const difficulty = currentCardData.difficulty;
                let sourcePoolList;
                if (cardDeckType === 'mission' || cardDeckType === 'puzzle') {
                    if (difficulty && currentGameQuestionPool[cardDeckType] && currentGameQuestionPool[cardDeckType][difficulty]) {
                        sourcePoolList = currentGameQuestionPool[cardDeckType][difficulty];
                        const indexToRemove = sourcePoolList.findIndex(q => q.question === currentCardData.question);
                        if (indexToRemove > -1) sourcePoolList.splice(indexToRemove, 1);
                    }
                }
            }

            cardSelectionModal.style.display = 'none';

            if (cardDeckType === 'mission' || cardDeckType === 'puzzle') {
                const modalTitleText = cardDeckType === 'mission' ? 'การ์ดภารกิจ' : 'การ์ดปริศนา';
                showQuestionModal(`${modalTitleText}`, currentCardData.question, handleQuestionAnswer);
            } else {
                applyEffectCard(currentCardData);
            }
        }
        
        function applyEffectCard(effectCard) {
            showMessage(`<p class="text-xl font-semibold">คุณได้รับการ์ด: ${effectCard.text}!</p>`, "success", 3000);
            const player = players[currentPlayerIndex];

            if (effectCard.action.includes("move_forward") || effectCard.action === "get_shield" || effectCard.action === "roll_again") playSound('powerUp');
            if (effectCard.action.includes("move_backward") || effectCard.action === "go_to_start") playSound('setback');
            if (effectCard.action.includes("go_to_square")) playSound('bonus');

            setTimeout(() => {
                switch (effectCard.action) {
                    case "move_forward": movePlayer(effectCard.value, true); break;
                    case "move_backward": movePlayer(-effectCard.value, true); break;
                    case "get_shield": player.hasShield = true; updatePlayerInfo(); switchTurn(); break;
                    case "roll_again": showMessage("<p class='text-xl'>ทอยลูกเต๋าอีกครั้ง!</p>", "info", 2000); rollDiceButton.disabled = false; break;
                    case "go_to_start":
                         if (player.hasShield) { showMessage(`<p class='text-xl'>${player.name} ใช้เกราะป้องกัน! ไม่ต้องกลับไปจุดเริ่มต้น</p>`, 'success', 3000); player.hasShield = false; updatePlayerInfo(); switchTurn(); }
                         else { player.position = 0; player.onBoardPosition = 0; renderPlayerPieces(); updatePlayerInfo(); switchTurn(); }
                        break;
                    case "go_to_square":
                        movePlayer(effectCard.value - player.position, true);
                        break;
                    default: switchTurn();
                }
            }, 1500);
        }

        // MODIFIED: handleQuestionAnswer now checks for single player mode
        function handleQuestionAnswer(isCorrect, timedOut = false) {
            const currentPlayer = players[currentPlayerIndex];
            if (currentCardData && currentCardData.question) {
                currentPlayer.performanceLog.push({
                    category: currentCardData.category || 'uncategorized',
                    difficulty: currentCardData.difficulty,
                    correct: isCorrect
                });
            }

            if (isAnsweringFinalQuestion) {
                isAnsweringFinalQuestion = false;
                if (isCorrect) {
                    players[currentPlayerIndex].score += 50; updatePlayerInfo(); playSound('victory');
                    displayVictory(players[currentPlayerIndex]);
                } else {
                    playSound('incorrectAnswer');
                    showMessage('<p class="text-xl font-semibold">ตอบผิด! คุณถูกผลักกลับ 1 ช่อง</p>', 'error', 3000);
                    setTimeout(() => movePlayer(-1, true), 3100);
                }
                return;
            }

            if (isAnsweringSetbackSave) {
                isAnsweringSetbackSave = false;
                if (isCorrect) {
                    players[currentPlayerIndex].score += 10; updatePlayerInfo(); playSound('powerUp');
                    showMessage('<p class="text-xl font-semibold">ตอบถูก! คุณรอดจากอุปสรรค!</p>', 'success', 3000);
                    pendingSetbackCard = null;
                    setTimeout(switchTurn, 3100);
                } else {
                    playSound('incorrectAnswer');
                    showMessage('<p class="text-xl font-semibold">ตอบผิด! คุณต้องรับผลของอุปสรรค</p>', 'error', 3000);
                    // In single player, setback card is applied directly
                    const cardToApply = pendingSetbackCard || effectCards.setback[Math.floor(Math.random() * effectCards.setback.length)];
                    pendingSetbackCard = null;
                    setTimeout(() => applyEffectCard(cardToApply), 3100);
                }
                return;
            }
            
            if (pendingAction) {
                const actionToRun = pendingAction; pendingAction = null; 
                if (isCorrect) {
                    players[currentPlayerIndex].score += 5; updatePlayerInfo(); playSound('correctAnswer');
                    showMessage('<p class="text-xl font-semibold">ตอบถูก! คุณได้รับสิทธิ์เปิดการ์ดพิเศษ!</p>', 'success', 2500);
                    setTimeout(() => actionToRun(), 2600);
                } else {
                    playSound('incorrectAnswer');
                    showMessage('<p class="text-xl font-semibold">ตอบผิด! คุณจึงไม่ได้รับเอฟเฟกต์พิเศษ</p>', 'error', 3000);
                    setTimeout(switchTurn, 3100);
                }
                return;
            }

            if (isHandlingBonusMoveQuestion) {
                isHandlingBonusMoveQuestion = false;
                if (isCorrect) { playSound('correctAnswer'); showMessage('<p class="text-xl font-semibold">ตอบถูก!</p>', 'success', 2000); } 
                else { playSound('incorrectAnswer'); showMessage(`<p class="text-xl font-semibold">ตอบผิด!</p>`, 'error', 3000); }
                setTimeout(switchTurn, 2500);
                return;
            }

            if (isCorrect) {
                playSound('correctAnswer');
                const difficultyPoints = {'easy': 10, 'medium': 20, 'hard': 30};
                const pointsEarned = difficultyPoints[currentCardData.difficulty] || 15;
                currentPlayer.score += pointsEarned;
                showMessage(`<p class="text-xl font-semibold">ตอบถูก! ได้รับ ${pointsEarned} คะแนน!</p>`, 'success', 3000);
                updatePlayerInfo();
                
                // SINGLE PLAYER: get a bonus. MULTIPLAYER: offer prank.
                if (isSinglePlayerMode) {
                    setTimeout(offerSelfBonus, 1000);
                } else if (players.length > 1) {
                    setTimeout(offerPrankChoice, 1000);
                } else {
                    setTimeout(switchTurn, 3100);
                }

            } else { // Incorrect Answer with Explanation
                playSound('incorrectAnswer');
                const reason = timedOut ? 'หมดเวลา!' : 'ตอบผิด!';
                let feedbackHTML = `
                    <h3 class='text-red-600 font-bold text-2xl'>${reason}</h3>
                    <p class='mt-2 text-lg'>คำตอบที่ถูกต้องคือ: <span class='font-bold'>${currentCardData.answer}</span></p>`;
                
                if (currentCardData.explanation) {
                    feedbackHTML += `<div class='mt-4 p-3 bg-gray-100 rounded-lg text-left'>
                        <h4 class='font-semibold text-gray-800'>ขั้นตอนการคิดที่ถูกต้อง:</h4>
                        <p class='text-gray-700'>${currentCardData.explanation}</p> 
                    </div>`;
                }
                
                showMessage(feedbackHTML, 'error_explanation', 8000);
                
                // SINGLE PLAYER: apply auto-punishment. MULTIPLAYER: let others punish.
                if (isSinglePlayerMode) {
                    setTimeout(applySinglePlayerPunishment, 3500);
                } else if (players.length > 1) {
                    setTimeout(initiatePunishment, 3500);
                } else {
                    setTimeout(switchTurn, 8100);
                }
            }
        }
        
        // NEW: Offer a personal bonus instead of a prank in single player mode
        function offerSelfBonus() {
            prankTitle.textContent = "ตอบถูก! เลือกรับโบนัส:";
            prankOptionsContainer.innerHTML = '';
            prankButtonsContainer.innerHTML = '';

            const bonuses = [
                { text: "รับ +10 คะแนน", action: 'score', value: 10, icon: 'fa-star' },
                { text: "เดินหน้า 1 ช่อง", action: 'move', value: 1, icon: 'fa-shoe-prints' },
                { text: "รับเกราะป้องกัน", action: 'shield', icon: 'fa-shield-alt' }
            ];

            bonuses.forEach(bonus => {
                const btn = document.createElement('button');
                btn.className = 'bonus-choice-btn'; // Use a new class for styling
                btn.innerHTML = `<i class="fas ${bonus.icon} mr-2"></i> ${bonus.text}`;
                btn.onclick = () => {
                    playSound('powerUp');
                    prankModal.style.display = 'none';
                    const player = players[currentPlayerIndex];
                    if (bonus.action === 'score') player.score += bonus.value;
                    if (bonus.action === 'shield') player.hasShield = true;
                    updatePlayerInfo();
                    if (bonus.action === 'move') movePlayer(bonus.value, true);
                    else switchTurn();
                };
                prankOptionsContainer.appendChild(btn);
            });
            
            prankButtonsContainer.innerHTML = `<button id="skipBonusBtn" class="modal-button bg-gray-300 hover:bg-gray-400 text-gray-700">ไม่รับโบนัส</button>`;
            document.getElementById('skipBonusBtn').onclick = () => { playSound('buttonClick'); prankModal.style.display = 'none'; switchTurn(); };

            prankModal.style.display = 'flex';
        }

        // NEW: Apply a fixed punishment in single player mode
        function applySinglePlayerPunishment() {
            playSound('setback');
            const player = players[currentPlayerIndex];
            const penalty = 2; // Fixed penalty
            showMessage(`<p class="text-xl">ตอบผิด! คุณต้องถอยหลัง ${penalty} ช่อง</p>`, 'error', 3000);
            setTimeout(() => { movePlayer(-penalty, true); }, 1500);
        }


        function offerPrankChoice() {
            if (currentRound === 1 && currentPlayerIndex < players.length - 1) { switchTurn(); return; }
            prankTitle.textContent = "เลือกผู้เล่นที่จะแกล้ง:";
            prankOptionsContainer.innerHTML = ``;
            prankButtonsContainer.innerHTML = '';
            const validTargets = players.filter((p, index) => index !== currentPlayerIndex && !p.hasBeenPrankedThisRound);
            if (validTargets.length === 0) { switchTurn(); return; }
            validTargets.forEach(targetData => {
                const pIndex = players.findIndex(p => p.id === targetData.id);
                const btn = document.createElement('button');
                btn.className = 'prank-target-btn';
                btn.textContent = `${targetData.name} (${targetData.emoji})`;
                btn.onclick = () => { playSound('buttonClick'); selectPrankEffect(pIndex); };
                prankOptionsContainer.appendChild(btn);
            });
            prankButtonsContainer.innerHTML = `<button id="skipPrankBtn" class="modal-button bg-gray-300 hover:bg-gray-400 text-gray-700">ไม่แกล้ง</button>`;
            document.getElementById('skipPrankBtn').onclick = () => { playSound('buttonClick'); prankModal.style.display = 'none'; switchTurn(); };
            prankModal.style.display = 'flex';
        }
        
        function selectPrankEffect(targetPlayerIndex) {
            prankTitle.textContent = `เลือกวิธีแกล้ง ${players[targetPlayerIndex].name}:`;
            prankOptionsContainer.innerHTML = '';
            const currentPlayer = players[currentPlayerIndex];
            prankEffects.forEach(effect => {
                const btn = document.createElement('button');
                btn.className = 'prank-effect-btn';
                btn.innerHTML = `<i class="${effect.icon} mr-2"></i> ${effect.text}${effect.cost ? ` (ใช้ ${effect.cost} คะแนน)` : ''}`;
                if (effect.cost && currentPlayer.score < effect.cost) btn.disabled = true;
                btn.onclick = () => { playSound('buttonClick'); prankModal.style.display = 'none'; applyPrankToTarget(targetPlayerIndex, effect); };
                prankOptionsContainer.appendChild(btn);
            });
            prankButtonsContainer.innerHTML = `<button id="cancelPrankEffectBtn" class="modal-button bg-gray-300 hover:bg-gray-400 text-gray-700">ยกเลิก</button>`;
            document.getElementById('cancelPrankEffectBtn').onclick = () => { playSound('buttonClick'); prankModal.style.display = 'none'; switchTurn(); };
        }
        
        function applyPrankToTarget(targetPlayerIndex, prankEffect) {
            playSound('prank');
            const targetPlayer = players[targetPlayerIndex];
            targetPlayer.hasBeenPrankedThisRound = true;
            if (prankEffect.cost) {
                const currentPlayer = players[currentPlayerIndex];
                currentPlayer.score -= prankEffect.cost;
                showMessage(`<p class="text-xl">${currentPlayer.name} ใช้ ${prankEffect.cost} คะแนนเพื่อแกล้ง ${targetPlayer.name}!</p>`, 'info', 3000);
                updatePlayerInfo();
            } else {
                showMessage(`<p class="text-xl">${players[currentPlayerIndex].name} แกล้ง ${targetPlayer.name} โดย ${prankEffect.text}!</p>`, 'info', 3000);
            }
            setTimeout(() => {
                if (prankEffect.action === "prank_move_backward") {
                    targetPlayer.position = Math.max(0, targetPlayer.position - prankEffect.value);
                    targetPlayer.onBoardPosition = targetPlayer.position;
                } else if (prankEffect.action === "prank_skip_turn") {
                    targetPlayer.extraTurnsToTake = (targetPlayer.extraTurnsToTake || 0) - prankEffect.value;
                }
                renderPlayerPieces(); updatePlayerInfo(); switchTurn();
            }, 1500);
        }

        function initiatePunishment() {
            const playerToPunish = players[currentPlayerIndex];
            prankTitle.textContent = `${playerToPunish.name} ตอบผิด! เลือกบทลงโทษเลย!`;
            prankOptionsContainer.innerHTML = ''; prankButtonsContainer.innerHTML = '';
            let availablePunishments = punishmentEffects.filter(p => p.for3plusPlayers ? players.length >= 3 : true);
            availablePunishments.forEach(effect => {
                const btn = document.createElement('button');
                btn.className = 'punishment-btn'; btn.textContent = effect.text;
                btn.onclick = () => { playSound('buttonClick'); applyPunishment(effect); };
                prankOptionsContainer.appendChild(btn);
            });
            prankModal.style.display = 'flex';
        }

        function applyPunishment(punishmentEffect) {
            prankModal.style.display = 'none'; playSound('setback');
            const player = players[currentPlayerIndex];
            showMessage(`<p class="text-xl">${player.name} โดนลงโทษให้... ${punishmentEffect.text}!</p>`, 'error', 3000);
            setTimeout(() => { movePlayer(-punishmentEffect.value, true); }, 1500);
        }

        function initiateSetbackSelectionByOpponents() {
            const player = players[currentPlayerIndex];
            prankTitle.textContent = `${player.name} ตกช่องอุปสรรค! เลือกการ์ดให้เพื่อนเลย`;
            prankOptionsContainer.innerHTML = ''; prankButtonsContainer.innerHTML = '';
            const setbackCards = effectCards.setback;
            setbackCards.forEach(card => {
                const btn = document.createElement('button');
                btn.className = 'setback-choice-btn'; btn.innerHTML = `<i class="${card.icon} mr-2"></i> ${card.text}`;
                btn.onclick = () => { prankModal.style.display = 'none'; pendingSetbackCard = card; askSetbackSaveQuestion(); };
                prankOptionsContainer.appendChild(btn);
            });
            prankModal.style.display = 'flex';
        }
        
        // NEW: A separate function for single player setback squares.
        function initiateSinglePlayerSetbackChallenge() {
            pendingSetbackCard = null; // Clear any pending card
            askSetbackSaveQuestion(); // Go directly to the save question
        }

        function askSetbackSaveQuestion() {
            isAnsweringSetbackSave = true;
            const challengePool = [...currentGameQuestionPool.mission.medium, ...currentGameQuestionPool.mission.hard];
            if (challengePool.length === 0) {
                showMessage('<p class="text-xl">การ์ดคำถามยากหมด! คุณโชคดี รอดตัวไป!</p>', 'success', 3000);
                pendingSetbackCard = null; isAnsweringSetbackSave = false;
                setTimeout(switchTurn, 3100); return;
            }
            const questionCard = challengePool[Math.floor(Math.random() * challengePool.length)];
            currentCardData = questionCard;
            showQuestionModal('ตอบให้ถูกเพื่อรอดจากอุปสรรค!', questionCard.question, handleQuestionAnswer);
        }

        function askFinalQuestion() {
            isAnsweringFinalQuestion = true;
            const hardQuestionPool = currentGameQuestionPool.mission.hard;
            if (hardQuestionPool.length === 0) {
                showMessage('<p class="text-xl">สุดยอด! การ์ดคำถามยากหมดแล้ว คุณชนะเลย!</p>', 'success', 3000);
                setTimeout(() => displayVictory(players[currentPlayerIndex]), 3100); return;
            }
            const finalQuestionCard = hardQuestionPool[Math.floor(Math.random() * hardQuestionPool.length)];
            currentCardData = finalQuestionCard;
            showQuestionModal('คำถามสุดท้ายเพื่อพิชิตยอดเขา!', finalQuestionCard.question, handleQuestionAnswer);
        }

        // MODIFIED: handleSquareAction checks for single player mode
        async function handleSquareAction(squareIndex) {
            if (!players[currentPlayerIndex]) return;
            const square = boardConfig[squareIndex];
            showMessage(`<p class="text-xl">${square.text}: ${square.instruction}</p>`, 'info', 2000);
            setTimeout(() => {
                switch (square.type) {
                    case 'power-up':
                        pendingAction = () => displayCardSelection('powerUp', 'เลือกการ์ดพลังเสริม');
                        displayCardSelection('mission', 'คำถามชิงรางวัล (กลาง/ยาก)!', [...currentGameQuestionPool.mission.medium, ...currentGameQuestionPool.mission.hard]);
                        break;
                    case 'bonus':
                        pendingAction = () => displayCardSelection('bonus', 'เลือกการ์ดโบนัส');
                        displayCardSelection('mission', 'คำถามชิงรางวัล (กลาง/ยาก)!', [...currentGameQuestionPool.mission.medium, ...currentGameQuestionPool.mission.hard]);
                        break;
                    case 'setback':
                        if (isSinglePlayerMode) {
                            initiateSinglePlayerSetbackChallenge();
                        } else {
                            initiateSetbackSelectionByOpponents();
                        }
                        break;
                    case 'puzzle': displayCardSelection('puzzle', 'เลือกการ์ดปริศนา'); break;
                    case 'normal': displayCardSelection('mission', 'เลือกการ์ดภารกิจ'); break;
                    case 'event':
                        const randomEvent = groupEvents[Math.floor(Math.random() * groupEvents.length)];
                        showMessage(`<p class="text-xl">เกิดอีเวนต์: ${randomEvent.text}</p>`, 'info', 4000);
                        setTimeout(() => {
                            // Pass the mode to the action
                            randomEvent.action(players, currentPlayerIndex, isSinglePlayerMode);
                            renderPlayerPieces(); updatePlayerInfo(); switchTurn();
                        }, 4100);
                        break;
                    case 'finish': askFinalQuestion(); break;
                    default: switchTurn(); break;
                }
            }, 2100);
        }
        
        
        function showQuestionModal(titleHTML, question, answerCallback) {
            modal.answerCallback = answerCallback;
            modalTitle.innerHTML = titleHTML;
            modalQuestion.textContent = question;
            modalAnswerInput.value = ''; modalFeedback.textContent = '';
            modalSubmitButton.disabled = false; modalCloseButton.disabled = false;
            modalCloseButton.textContent = "ปิด";
        
            const oldContainer = document.getElementById('modalChoicesContainer');
            if (oldContainer) oldContainer.remove();
        
            if (currentCardData && currentCardData.choices) {
                modalAnswerInput.style.display = 'none'; modalSubmitButton.style.display = 'none';
                const answerButtonContainer = document.createElement('div');
                answerButtonContainer.id = 'modalChoicesContainer';
                currentCardData.choices.forEach(choice => {
                    const choiceBtn = document.createElement('button');
                    choiceBtn.textContent = choice;
                    choiceBtn.className = 'modal-button modal-submit-button';
                    choiceBtn.onclick = () => {
                        playSound('buttonClick'); stopQuestionTimer();
                        const isCorrect = (choice.toString().toLowerCase() === currentCardData.answer.toString().toLowerCase());
                        modal.style.display = 'none';
                        if (modal.answerCallback) modal.answerCallback(isCorrect, false);
                    };
                    answerButtonContainer.appendChild(choiceBtn);
                });
                modalFeedback.insertAdjacentElement('beforebegin', answerButtonContainer);
            } else {
                modalAnswerInput.style.display = 'block'; modalSubmitButton.style.display = 'inline-block';
            }
        
            modal.style.display = 'flex';
            if (modalAnswerInput.style.display === 'block') modalAnswerInput.focus();
        
            startQuestionTimer(() => {
                if (modal.style.display === 'flex' && modal.answerCallback) modal.answerCallback(false, true);
            });
        
            modalSubmitButton.onclick = () => {
                playSound('buttonClick'); stopQuestionTimer();
                let isCorrect = currentCardData ? modalAnswerInput.value.trim().toLowerCase() === currentCardData.answer.toString().toLowerCase() : false;
                modalSubmitButton.disabled = true; modalCloseButton.disabled = true;
                modal.style.display = 'none';
                if (modal.answerCallback) modal.answerCallback(isCorrect, false);
            };
        
            modalCloseButton.onclick = () => {
                playSound('buttonClick'); stopQuestionTimer();
                modal.style.display = 'none';
                if (modal.answerCallback) modal.answerCallback(false, false); 
            };
        }

        function switchTurn() {
            if (!gameActive || players.length === 0) { rollDiceButton.disabled = true; return; }
            const oldPlayerIndex = currentPlayerIndex;
            let playerWhoJustPlayed = players[currentPlayerIndex];

            // Handle extra turns (positive for bonus, negative for skip)
            if (playerWhoJustPlayed.extraTurnsToTake > 0) {
                playerWhoJustPlayed.extraTurnsToTake--;
                showMessage(`<p class="text-xl">${playerWhoJustPlayed.name} ได้เล่นตาพิเศษ!</p>`, 'info', 3000);
            } else {
                let nextPlayerIndex = (currentPlayerIndex + 1) % players.length;
                while (players[nextPlayerIndex].extraTurnsToTake < 0) {
                    showMessage(`<p class="text-xl">${players[nextPlayerIndex].name} โดนแกล้ง! ข้ามตานี้</p>`, 'error', 2000);
                    players[nextPlayerIndex].extraTurnsToTake++;
                    nextPlayerIndex = (nextPlayerIndex + 1) % players.length;
                }
                currentPlayerIndex = nextPlayerIndex;
            }

            if (players[currentPlayerIndex]) {
                players[currentPlayerIndex].hasBeenPrankedThisRound = false;
            }
            
            // Increment round counter if the turn has looped back to the first player
            if (currentPlayerIndex < oldPlayerIndex || (players.length > 1 && oldPlayerIndex === players.length - 1 && currentPlayerIndex === 0) || (isSinglePlayerMode)) {
                if (isSinglePlayerMode && oldPlayerIndex === currentPlayerIndex) {
                     // In single player, a turn is a round if it's not an extra turn.
                     if(playerWhoJustPlayed.extraTurnsToTake === 0) currentRound++;
                } else if (!isSinglePlayerMode) {
                     currentRound++;
                }
                
                if (isSinglePlayerMode && playerWhoJustPlayed.extraTurnsToTake === 0) {
                    showMessage(`รอบที่ ${currentRound} เริ่มขึ้นแล้ว!`, 'turn_info');
                } else if (!isSinglePlayerMode) {
                    showMessage(`รอบที่ ${currentRound} เริ่มขึ้นแล้ว!`, 'turn_info');
                }
            }

            updatePlayerInfo();
            if (players.length > 0 && players[currentPlayerIndex]) {
                document.getElementById('messageArea').textContent = `ตาของ ${players[currentPlayerIndex].name}`;
            }
            rollDiceButton.disabled = false;
            movementDieValueDisplay.textContent = '-';
        }


        window.addEventListener('DOMContentLoaded', (event) => {
            console.log('DOM fully loaded and parsed');
            populateAllCards();
            createPlayerConfigInputs(parseInt(numPlayersSelect.value));
            boardContainer.classList.add('hidden');
            gameSetupScreen.classList.add('hidden');
        });

    </script>
</body>
</html>
